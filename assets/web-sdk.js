/*!
 * Copyright (c) 2020 Oracle and/or its affiliates.
 * All rights reserved. Oracle Digital Assistant Chat Web SDK, Release: 20.8.2
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebSDK=t():e.WebSDK=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=23)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utils=void 0;var i=n(3),o=function(e){var t=!1;return e.text&&(t=!0),t},s=function(e){var t,n,i=!1;return(null===(t=e.location)||void 0===t?void 0:t.latitude)&&(null===(n=e.location)||void 0===n?void 0:n.longitude)&&(i=!0),i},r=function(e){var t=!1;return e.postback&&(t=!0),t},a=function(e){var t,n,i=!1;return(null===(t=e.attachment)||void 0===t?void 0:t.type)&&(null===(n=e.attachment)||void 0===n?void 0:n.url)&&(i=!0),i},c=/\\/g,l=/`/g,h=/>/g,u=/</g,d=function(e){return e.lastIndex=0,e},p={createCssClass:function(e,t){var n="";return(null==t?void 0:t.length)>0&&(n=e+" {\n",t.forEach((function(e){n+="  "+e+";\n"})),n+="}\n\n"),n},deepFreeze:function(e){for(var t=0,n=Object.getOwnPropertyNames(e);t<n.length;t++){var i=e[n[t]];i&&"object"==typeof i&&p.deepFreeze(i)}return Object.freeze(e)},getValues:function(e){var t=[];if("object"==typeof e&&null!==e)for(var n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];t.push(e[o])}return t},isDivVisible:function(e,t){var n=e.scrollTop,i=n+e.offsetHeight,o=t.offsetTop,s=o+t.offsetHeight;return i>o&&i<s||n<s&&i>s||n<o&&i>s||n>o&&i<s},isFunction:function(e){return"function"==typeof e},isSvg:function(e){var t=e.match(/<svg\s/gi);return t&&t.length>0},isValidSkillMessage:function(e){var t=!1;if(null==e?void 0:e.messagePayload)switch(e.messagePayload.type){case i.PAYLOAD_TYPE.TEXT:t=o(e.messagePayload);break;case i.PAYLOAD_TYPE.LOCATION:t=s(e.messagePayload);break;case i.PAYLOAD_TYPE.ATTACHMENT:t=a(e.messagePayload);break;case i.PAYLOAD_TYPE.POSTBACK:t=r(e.messagePayload);break;case i.PAYLOAD_TYPE.CARD:t=function(e){var t=!1;return e.layout&&e.cards.length&&(t=!0,e.cards.forEach((function(e){e.title||(t=!1)}))),t}(e.messagePayload);break;case i.PAYLOAD_TYPE.RAW:t=function(e){var t=!1;return e.payload&&(t=!0),t}(e.messagePayload)}return t},isValidUserMessage:function(e){var t=!1;if(e.messagePayload)switch(e.messagePayload.type){case i.PAYLOAD_TYPE.TEXT:t=o(e.messagePayload);break;case i.PAYLOAD_TYPE.LOCATION:t=s(e.messagePayload);break;case i.PAYLOAD_TYPE.ATTACHMENT:t=a(e.messagePayload);break;case i.PAYLOAD_TYPE.POSTBACK:t=r(e.messagePayload)}return t},resetRegex:d,sanitizeText:function(e){return e=null==e?void 0:e.replace(d(u),"&#x3c;").replace(d(h),"&#x3e;").replace(d(l),"&#x60;").replace(d(c),"&#x5C;")},secToMillisec:function(e){return 1e3*e},setEmbeddedLinksHandler:function(e,t){for(var n=0;n<e.childElementCount;n++){var i=e.children[n];if("a"===i.tagName.toLowerCase()){var o=i;o.rel="noreferrer noopener",t.onclick&&(o.onclick=t.onclick.bind(o)),t.target&&(o.target=t.target)}i.hasChildNodes()&&p.setEmbeddedLinksHandler(i,t)}},setLinksOpenInNewWindow:function(e){for(var t=function(t){var n=e.children[t];"a"===n.tagName.toLowerCase()&&(n.onclick=function(e){return window.open(n.href,"","height=450px,width=800px,menubar,toolbar,personalbar,status,resizable,noopener,noreferrer"),e.preventDefault(),e.stopPropagation(),!1}),n.hasChildNodes()&&p.setLinksOpenInNewWindow(n)},n=0;n<e.childElementCount;n++)t(n)},setSearchParams:function(e,t){if("URLSearchParams"in window){for(var n=e.search,i=new URLSearchParams(n),o=0,s=Object.keys(t);o<s.length;o++){var r=s[o];i.set(r,t[r])}e.search=i.toString()}else{i=[];for(var a=0,c=Object.keys(t);a<c.length;a++){r=c[a];i.push(r+"="+t[r])}i.length&&(e.search="?"+i.join("&"))}return e}};t.utils=p},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(r=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),s=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[n].concat(s).concat([o]).join("\n")}var r,a,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(i)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(o[r]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);i&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGE_SIDE=t.MessageComponent=void 0;var i,o=n(17),s=n(14),r=n(3),a=n(5),c=n(30);!function(e){e.LEFT="left",e.RIGHT="right"}(i||(i={})),t.MESSAGE_SIDE=i;var l=function(){function e(e,t,n,i,s,a,c){this.utils=e,this.settings=t,this.side=i,this.markAsRead=a,this.source=c,this.actions=[],this.globalActions=[],this._options={weekday:"long",year:"numeric",month:"long",day:"numeric"},this.date=s;var l="";switch(n.type){case r.PAYLOAD_TYPE.CARD:n.cards.forEach((function(e){var t;l+=(e.title?e.title+" - ":"")+(e.description?e.description+" - ":"")+(null!==(t=e.url)&&void 0!==t?t:"")+"\n"}));break;case r.PAYLOAD_TYPE.TEXT:l=n.text;break;case r.PAYLOAD_TYPE.ATTACHMENT:l=n.attachment.url;break;case r.PAYLOAD_TYPE.LOCATION:var h=n.location;l=(h.title?h.title+" - ":"")+h.latitude+", "+h.longitude}if(n.actions)for(var u=0,d=0,p=n.actions;d<p.length;d++){u++,(_=p[d]).actionId="action"+u;var g=o.ActionComponentFactory.fromActionPayload(e,_,this.settings.openLinksInNewWindow,l,t.linkHandler);g&&(g.onActionClick=this.handleOnActionClick.bind(this),this.actions.push(g))}if(n.globalActions)for(var f=0,m=0,v=n.globalActions;m<v.length;m++){var _;f++,(_=v[m]).actionId="globalAction"+f;var b=o.ActionComponentFactory.fromActionPayload(e,_,this.settings.openLinksInNewWindow,l,t.linkHandler);b&&(b.onActionClick=this.handleOnActionClick.bind(this),this.globalActions.push(b))}this.headerText=n.headerText,this.footerText=n.footerText}return e.prototype.handleOnActionClick=function(e){if(this.onActionClick){var t=e;t.messageComponent=this,this.onActionClick(t)}},e.prototype.handleOnActionTrigger=function(e){var t=+e.match(/\d+/g)[0];return"action"===e.match(/[a-zA-Z]+/g)[0]?this.actions.length>=t?this.actions[t-1]:null:this.globalActions.length>=t?this.globalActions[t-1]:null},e.prototype.render=function(e){return this._renderMessage(e,this.actions,this.globalActions)},e.prototype.updateMarkAsRead=function(){return this.renderMsgReadStatus(!0),this.markAsRead(this.date)},e.prototype.appendActions=function(e,t){if(t.length>0){for(var n=this.utils.createDiv(["message-actions"]),i=0,o=t;i<o.length;i++){var s=o[i];n.appendChild(s.render())}e.appendChild(n)}},e.prototype.appendGlobalActions=function(e,t){if(t.length>0){var n=["message-global-actions"];this.settings.botIcon&&n.push("has-message-icon");for(var i=this.utils.createDiv(n),o=0,s=t;o<s.length;o++){var r=s[o];i.appendChild(r.render())}e.appendChild(i)}},e.prototype.getContent=function(){throw new Error("Method not implemented.")},e.prototype.disableActions=function(e){if("postback"!==this.settings.disablePastActions||e){for(var t=0,n=this.actions;t<n.length;t++){n[t].disable()}for(var i=0,o=this.globalActions;i<o.length;i++){o[i].disable()}}else this.disablePostActions(this.actions),this.disablePostActions(this.globalActions)},e.prototype.enableActions=function(){for(var e=0,t=this.actions;e<t.length;e++){t[e].enable()}for(var n=0,i=this.globalActions;n<i.length;n++){i[n].enable()}},e.prototype.renderMsgReadStatus=function(e){if(this._chatDate){var t=this.date?new Date(this.date):new Date,n=e?this.settings.readMark:"",i=this.settings.timestampFormat;if(i)if("string"==typeof i)try{this._chatDate.textContent=c.format(t,i)+" "+n}catch(e){this.setDefaultTimestamp(t,n)}else"object"==typeof i&&"null"!==i?this._chatDate.textContent=t.toLocaleTimeString(this.settings.locale,i)+" "+n:this.setDefaultTimestamp(t,n);else this.setDefaultTimestamp(t,n)}},e.prototype.setDefaultTimestamp=function(e,t){this._chatDate.textContent=e.toLocaleTimeString(this.settings.locale,this._options)+" "+t},e.prototype.disablePostActions=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];(i.getActionType()===a.ACTION_TYPE.POSTBACK||a.ACTION_TYPE.LOCATION)&&i.disable()}},e.prototype._renderMessage=function(e,t,n){var o,r=this.utils.createDiv(["message",this.side]),a=this.settings.locale;r.lang=a;var c=this.side===i.LEFT?this.settings.i18n[a].skillMessage:this.settings.i18n[a].userMessage,l=this.utils.createSpan(["screen-reader-only"]);l.textContent=c,r.appendChild(l);var h=this.utils.createDiv(["message-wrapper"]);r.appendChild(h);var u=this.settings.botIcon;this.source===s.ISkillMessageSource.AGENT&&(u=null!==(o=this.settings.agentAvatar)&&void 0!==o?o:this.settings.botIcon);var d=this.side===i.LEFT?u:this.settings.personIcon;if(d){var p=this.utils.createDiv(["icon-wrapper"]);p.appendChild(this.utils.createImage(d,["message-icon"],"")),h.appendChild(p)}var g=this.utils.createDiv(["content-wrapper"]),f=this.utils.createDiv(["message-bubble"]);f.style.padding=this.settings.messagePadding||f.style.padding;var m=this.utils.createDiv(["message-content"]);if(m.appendChild(e||this.getContent()),f.appendChild(m),t&&(this.settings.displayActionsAsPills?this.appendGlobalActions(r,t):this.appendActions(f,t)),this.settings.enableTimestamp&&(this._chatDate=this.utils.createDiv(["message-date"]),this._chatDate.setAttribute("aria-live","off"),this._chatDate.setAttribute("aria-hidden","true"),this.renderMsgReadStatus(!1),f.appendChild(this._chatDate)),g.appendChild(f),this.headerText&&g.firstElementChild.classList.add(this.utils.getCssClassWithPrefix("has-header")),this.footerText&&g.firstElementChild.classList.add(this.utils.getCssClassWithPrefix("has-footer")),this.headerText){var v=this.utils.createDiv(["message-bubble","message-header"]);v.innerHTML=this.utils.linkify(this.headerText,{embeddedHTML:this.side===i.LEFT,embeddedVideo:!0}),g.prepend(v)}if(this.footerText){var _=this.utils.createDiv(["message-bubble","message-footer"]);_.innerHTML=this.utils.linkify(this.footerText,{embeddedHTML:this.side===i.LEFT,embeddedVideo:!0}),g.appendChild(_)}return h.appendChild(g),n&&this.appendGlobalActions(r,n),r},e}();t.MessageComponent=l},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_TYPE=void 0,function(e){e.TEXT="text",e.CARD="card",e.ATTACHMENT="attachment",e.LOCATION="location",e.RAW="raw",e.POSTBACK="postback",e.PROFILE="profile",e.ERROR="error",e.SUGGEST="suggest"}(i||(i={})),t.PAYLOAD_TYPE=i},function(e,t,n){"use strict";var i,o,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.IShareMenuItems=t.StorageType=t.SPEECH_LOCALE=t.IWidgetTheme=void 0,function(e){e.SESSION="sessionStorage",e.LOCAL="localStorage"}(i||(i={})),t.StorageType=i,function(e){e.CLASSIC="classic",e.DEFAULT="default",e.REDWOOD_DARK="redwood-dark"}(o||(o={})),t.IWidgetTheme=o,function(e){e.AUDIO="audio",e.FILE="file",e.LOCATION="location",e.VISUAL="visual"}(s||(s={})),t.IShareMenuItems=s,function(e){e.EN_US="en-us",e.ES_ES="es-es",e.FR_FR="fr-fr",e.PT_BR="pt-br"}(r||(r={})),t.SPEECH_LOCALE=r},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ACTION_TYPE=void 0,function(e){e.CALL="call",e.LOCATION="location",e.POSTBACK="postback",e.SHARE="share",e.URL="url"}(i||(i={})),t.ACTION_TYPE=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionComponent=void 0;var i=n(5),o=function(){function e(e,t){this.utils=e,this._disabled=!1,this._actionId=t.actionId,this._type=t.type,this._label=t.label,this._imageUrl=t.imageUrl}return e.prototype.render=function(){if(this._htmlElement=this.utils.createButton(),this._htmlElement.onclick=this.handleOnClick.bind(this),this._imageUrl){var e=this.utils.createImage(this._imageUrl,["action-image"],this._label||"");this._htmlElement.appendChild(e)}if(this._label){var t=this.utils.linkify(this._label,{embeddedHTML:!0}),n=this.utils.createDiv();n.innerHTML=t,this._htmlElement.appendChild(n),this._htmlElement.title=this._htmlElement.textContent}return this._disabled&&this._htmlElement.classList.add(this.utils.getCssClassWithPrefix("disabled")),this._htmlElement},e.prototype.handleOnClick=function(e){if(this.onActionClick&&!this._disabled){var t={getPayload:this.getEventPayload.bind(this),label:this._label,type:this._type};this.onActionClick(t)}this._type!==i.ACTION_TYPE.POSTBACK&&this._type!==i.ACTION_TYPE.LOCATION&&this._type!==i.ACTION_TYPE.SHARE||(e.preventDefault(),e.stopPropagation())},e.prototype.disable=function(){this._disabled=!0,this._htmlElement&&(this._htmlElement.classList.add(this.utils.getCssClassWithPrefix("disabled")),this._htmlElement.disabled=!0)},e.prototype.enable=function(){this._disabled=!1,this._htmlElement&&(this._htmlElement.classList.remove(this.utils.getCssClassWithPrefix("disabled")),this._htmlElement.disabled=!1)},e.prototype.getActionType=function(){return this._type},e}();t.ActionComponent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var i=function(){function e(e){this.module=e}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._log(e.LOG_LEVEL.DEBUG,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._log(e.LOG_LEVEL.ERROR,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._log(e.LOG_LEVEL.INFO,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._log(e.LOG_LEVEL.WARN,t)},e.prototype._log=function(t,n){if(e.logLevel>=t){n.unshift("["+e.appName+"."+e.appVersion+"."+this.module+"]");var i=void 0;switch(e.logLevel){case e.LOG_LEVEL.ERROR:i=console.error;break;case e.LOG_LEVEL.WARN:i=console.warn;break;case e.LOG_LEVEL.INFO:i=console.info;break;case e.LOG_LEVEL.DEBUG:i=console.debug}e.historyEnabled&&(e.history.push(Object.assign({},n,{level:t})),e._historySize<=e.history.length&&e.history.shift()),i.apply(console,n)}},e.LOG_LEVEL={DEBUG:4,ERROR:1,INFO:3,NONE:0,WARN:2},e.logLevel=e.LOG_LEVEL.ERROR,e.history=[],e.historyEnabled=!1,e._historySize=100,e}();t.Logger=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECTION_STATE=void 0,function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(t.CONNECTION_STATE||(t.CONNECTION_STATE={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SVG_SPRITE=void 0;t.SVG_SPRITE={icon_bot_attach:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 17a1 1 0 00.993-.883L13 16V6a3 3 0 00-5.995-.176L7 6v10l.005.217a5 5 0 009.99 0L17 16V4h2v12a7 7 0 01-13.996.24L5 16V6a5 5 0 019.995-.217L15 6v10a3 3 0 01-5.995.176L9 16V8h2v8a1 1 0 001 1z"/></svg>',icon_bot_button:'<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 48 48"><path d="M0 24a24 24 0 1 0 48 0 24 24 0 1 0-48 0" fill="#025e7e" opacity=".8"/><path d="M32.25 31.084h-7.532L19.2 37.021a1.061 1.061 0 0 1-1.251-1.316l.031-4.622h-1.23C12.47 31.084 9 28.372 9 23.97A7.862 7.862 0 0 1 16.75 16h15.5A7.862 7.862 0 0 1 40 23.97c0 4.402-3.47 7.114-7.75 7.114zM16.531 20.938a2.594 2.594 0 1 0 2.594 2.594 2.594 2.594 0 0 0-2.594-2.594zm7.969-.031a2.594 2.594 0 1 0 2.594 2.593 2.594 2.594 0 0 0-2.594-2.594zm7.969.031a2.594 2.594 0 1 0 2.594 2.594 2.594 2.594 0 0 0-2.594-2.594z" fill="#fff" fill-rule="evenodd"/></svg>',icon_bot_clear:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M17 17.001v2H1v-2zm6-6v2H1v-2zM17 5v2.001H1v-2z"/></svg>',icon_bot_collapse:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4 13h16v-2H4z"/></svg>',icon_bot_keyboard:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0zm0 0h24v24H0V0z"/><path d="M20 7v10H4V7h16m0-2H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2zm0 3h2v2h-2zM8 8h2v2H8zm0 3h2v2H8zm-3 0h2v2H5zm0-3h2v2H5zm3 6h8v2H8zm6-3h2v2h-2zm0-3h2v2h-2zm3 3h2v2h-2zm0-3h2v2h-2z"/></svg>',icon_bot_logo:'<svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" width="24" height="24" viewBox="0 0 24 24"><path class="svg-icon16" d="M18 16.99h-6.267L8 21.125a1.119 1.119 0 0 1-1.021-1.36V16.99H6a5.849 5.849 0 0 1-6-5.87A6.061 6.061 0 0 1 6 5h12a6.061 6.061 0 0 1 6 6.12 5.849 5.849 0 0 1-6 5.87zM6 9a2 2 0 1 0 2 2 2 2 0 0 0-2-2zm6 0a2 2 0 1 0 2 2 2 2 0 0 0-2-2zm6 0a2 2 0 1 0 2 2 2 2 0 0 0-2-2z"/></svg>',icon_bot_message_bubble:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 18"><path d="M18 12.99h-6.267L8 17.125a1.119 1.119 0 0 1-1.021-1.36V12.99H6a5.849 5.849 0 0 1-6-5.87A6.061 6.061 0 0 1 6 1h12a6.061 6.061 0 0 1 6 6.12 5.849 5.849 0 0 1-6 5.87z" fill="#d1d1d1"/><path d="M4 7a2 2 0 1 0 4 0 2 2 0 1 0-4 0" style="animation-name:dotScaleleft;animation-duration:1s;animation-iteration-count:infinite;transform-origin:20%;animation-delay:0s" fill="#fff"/><path d="M10 7a2 2 0 1 0 4 0 2 2 0 1 0-4 0" style="animation-name:dotScalecenter;animation-duration:1s;animation-iteration-count:infinite;transform-origin:43%;animation-delay:.2s" fill="#fff"/><path d="M16 7a2 2 0 1 0 4 0 2 2 0 1 0-4 0" style="animation-name:dotScaleright;animation-duration:1s;animation-iteration-count:infinite;transform-origin:70%;animation-delay:.4s" fill="#fff"/><style>@keyframes dotScaleleft{0%,to{transform:scale(1)}50%{transform:scale(1.25)}}@keyframes dotScalecenter{0%,to{transform:scale(1)}50%{transform:scale(1.25)}}@keyframes dotScaleright{0%,to{transform:scale(1)}50%{transform:scale(1.25)}}</style></svg>',icon_bot_mic:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7 23v-2h4v-2.062C7.06 18.444 4 15.073 4 11h2c0 3.309 2.691 6 6 6s6-2.691 6-6h2c0 4.072-3.059 7.444-7 7.938V21h4v2h-6zm5-22c2.206 0 4 1.794 4 4v6c0 2.206-1.794 4-4 4s-4-1.794-4-4V5c0-2.206 1.794-4 4-4zm0 2c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2s2-.897 2-2V5c0-1.103-.897-2-2-2z"/></svg>',icon_bot_next:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8 17.65L9.739 19 16 12 9.739 5 8 6.35 13.054 12z"/></svg>',icon_bot_previous:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M16 17.65L14.261 19 8 12l6.261-7L16 6.35 10.946 12z"/></svg>',icon_bot_send:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22.355 1.065l.043.02a.993.993 0 01.294.195l.015.015a1.02 1.02 0 01.204.292l.009.022a.97.97 0 01.03.704l-.006.02-7 20c-.3.854-1.49.903-1.858.075l-3.844-8.648-8.648-3.844c-.828-.368-.78-1.559.076-1.858l20-7 .019-.007a.997.997 0 01.041-.012l-.06.02a.87.87 0 01.145-.04l.017-.003a.967.967 0 01.523.05zm-2.747 4.743l-7.416 7.416 2.697 6.067zm-1.415-1.415L4.711 9.113l6.066 2.696z"/></svg>',icon_bot_share_audio:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M22 2v20H2V2zm-2 2H4v16h16zm-3 1.674V14a2 2 0 11-2.15-1.995L15 12V8.326l-5 1.428V16a2 2 0 11-2.15-1.995L8 14V8.246z"/></svg>',icon_bot_share_media:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M22 2v16h-4v4H2V6h4V2zm-9.036 12.378L6.93 20H16v-2.585zM16 8H4v11.999l9.036-8.377L16 14.585zm4-4H8v2h10v10h2zM7 9a2 2 0 110 4 2 2 0 010-4z"/></svg>',icon_bot_share_file:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M13.414 2L17 5.586V7h.414L21 10.586V22H7v-4H3V2zM17 9.414V18H9v2h10v-8.586zm-2-3L12.586 4H5v12h10zM13 11v2H7v-2zm-2-4v2H7V7z"/></svg>',icon_bot_share_location:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z"/><circle cx="12" cy="9" r="2.5"/></svg>',icon_bot_speech_mute:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M1.707.293l22 22-1.414 1.414L12 13.414V21l-6.35-5.114H1V7.954h4.65l.5-.39L.293 1.707zM19.67 4.446c2.119 1.967 3.302 4.613 3.33 7.452a10.363 10.363 0 01-1.392 5.295l-1.476-1.476c.58-1.18.88-2.472.868-3.8-.023-2.29-.981-4.43-2.697-6.025zM7.583 8.996l-1.232.955H3v3.964h3.351L10 16.875v-5.461zm8.051-1.68C17.15 8.547 17.991 10.21 18 11.999c.003.482-.055.956-.17 1.416l-1.86-1.86c-.133-1.017-.691-1.964-1.604-2.706zM12 3v4.586L9.424 5.01z"/></svg>',icon_bot_speech_unmute:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 3v18l-6.35-5.114H2V7.954h4.65zm5.67 1.446c2.119 1.967 3.302 4.613 3.33 7.452.029 2.904-1.15 5.658-3.316 7.75l-1.396-1.421c1.772-1.71 2.735-3.95 2.712-6.31-.023-2.29-.981-4.43-2.697-6.025zM11 7.125L7.351 9.95H4v3.964h3.351L11 16.875zm4.634.19C17.15 8.548 17.991 10.212 18 12c.01 1.806-.828 3.5-2.358 4.771l-1.284-1.519c1.065-.885 1.65-2.037 1.642-3.242-.006-1.187-.587-2.309-1.634-3.16z"/></svg>'}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;var i=function(){function e(){}return e.GEOLOCATION_REQUEST_DENIED=1,e.CHAT_SCROLL_DELAY=300,e.WEBSOCKET_READY_STATE=["CONNECTING","OPEN","CLOSING","CLOSED"],e.WEBSOCKET_CLOSE_EVENT={CODE:{ABNORMAL_CLOSURE:1006}},e.FILE_SIZE_LIMIT_EXCEEDED=413,e.UNSUPPORTED_FILE_TYPE=415,e.FILE_SIZE_METADATA_HEADER="x-oda-meta-file-size",e.BIT_MULTIPLIER=1024,e.MAX_SUGGESTIONS_COUNT=5,e.MIN_SUGGESTIONS_COUNT=1,e}();t.Constants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=function(){function e(e){this.utils=e}return e.prototype.addClass=function(e){this.element.classList.add(this.utils.getCssClassWithPrefix(e))},e.prototype.hide=function(e){void 0===e&&(e=!0),e?(this._orgDisplayStyle=this.element.style.display,this.element.style.display="none"):this.element.style.display=this._orgDisplayStyle},e.prototype.remove=function(){this.element.remove()},e.prototype.appendToElement=function(e){e.appendChild(this.element)},e.prototype.prependToElement=function(e){var t=e.firstChild;t?e.insertBefore(this.element,t):e.appendChild(this.element)},e.prototype.appendContentChildElement=function(e){this._getContentElement().appendChild(e)},e.prototype.appendContentChild=function(e){this._getContentElement().appendChild(e.element)},e.prototype._getContentElement=function(){return this.element},e}();t.Component=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentComponent=void 0;var i=function(){function e(t,n){this.utils=n,this._title=e.capitalize(t.type)}return e.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.prototype.createMessageElement=function(e,t){var n=this.utils.createDiv(["attachment-message"]),i=this.utils.createDiv(["attachment-icon"]);i.style.backgroundImage="url('"+e+"')";var o=this.utils.createDiv(["attachment-fileName"]),s=this.utils.createSpan(["attachment-file"]);return s.innerHTML=t,o.appendChild(s),n.appendChild(i),n.appendChild(o),n},e}();t.AttachmentComponent=i},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ChatEvent=void 0,function(e){e.CLICK_AUDIO_RESPONSE_TOGGLE="click:audiotoggle",e.CLICK_ERASE="click:erase",e.CLICK_VOICE_TOGGLE="click:voicetoggle",e.DESTROY="destroy",e.MESSAGE="message",e.MESSAGE_RECEIVED="message:received",e.MESSAGE_SENT="message:sent",e.NETWORK="networkstatuschange",e.READY="ready",e.UNREAD="unreadCount",e.WIDGET_CLOSED="widget:closed",e.WIDGET_OPENED="widget:opened"}(i||(i={})),t.ChatEvent=i},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ISkillMessageSource=void 0,function(e){e.AGENT="AGENT",e.BOT="BOT"}(i||(i={})),t.ISkillMessageSource=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webApi=void 0,t.webApi={getBrowserLocale:function(){return navigator.language},getLocales:function(){var e;return(null===(e=navigator.languages)||void 0===e?void 0:e.map((function(e){return e.toLowerCase()})))||[]},isStorageAvailable:function(e){return i(e)},isLocationServiceAvailable:function(){return navigator&&navigator.geolocation},getCurrentLocation:function(){return t.webApi.isLocationServiceAvailable()?new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){e(t)}),(function(e){t(e)}),{timeout:5e3})})):Promise.reject("Location service not available.")}};var i=function(e){var t;try{t=window[e];var n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}},function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.createUserTextMessage=t.createUserMessage=t.createBotMessage=void 0;var o=n(3);t.createBotMessage=function(e,t,n,i){return{date:n,from:e,isRead:i,messagePayload:t}};t.createUserMessage=function(e,t,n,o){var s,r;if(e.type?r={date:n,isRead:o,messagePayload:e}:e.messagePayload&&(r=e),r.userId=t,null===(s=r.messagePayload)||void 0===s?void 0:s.metadata){var a=r.messagePayload,c=a.metadata,l=i(a,["metadata"]);r.messagePayload=l,r.metadata=c}return r};t.createUserTextMessage=function(e,t){var n={text:e,type:o.PAYLOAD_TYPE.TEXT},i={date:new Date,isRead:!0,messagePayload:n};return t&&(i.sdkMetadata={speechId:t}),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionComponentFactory=void 0;var i=n(5),o=n(26),s=n(27),r=n(28),a=n(29),c=n(18),l=n(7),h=function(){function e(){}return e.fromActionPayload=function(t,n,l,h,u){switch(n.type){case i.ACTION_TYPE.POSTBACK:return new r.PostbackActionComponent(t,n);case i.ACTION_TYPE.URL:return new c.UrlActionComponent(t,n,l,u);case i.ACTION_TYPE.LOCATION:return new s.LocationActionComponent(t,n);case i.ACTION_TYPE.CALL:return new o.CallActionComponent(t,n);case i.ACTION_TYPE.SHARE:return new a.ShareActionComponent(t,n,h);default:return e.logger.error("Payload contains wrong action type:"+n.type),null}},e.logger=new l.Logger("ActionComponentFactory"),e}();t.ActionComponentFactory=h},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.UrlActionComponent=void 0;var s=function(e){function t(t,n,i,o){void 0===i&&(i=!1);var s=e.call(this,t,n)||this;return s._openInWindow=i,s._linkHandler=o,s._url=n.url,s}return o(t,e),t.prototype.render=function(){var t=e.prototype.render.call(this);if(t.classList.add(this.utils.getCssClassWithPrefix("action-url")),t.classList.add(this.utils.getCssClassWithPrefix("action-postback")),this._url){var n=this.utils.createAnchor(this._url,null,[],this._openInWindow,this._linkHandler);t.onclick=function(){n.click()}}return t},t.prototype.getEventPayload=function(){return Promise.resolve(this._url)},t}(n(6).ActionComponent);t.UrlActionComponent=s},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ATTACHMENT_TYPE=void 0,function(e){e.IMAGE="image",e.VIDEO="video",e.AUDIO="audio",e.FILE="file"}(i||(i={})),t.ATTACHMENT_TYPE=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var i=n(0),o=function(){function e(e){this.settings=e}return e.prototype.clone=function(e){return JSON.parse(JSON.stringify(e))},e.prototype.linkify=function(t,n){var o,s=this;return(n=n||{}).embeddedHTML||(t=i.utils.sanitizeText(t)),o=null==(o=null==t?void 0:t.replace(i.utils.resetRegex(e.REGEX_HTTPS),(function(e,t,i){if(t)return e;var o=n.embeddedVideo?s.getYouTubeVideoId(i):null;return o?s.getEmbeddedYouTubeVideoString(o):'<a href="'+i+'" target="_blank">'+i+"</a>"})))?void 0:o.replace(i.utils.resetRegex(e.REGEX_WWW),(function(e,t,i,o){if(t||i)return e;var r=n.embeddedVideo?s.getYouTubeVideoId("https://"+i):null;return r?s.getEmbeddedYouTubeVideoString(r):'<a href="'+o+'" target="_blank">'+o+"</a>"}))},e.prototype.getYouTubeVideoId=function(t){var n=null;return t.replace(i.utils.resetRegex(e.REGEX_YOUTUBE),(function(e,t,i){return(null==i?void 0:i.length)&&(n=i),e})),n},e.prototype.getEmbeddedYouTubeVideoString=function(e){return'<iframe width="100%" src="https://www.youtube.com/embed/'+e+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'},e.prototype.getCssClassWithPrefix=function(e){return this.settings.name+"-"+e},e.prototype.createButton=function(e){var t=document.createElement("button");return t.type="button",this.addClasses(t,e),t},e.prototype.createAnchor=function(e,t,n,i,o){void 0===i&&(i=!1);var s=document.createElement("a");s.rel="noreferrer noopener";var r=!1;return e&&(s.href=e),o&&(o.onclick&&(s.onclick=o.onclick.bind(s),r=!0),o.target&&(s.target=o.target,r=!0)),r||(i?s.addEventListener("click",(function(t){return window.open(e,"","height=450px,width=800px,menubar,toolbar,personalbar,status,resizable,noopener,noreferrer"),t.preventDefault(),t.stopPropagation(),!1})):s.target="_blank"),t?s.innerText=t:e&&(s.innerText=e),this.addClasses(s,n),s},e.prototype.createDiv=function(e){var t=document.createElement("div");return this.addClasses(t,e),t},e.prototype.createElementFromString=function(e,t){var n=this,i=document.createElement("div");return i.innerHTML=e.trim(),t&&t.forEach((function(e){return i.firstElementChild.classList.add(n.getCssClassWithPrefix(e))})),i.firstElementChild},e.prototype.createSpan=function(e){var t=document.createElement("span");return this.addClasses(t,e),t},e.prototype.createInput=function(e,t){var n=document.createElement("input");return this.addClasses(n,e),t&&(n.type=t),n},e.prototype.createTextArea=function(e){var t=document.createElement("TEXTAREA");return this.addClasses(t,e),t},e.prototype.createImage=function(e,t,n){var i=document.createElement("img");return e&&(i.src=e),n&&(i.alt=n),this.addClasses(i,t),i},e.prototype.createAudio=function(e,t,n){var i=document.createElement("audio");return e&&(i.src=e),i.autoplay=void 0!==n&&n,this.addClasses(i,t),i},e.prototype.createVideo=function(e,t,n){var i=document.createElement("video");return e&&(i.src=e),i.autoplay=void 0!==n&&n,this.addClasses(i,t),i},e.prototype.createWrappedSvg=function(e,t){var n=this.createDiv(t);return n.appendChild(e),n},e.prototype.createHTML=function(e){var t=this.createDiv();return t.innerHTML=e,t},e.prototype.createLabel=function(e,t){var n=document.createElement("label");return n.textContent=e,this.addClasses(n,t),n},e.prototype.createStyle=function(e){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(e)),t},e.prototype.addStyleToHTML=function(e){window&&document.head.appendChild(e)},e.prototype.addClasses=function(e,t){if(e.dir="auto",t)for(var n=0,i=t;n<i.length;n++){var o=i[n];e.classList.add(this.getCssClassWithPrefix(o))}return e},e.REGEX_HTTPS=/((?:href|src)\s*=\s*['"])?(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,e.REGEX_WWW=/((?:href|src)\s*=\s*['"])?(\/\/)?(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,e.REGEX_YOUTUBE=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/gi,e}();t.Utils=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechRecognitionService=t.IVoiceRecognitionEvent=void 0;var i,o=n(8),s=n(0),r=n(4);!function(e){e.FINAL_RESULT="finalResult",e.PARTIAL_RESULT="partialResult"}(i||(i={})),t.IVoiceRecognitionEvent=i;var a=function(){function e(){this.speechRoute="/voice/stream/recognize",this.speechDomain="generic",this.started=!1,this.BUFF_SIZE=4096,this.microphoneStreamBuffer=[],this.connectionStatus=o.CONNECTION_STATE.CLOSED,this.isFirstFrame=!0,this.filterBuffer=[],this.LP_48000_TO_16000_FIR=[-25033838264794034e-21,-3645156113737857e-20,-11489993827892933e-21,393243788874656e-19,6998419352067277e-20,37556691270439976e-21,-476966455345305e-19,-.00011379935461751734,-8400957697117619e-20,4208817777607469e-20,.00016391587447478332,.00015508372993570357,-1253765788919669e-20,-.00021258262011091092,-.0002524059896175195,-51874329668708116e-21,.0002479230009768214,.00037351534477673157,.00016157590781788105,-.0002541085239198603,-.000510486865332593,-.0003246104617540939,.00021219136947965464,.0006488877825604561,.0005444416935293036,-.0001016639071691704,-.0007673001147209819,-.0008176720912938691,-972696982411551e-19,.0008376185852528038,.0011319450250252222,.0004008193339799052,-.0008262743020160207,-.0014643282305934196,-.0008183365045047033,.0006964471772153777,.001780467922489105,.0013489288090360295,-.00041122152287042,-.0020347535966250413,-.0019782994815083733,-6247794246099269e-20,.002171643809964705,.0026761621389245617,.00074944268608935,-.00212817775887288,-.003394541347147186,-.0016615884301227524,.001837545335885159,.004067170702246546,.0027936171643976352,-.001233420727213658,-.004610035314537476,-.004119319153202972,.00025459137646049936,.00492286494534436,.005588805700369816,.001150762425755883,-.004891042781491068,-.0071267634777626675,-.003021979039818941,.00438688631315642,.008631467181982988,.005385139236634672,-.003268406079325266,-.009973661255235284,-.008256256502745316,.0013719935383757782,.010993210336541666,.011651337116264694,.0015082475865128093,-.01148872195209017,-.015609515327517686,-.005671504441670989,.011188303272599716,.02024519058502148,.011637590928971467,-.009667754909210324,-.025878090076785515,-.020500381603699786,.006098908137700642,.033428666116203716,.03513487017573178,.001719739622764723,-.046085580848361105,-.06623078150315037,-.023349941728869696,.08292213207159124,.21069217442624302,.2973829711397418,.2973829711397419,.21069217442624305,.08292213207159124,-.023349941728869693,-.06623078150315037,-.046085580848361105,.0017197396227647225,.03513487017573178,.033428666116203716,.006098908137700641,-.020500381603699783,-.025878090076785508,-.009667754909210326,.011637590928971469,.020245190585021472,.011188303272599716,-.00567150444167099,-.015609515327517682,-.01148872195209017,.001508247586512809,.011651337116264699,.010993210336541666,.0013719935383757782,-.008256256502745314,-.009973661255235283,-.0032684060793252657,.00538513923663467,.008631467181982988,.004386886313156419,-.0030219790398189413,-.0071267634777626675,-.0048910427814910715,.0011507624257558842,.005588805700369813,.00492286494534436,.00025459137646049936,-.004119319153202973,-.004610035314537475,-.0012334207272136583,.002793617164397636,.004067170702246546,.0018375453358851592,-.0016615884301227509,-.0033945413471471847,-.0021281777588728797,.0007494426860893505,.0026761621389245612,.0021716438099647056,-6247794246099253e-20,-.001978299481508373,-.0020347535966250404,-.00041122152287042,.0013489288090360292,.0017804679224891048,.0006964471772153777,-.0008183365045047026,-.00146432823059342,-.0008262743020160207,.0004008193339799063,.0011319450250252222,.0008376185852528037,-9726969824115494e-20,-.0008176720912938694,-.0007673001147209783,-.00010166390716916983,.0005444416935293033,.0006488877825604562,.0002121913694796546,-.00032461046175409424,-.000510486865332593,-.00025410852391986036,.0001615759078178811,.0003735153447767315,.00024792300097682137,-5187432966870808e-20,-.0002524059896175194,-.00021258262011091095,-1253765788919669e-20,.0001550837299357036,.0001639158744747833,42088177776074685e-21,-8400957697117623e-20,-.00011379935461751733,-4769664553453051e-20,3755669127044002e-20,699841935206728e-19,393243788874656e-19,-11489993827892933e-21,-3645156113737856e-20,-2503383826479402e-20],this.LP_44100_TO_16000_FIR=[-5044267067893139e-21,5738740247594612e-21,1611195555688156e-20,10560179594562795e-21,-1242816862904201e-20,-3084430704328611e-20,-18160396924882423e-21,2303124169528074e-20,5216612702894834e-20,2806026886746509e-20,-389608521587068e-19,-8174245278012476e-20,-4037543061985353e-20,619375276294956e-19,.00012143092661620545,55083199655424166e-21,-9401891583478883e-20,-.00017326981522755043,-7198069055926206e-20,.0001376274218691789,.00023946132645647525,9064030545698025e-20,-.00019557611633250834,-.0003223511502826996,-.00011036322783022617,.0002710935667931249,.00042440564349633953,.00013013140955365376,-.00036784896615780913,-.0005481886438481025,-.00014855826094166272,.0004899798946967381,.000696340560985472,.00016383778624615643,-.0006421263408051642,-.0008715631880363658,-.00017369118859371453,.000829476349448821,.0010766146787146871,.00017530890385814463,-.0010578310750603923,-.001314320458073489,-.0001652844648711556,.0013337004262191077,.0015876076783199174,.000139534308084411,-.0016644454627712116,-.001899573527380014,-9319422024995832e-20,.002058491185395933,.0022536018141979036,20477911370491685e-21,-.0025256449668619525,-.0026535487754524955,8552498376473957e-20,.0030775744811722015,.0031040297261921,-.00023314744969763122,-.003728529808331677,-.003610856230113392,.000432598472497653,.0044964472481822506,.004181705019767344,-.0006966685466235378,-.005404666489478738,-.00482715710731867,.0010418556659416306,.006484667519607787,.00556235368742558,-.0014902159613265254,-.007780573986407925,-.0064097301786953595,.002072517010858728,.009356870546119134,.0074037416266333166,-.00283386009764953,-.011312323822665827,-.008599512596140524,.003844300507349054,.013806774337071994,.01008985372973804,-.005220460312862638,-.01711716324115331,-.01204196749753927,.007174046245357611,.021768247992024713,.01478690833035584,-.010136389804721707,-.02888735624896028,-.019078400739739057,.015146805312378952,.041410446665863104,.027068163980255515,-.025512027260482153,-.07011218378743589,-.04829678433503421,.06041368701604651,.21199607414538668,.3213532652447261,.3213532652447261,.21199607414538668,.060413687016046526,-.04829678433503422,-.07011218378743589,-.025512027260482153,.027068163980255515,.041410446665863104,.015146805312378952,-.019078400739739057,-.02888735624896028,-.010136389804721703,.01478690833035584,.021768247992024713,.007174046245357611,-.01204196749753927,-.01711716324115331,-.005220460312862639,.010089853729738038,.013806774337071994,.0038443005073490553,-.008599512596140524,-.011312323822665827,-.0028338600976495314,.007403741626633317,.009356870546119134,.002072517010858727,-.006409730178695359,-.007780573986407925,-.001490215961326526,.005562353687425577,.006484667519607787,.0010418556659416256,-.004827157107318673,-.005404666489478739,-.0006966685466235378,.004181705019767345,.004496447248182251,.0004325984724976533,-.003610856230113392,-.003728529808331677,-.0002331474496976315,.0031040297261921003,.003077574481172201,8552498376473897e-20,-.002653548775452496,-.002525644966861952,2047791137049164e-20,.002253601814197904,.002058491185395933,-9319422024995909e-20,-.001899573527380014,-.0016644454627712118,.00013953430808441038,.0015876076783199174,.0013337004262191077,-.0001652844648711556,-.0013143204580734896,-.0010578310750603925,.00017530890385814333,.0010766146787146878,.0008294763494488195,-.00017369118859371463,-.00087156318803637,-.0006421263408051633,.00016383778624615698,.0006963405609854716,.0004899798946967381,-.00014855826094166245,-.0005481886438481027,-.00036784896615780924,.00013013140955365368,.00042440564349633964,.00027109356679312505,-.00011036322783022619,-.0003223511502826996,-.00019557611633250842,9064030545698017e-20,.00023946132645647525,.00013762742186917883,-7198069055926207e-20,-.0001732698152275505,-9401891583478886e-20,5508319965542416e-20,.00012143092661620549,6193752762949557e-20,-4037543061985352e-20,-8174245278012477e-20,-38960852158706805e-21,28060268867465078e-21,52166127028948336e-21,2303124169528077e-20,-18160396924882423e-21,-30844307043286126e-21,-12428168629042018e-21,10560179594562806e-21,1611195555688157e-20,5738740247594605e-21,-5044267067893138e-21],this.setupMediaDevices()}return e.getInstance=function(){return this._service||(this._service=new e),this._service},e.prototype.init=function(e,t,n){var i=this;return this.settings=e,this.authTokenService=n,this.serverConfig=t,this.isClientAuthEnabled=!!n,new Promise((function(e,t){i.buildSpeechRequestUrl().then((function(t){i.requestUrl=t,e()})).catch((function(e){t(e)}))}))},e.prototype.startRecording=function(e,t,n){var i,a,c=this.settings.i18n[this.settings.locale];return this.requestUrl?s.utils.getValues(r.SPEECH_LOCALE).indexOf(this.serverConfig.locale)<0?Promise.reject(new Error(c.errorSpeechUnsupportedLocale)):(null===(i=this.connection)||void 0===i?void 0:i.readyState)===o.CONNECTION_STATE.CLOSING||(null===(a=this.connection)||void 0===a?void 0:a.readyState)===o.CONNECTION_STATE.CONNECTING?Promise.reject(new Error(c.errorSpeechMultipleConnection)):(this.onSpeechRecognition=this.getCallbackImpl(e),this.onSpeechNetworkChange=this.getCallbackImpl(t),this.onAnalyserReady=this.getCallbackImpl(null==n?void 0:n.onAnalyserReady),this.onAnalyserFrequencies=this.getCallbackImpl(null==n?void 0:n.onAnalyserFrequencies),this.microphoneStreamBuffer=[],this.getAudioInput()?this.startRecordingCordova():this.startRecordingWeb()):Promise.reject(new Error(c.errorSpeechInvalidUrl))},e.prototype.stopRecording=function(){this.connection?(this.stopMicrophone(),this.connection.readyState===o.CONNECTION_STATE.OPEN&&this.connection.close()):this.setConnectionStatus(o.CONNECTION_STATE.CLOSED)},e.prototype.setSpeechLocale=function(e){var t=this;this.serverConfig.locale=e,this.buildSpeechRequestUrl().then((function(e){t.requestUrl=e}))},e.prototype.isInitialized=function(){return!!this.settings},e.prototype.isRecording=function(){return this.started},e.prototype.getCallbackImpl=function(e){return e&&"function"==typeof e?e:function(){}},e.prototype.startRecordingWeb=function(){var e=this;return new Promise((function(t,n){navigator.mediaDevices?e.started?t():navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0}}).then((function(n){e.audioContext=new AudioContext,e.microphoneStream=e.audioContext.createMediaStreamSource(n),e.startMicrophone(),t()})).catch((function(e){n(e)})):n(new Error("getUserMedia is not implemented in this browser. Can not record voice."))}))},e.prototype.startRecordingCordova=function(){var e=this;return new Promise((function(t,n){e.started?t():e.getMicrophonePermission().then((function(){e.getAudioInput().start({audioSourceType:e.getAudioInput().AUDIOSOURCE_TYPE.VOICE_RECOGNITION||e.getAudioInput().AUDIOSOURCE_TYPE.DEFAULT,streamToWebAudio:!0}),e.audioContext=e.getAudioInput().getAudioContext(),e.microphoneStream=e.getAudioInput(),e.startMicrophone(),t()})).catch((function(e){n(e)}))}))},e.prototype.getMicrophonePermission=function(){var e=this;return new Promise((function(t,n){e.getAudioInput().checkMicrophonePermission((function(i){try{i?t():e.getAudioInput().getMicrophonePermission((function(e,i){try{e?t():n("Permission to record voice has been denied. "+i)}catch(e){n("Start after getting permission exception: "+e)}}))}catch(e){n(e)}}))}))},e.prototype.setupMediaDevices=function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),navigator.mediaDevices&&void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(n,i){t.call(navigator,e,n,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),window.AudioContext=window.AudioContext||window.webkitAudioContext},e.prototype.setRequestUrl=function(){var e=this.serverConfig,t=e.protocol,n=e.host,i=e.channelId,o=e.userId,r=e.locale,a=new URL(t+n+this.speechRoute+"/"+r+"/"+this.speechDomain),c={channelId:i,encoding:"audio/raw",userId:o};return this.isClientAuthEnabled&&(c.jwtInBody="true"),encodeURI(s.utils.setSearchParams(a,c).toString())},e.prototype.buildSpeechRequestUrl=function(){var e=this;return new Promise((function(t,n){e.isClientAuthEnabled?e.authTokenService.getToken().then((function(n){e.serverConfig.channelId=n.getClaim("channelId"),e.serverConfig.userId=n.getClaim("userId"),t(e.setRequestUrl())})).catch((function(){n(Error("Unable to fetch JWT token. Can not use speech service."))})):t(e.setRequestUrl())}))},e.prototype.connectToWebSocket=function(e){var t=new WebSocket(e);return t.onopen=this.connectionOnOpen.bind(this),t.onclose=this.connectionOnClose.bind(this),t.onmessage=this.connectionOnMessage.bind(this),t.onerror=this.connectionOnError.bind(this),t},e.prototype.connectionOnOpen=function(){var e=this;this.authTokenService?this.authTokenService.getToken().then((function(t){e.connection.send("Bearer "+t.token),e.setConnectionStatus(o.CONNECTION_STATE.OPEN),e.dumpVoiceBuffer()})):(this.setConnectionStatus(o.CONNECTION_STATE.OPEN),this.dumpVoiceBuffer())},e.prototype.connectionOnClose=function(e){this.setConnectionStatus(o.CONNECTION_STATE.CLOSED),this.started&&this.stopMicrophone()},e.prototype.connectionOnMessage=function(e){try{var t=JSON.parse(e.data);if(!t.event&&t.code)throw e;this.onSpeechRecognition&&this.onSpeechRecognition(t),(null==t?void 0:t.event)===i.FINAL_RESULT&&this.stopRecording()}catch(e){this.stopRecording()}},e.prototype.connectionOnError=function(e){this.connection.readyState===o.CONNECTION_STATE.OPEN&&this.connection.close()},e.prototype.connectionSendMessage=function(e){this.getConnectionStatus()!==o.CONNECTION_STATE.OPEN||this.connection.readyState!==o.CONNECTION_STATE.OPEN||this.microphoneStreamBuffer.length?this.microphoneStreamBuffer.push(e):this.connection.send(e)},e.prototype.setConnectionStatus=function(e){var t;this.connectionStatus=e,null===(t=this.onSpeechNetworkChange)||void 0===t||t.call(this,e)},e.prototype.getConnectionStatus=function(){return this.connectionStatus},e.prototype.dumpVoiceBuffer=function(){var e;if((null===(e=this.connection)||void 0===e?void 0:e.readyState)===o.CONNECTION_STATE.OPEN)for(;this.microphoneStreamBuffer.length>0;)this.connection.send(this.microphoneStreamBuffer.shift())},e.prototype.getAudioInput=function(){return window.audioinput},e.prototype.lanczosWindow=function(e,t){if(0===t)return 1;if(t>=e||t<=-e)return 0;var n=Math.PI*t;return e*Math.sin(n)*Math.sin(n/e)/(n*n)},e.prototype.downsampleBuffer=function(e,t,n){if(n===t)return e;if(n>t)throw new Error("Input sample rate ("+t+" kHz) is lower than output sample rate("+n+" kHz) : Use case not handled.");var i=[];if(48e3===t)i=this.LP_48000_TO_16000_FIR;else{if(44100!==t)throw new Error(t+" kHz is not an expected input sampling frequency");i=this.LP_44100_TO_16000_FIR}var o,s,r,a=t/n;this.isFirstFrame?(o=Math.floor(e.length%a),s=e.length-o,r=0===o?Array.from(e):e.slice(0,s)):(o=Math.floor((e.length+this.filterBuffer.length-i.length)%a),s=e.length+this.filterBuffer.length-i.length-o,(r=new Float32Array(this.filterBuffer.length+s)).set(this.filterBuffer),r.set(e.slice(0,s),this.filterBuffer.length));var c=Math.floor(s/a),l=new Int16Array(c);if(48e3===t)for(var h=i.length;h<r.length;h+=a){for(var u=0,d=0;d<i.length;d++)u+=r[h-d]*i[d];var p=32767*Math.max(Math.min(u,1),-1);l[(h-i.length)/a]=p}else{var g=[];for(h=i.length;h<r.length;h++){for(u=0,d=0;d<i.length;d++)u+=r[h-d]*i[d];g[h-i.length]=u}for(var f=0;f<c;f++){var m=f*a,v=Math.floor(m)-3+1,_=Math.floor(m)+3;for(u=0,h=v;h<=_;h++){u+=(h<0?g[0]:h>=g.length?g[g.length-1]:g[h])*this.lanczosWindow(3,m-h)}l[f]=32767*Math.max(Math.min(u,1),-1)}}return this.isFirstFrame?this.filterBuffer=e.slice(s-i.length-this.filterBuffer.length):this.filterBuffer=e.slice(s-i.length-(this.filterBuffer.length-i.length)),this.isFirstFrame=!1,l.buffer},e.prototype.processAudioBuffer=function(e){var t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.sampleRate,i=this.downsampleBuffer(t,n,16e3);this.processAnalyser(),this.connectionSendMessage(i)},e.prototype.processAnalyser=function(){if(this.analyser){var e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e),this.onAnalyserFrequencies(e)}},e.prototype.startMicrophone=function(){this.connection=this.connectToWebSocket(this.requestUrl),this.analyser=this.audioContext.createAnalyser(),this.analyser.smoothingTimeConstant=.8,this.analyser.fftSize=256,this.onAnalyserReady(this.analyser),this.processor=this.audioContext.createScriptProcessor(this.BUFF_SIZE,1,1),this.processor.onaudioprocess=this.processAudioBuffer.bind(this),this.microphoneStream.connect(this.analyser),this.analyser.connect(this.processor),this.processor.connect(this.audioContext.destination),this.started=!0},e.prototype.stopMicrophone=function(){var e,t,n,i,s,r=this;this.started=!1,this.connection&&(this.connection.readyState===o.CONNECTION_STATE.OPEN&&this.connectionSendMessage("Done"),this.processor&&this.processor.disconnect(),this.analyser&&this.analyser.disconnect(),this.getAudioInput()?this.getAudioInput().stop():(null===(i=null===(n=null===(t=null===(e=this.microphoneStream)||void 0===e?void 0:e.mediaStream)||void 0===t?void 0:t.getAudioTracks)||void 0===n?void 0:n.call(t))||void 0===i||i.forEach((function(e){e.stop(),r.microphoneStream.mediaStream.removeTrack(e)})),this.audioContext&&this.audioContext.close()),(null===(s=this.microphoneStream)||void 0===s?void 0:s.disconnect)&&this.microphoneStream.disconnect(),this.processor=null,this.analyser=null,this.microphoneStream=null,this.audioContext=null,this.microphoneStreamBuffer=[],this.filterBuffer=[],this.isFirstFrame=!0)},e}();t.SpeechRecognitionService=a},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Response=void 0,function(e){e[e.OK=200]="OK"}(i||(i={}));var o=function(){function e(){}return e.STATUS=i,e}();t.Response=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),o=n(24),s=n(0),r=n(25),a=n(7),c=n(4),l=n(20),h=n(52),u=n(80),d=n(21);function p(e,t){var n,p,g,f,m,v,_,b=this,y=new a.Logger("main"),C=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];1===t.length?y.error("Parameter "+t+" was not passed for "+e+" call. No action processed."):y.error("Parameters "+t.join(", ")+" were not passed for "+e+" call. No action processed.")},S=function(e){_.trigger(i.ChatEvent.MESSAGE_SENT,e),_.trigger(i.ChatEvent.MESSAGE,e)},T=function(e){_.trigger(i.ChatEvent.MESSAGE_RECEIVED,e),_.trigger(i.ChatEvent.MESSAGE,e)},x=function(e){_.trigger(i.ChatEvent.NETWORK,e)},E=function(e){if((n=new r.WidgetComponent(g,p,b.openChat.bind(b),b.closeChat.bind(b),T.bind(b),S.bind(b),b.getUnreadMessagesCount.bind(b),x.bind(b),f,m)).setEventDispatcher(_),e)try{n.embedInElement(p.targetElement)}catch(e){y.error("Target Element not specified",e)}else n.appendToElement(document.body)},w=function(e,t){if(null===document||void 0===document?void 0:document.head){var n=document.getElementById(e);if(n)n.textContent=t;else{var i=g.createStyle(t);i.id=e,document.head.appendChild(i)}}};this.connect=function(e){e&&!p.clientAuthEnabled&&(f.setSettingsProperty("channelId",e.channelId),f.setSettingsProperty("userId",e.userId));var t=f.openConnection();return t.then((function(){_.trigger(i.ChatEvent.READY)})).catch((function(){_.trigger(i.ChatEvent.READY)})),t},this.disconnect=function(e,t){f.closeConnection(e,t)},this.isConnected=function(){return f.isConnectionOpen()},this.openChat=function(){p.embedded?y.error("Chat is in embedded mode, can not perform open action."):(n.isOpen||n.showChat(),_.trigger(i.ChatEvent.WIDGET_OPENED))},this.closeChat=function(){p.embedded?y.error("Chat is in embedded mode, can not perform close action."):(n.isOpen&&n.onClose(),_.trigger(i.ChatEvent.WIDGET_CLOSED))},this.isChatOpened=function(){return n.isOpen},this.destroy=function(){p.embedded?y.error("Chat is in embedded mode, can not perform destroy action."):(n.cancelSpeechSynthesis(),p.enableSpeech&&b.stopVoiceRecording(),p.enableAttachment&&f.cancelUploadAttachments(),b.disconnect(),b.closeChat(),n.remove(),_.trigger(i.ChatEvent.DESTROY),b.off())},this.on=function(e,t){_.bind(e,t)},this.off=function(e,t){_.unbind(e,t)},this.sendAttachment=function(e){if(e)return n.uploadFile(e);C("sendAttachment","file")},this.sendMessage=function(e,t){if(e)return n.sendMessage(e,t);C("sendMessage","message")},this.updateUser=function(e,t){e?f.updateUser(e,t):C("updateUser","userDetails")},this.startVoiceRecording=function(e,t,n){return p.enableSpeech?e?t?m.startRecording(e,t,n):Promise.reject(new Error("Second callback parameter, onSpeechNetworkChange not provided. Can not start recording")):Promise.reject(new Error("First callback parameter, onSpeechRecognition not provided. Can not start recording.")):Promise.reject(new Error("Speech-to-text feature is not enabled. Initialize the widget with enableSpeech: true to use the service."))},this.stopVoiceRecording=function(){if(!p.enableSpeech)throw new Error("Speech-to-text feature is not enabled. Speech recognition service is not running.");return m.stopRecording()},this.setSpeechLocale=function(e){var t=!1;return p.speechLocale=e,(null==m?void 0:m.isInitialized())&&m.setSpeechLocale(e),s.utils.getValues(c.SPEECH_LOCALE).indexOf(e.toLowerCase())>=0&&(t=!0),t},this.setDelegate=function(e){p.delegate=e},this.getConversationHistory=function(){var e=f.getMessages();return{messages:e,messagesCount:e.length,unreadCount:f.getUnreadMessagesCount(),userId:p.userId}},this.clearConversationHistory=function(e,t){void 0===t&&(t=!0),e&&"string"!=typeof e?y.error("Argument passed in clearConversationHistory() is not of type string. Returning without execution."):(e&&0!==e.length||(e=p.userId),t&&e===p.userId?n.clearMessage():f.clearMessages(e,c.StorageType.LOCAL))},this.clearAllConversationsHistory=function(e){void 0===e&&(e=!0),f.clearAllMessage(),e&&n.clearMessage()},this.getSuggestions=function(e){return p.enableAutocomplete?e?"string"!=typeof e&&"number"!=typeof e?Promise.reject("Invalid query parameter type passed for the getSuggestions call."):n.getSuggestions(e):Promise.reject("No query parameter passed for the getSuggestions call."):Promise.reject("Autocomplete suggestions not enabled.")},this.getUnreadMessagesCount=function(){if(p.enableHeadless)return 0;var e=f.getUnreadMessagesCount();return e!==v&&(v=e,_.trigger(i.ChatEvent.UNREAD,e)),e},this.setAllMessagesAsRead=function(){p.enableHeadless||(f.markAllAsRead(),b.getUnreadMessagesCount(),n.updateNotificationBadge(0))},this.showTypingIndicator=function(){if(!p.showTypingIndicator)throw new Error("Typing indicator is configured not to be shown.");if(p.enableHeadless)throw new Error("Typing indicator cannot be shown in headless mode.");b.isConnected()&&n.showTypingIndicator()},this.setUserInputMessage=function(e){if(p.enableHeadless)throw new Error("User input cannot be set in headless mode.");n.setUserInputMessage(e)},this.setUserInputPlaceholder=function(e){if(p.enableHeadless)throw new Error("Placeholder cannot be set in headless mode.");e?n.setUserInputPlaceholder(e):C("setUserInputPlaceholder","placeholder text")},this.setHeight=function(e){if(e){var t=document.getElementsByClassName(g.getCssClassWithPrefix("widget"))[0];t&&(t.style.height=e,p.height=e)}else C("setHeight","height")},this.setWidth=function(e){if(e){var t=document.getElementsByClassName(g.getCssClassWithPrefix("widget"))[0];t&&(t.style.width=e,p.width=e)}else C("setWidth","width")},this.setSize=function(e,t){if(e||t){var n=document.getElementsByClassName(g.getCssClassWithPrefix("widget"))[0];n&&(n.style.width=e,n.style.height=t,p.width=e,p.height=t)}else C("setSize","width","height")},this.setMessagePadding=function(e){if(e)for(var t=0,n=document.getElementsByClassName(g.getCssClassWithPrefix("message-bubble"));t<n.length;t++){n[t].style.padding=e,p.messagePadding=e}else C("setMessagePadding","padding")},this.setChatBubbleIconHeight=function(e){if(e)for(var t=0,n=document.getElementsByClassName(g.getCssClassWithPrefix("chat-bubble"));t<n.length;t++){n[t].style.height=e,p.height=e}else C("setChatBubbleIconHeight","height")},this.setChatBubbleIconWidth=function(e){if(e)for(var t=0,n=document.getElementsByClassName(g.getCssClassWithPrefix("chat-bubble"));t<n.length;t++){n[t].style.width=e,p.width=e}else C("setChatBubbleIconWidth","width")},this.setChatBubbleIconSize=function(e,t){if(e||!t)for(var n=0,i=document.getElementsByClassName(g.getCssClassWithPrefix("chat-bubble"));n<i.length;n++){var o=i[n];o.style.width=e,o.style.height=t,p.width=e,p.height=t}else C("setChatBubbleIconSize","width","height")},this.setFont=function(e){if(e){var t=["font: "+e],n=s.utils.createCssClass(".oda-chat-wrapper",t)+s.utils.createCssClass(".oda-chat-left .oda-chat-message-bubble, .oda-chat-left .oda-chat-message-header, .oda-chat-left .oda-chat-message-footer, .oda-chat-left .oda-chat-card",t)+s.utils.createCssClass(".oda-chat-right .oda-chat-message-bubble",t);w("oda-chat-style-font",n),p.font=e}else C("setFont","font")},this.setFontSize=function(e){if(e){var t=["font-size: "+e],n=s.utils.createCssClass(".oda-chat-wrapper",t)+s.utils.createCssClass(".oda-chat-left .oda-chat-message-bubble, .oda-chat-left .oda-chat-message-header, .oda-chat-left .oda-chat-message-footer, .oda-chat-left .oda-chat-card",t)+s.utils.createCssClass(".oda-chat-right .oda-chat-message-bubble",t);w("oda-chat-style-font-size",n)}else C("setFontSize","fontSize")},this.setTextColor=function(e){if(e){var t=["color: "+e],n=s.utils.createCssClass(".oda-chat-wrapper",t)+s.utils.createCssClass(".oda-chat-left .oda-chat-message-bubble, .oda-chat-left .oda-chat-message-header, .oda-chat-left .oda-chat-message-footer, .oda-chat-left .oda-chat-card",t)+s.utils.createCssClass(".oda-chat-right .oda-chat-message-bubble",t);w("oda-chat-style-text",n),p.colors.text=e}else C("setTextColor","color")},this.setTextColorLight=function(e){if(e){var t=s.utils.createCssClass(".oda-chat-card-description",["color: "+e]);w("oda-chat-style-text-light",t),p.colors.textLight=e}else C("setTextColor","color")},e.enableSpeech&&(window.WebSocket?m=d.SpeechRecognitionService.getInstance():e.enableSpeech=!1),f=new u.ChatServerService(e,t,m),p=f.getChatConfiguration(),g=new l.Utils(p),_=o.generateEventDispatcher(),function(){y.debug("onLoad","load chat widget");var e=new h.StyleComponent(g,p);if(e.addStyle(e.setWidgetCssClasses()),"undefined"!=typeof window){for(var t=!1,n=document.head.children,i=0;i<n.length;i++){var o=n.item(i);if("style"===o.nodeName.toLowerCase()){document.head.insertBefore(e.render(),o),t=!0;break}}t||document.head.appendChild(e.render())}E(p.embedded)}(),s.utils.deepFreeze(this)}t.default=p,p.EVENT=i.ChatEvent,p.SPEECH_LOCALE=c.SPEECH_LOCALE,p.THEME=c.IWidgetTheme,s.utils.deepFreeze(p)},function(e,t,n){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,o++)i[o]=s[r];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.generateEventDispatcher=void 0;var o=n(13);t.generateEventDispatcher=function(){var e={},t=[];return{bind:function(n,i){!n||function(){if(!t.length)for(var e=0,n=Object.keys(o.ChatEvent);e<n.length;e++){var i=n[e];t.push(o.ChatEvent[i])}return t}().indexOf(n)<0||!i||i.constructor!==Function||(e.hasOwnProperty(n)?e[n].push(i):e[n]=[i])},trigger:function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e.hasOwnProperty(t)&&(n=null!=n?n:[],e[t].forEach((function(e){e.call.apply(e,i([null],n))})))},unbind:function(t,n){t?n?e[t]=e[t].filter((function(e){return e!==n})):e.hasOwnProperty(t)&&e[t].splice(0,e[t].length):e={}}}}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetComponent=void 0;var s=n(16),r=n(2),a=n(8),c=n(10),l=n(9),h=n(0),u=n(5),d=n(3),p=n(31),g=n(32),f=n(33),m=n(11),v=n(34),_=n(7),b=n(46),y=n(48),C=n(49),S=n(50),T=n(21),x=n(51),E=n(13),w=n(15),A=function(e){function t(t,n,i,o,s,c,l,h,u,d){var p,g=e.call(this,t)||this;return g.settings=n,g.openChat=i,g.closeChat=o,g.receiveMessage=s,g.sentMessage=c,g.getUnreadMessagesCount=l,g.onConnectionStatusChange=h,g.dataService=u,g._speechRecognitionService=d,g.NO_SPEECH_STATUS_TIMEOUT=4e3,g.FINAL_RESULT_DISPLAY_TIMEOUT=200,g._logger=new _.Logger("ChatComponent"),g._previousBotMessage=[],g._currentSessionBotMessages=[],g._consecutiveBotMessagesCount=0,g._attachmentDivs=[],g._unreadMessages=[],g.isInitMessageSent=!1,g.isExpanded=!1,g.isFirstConnectionOpen=!1,g.registerStatusCallback=function(e){g.dataService.onStatusChange=function(t){if(g._isFirstConnect&&g._loadPreviousConversations(),Number.isInteger(t)&&t!==a.CONNECTION_STATE.OPEN){g._chatFooterComponent.isDisabled()||(g._chatFooterComponent.disable(),g._logger.debug("WebSocket not open, send message button disabled")),g._disableBotMessages(g._currentSessionBotMessages),g.hideTypingIndicator();for(var n=0,i=g._attachmentDivs;n<i.length;n++){var o=i[n];g._handleUploadError(o.fileName,500,o.divId)}}else g.isFirstConnectionOpen=!0,g._sendInitMessages(),g._chatFooterComponent.isDisabled()&&(g._chatFooterComponent.disable(!1),g._logger.debug("Connection established, send message button enabled")),g._enableBotMessages();e(t),g.onConnectionStatusChange(t)}},g.element=g._createElement(),g.isOpen=n.openChatOnLoad,g.isExpanded="init"===(null===(p=n.initMessageOptions)||void 0===p?void 0:p.sendAt)||n.openChatOnLoad||n.embedded,g.isInitMessageSent=n.enableHeadless,g._isFirstConnect=!0,g._localeText=n.i18n[n.locale],g._narrationEnabled=n.enableBotAudioResponse,g._narrationEnabled&&(g._setupSpeechSynthesis(),g._narrationEnabled=!g.settings.initBotAudioMuted),"function"!=typeof h&&(g.onConnectionStatusChange=function(){}),g.settings.showTypingIndicator&&(g.typingIndicator=new S.TypingIndicatorComponent(r.MESSAGE_SIDE.LEFT,n)),g}return o(t,e),t.prototype.render=function(e){},t.prototype.embedInElement=function(e){var t=this,n=document.getElementById(e);if(!n)throw new Error("Can not embed chat widget.");var i=function(){t.chatWidgetDiv.style.width=n.clientWidth+"px",t.chatWidgetDiv.style.height=n.clientHeight+"px",t.chatWidgetDiv.style.position="inherit",t.chatWidgetDiv.style.boxShadow="none"};i(),this.appendToElement(n),this.resizeEventListener=function(){i()},window.addEventListener("resize",this.resizeEventListener)},t.prototype.showChat=function(){var e=this;this.isOpen||(this.element.classList.remove(this.utils.getCssClassWithPrefix("collapsed")),this.element.classList.add(this.utils.getCssClassWithPrefix("expanded")),this.chatWidgetDiv.classList.remove(this.utils.getCssClassWithPrefix("none")),setTimeout((function(){e._botButton.classList.add(e.utils.getCssClassWithPrefix("none"))}),250),this.isOpen=!0,this.isExpanded=!0,this._sendInitMessages(),this._updateUnreadMessages(),this._scrollToBottom(),this._chatFooterComponent.focusTextArea())},t.prototype.onClose=function(){var e=this;if(this.isOpen){this._textToSpeechCancel(),this.element.classList.remove(this.utils.getCssClassWithPrefix("expanded")),this.element.classList.add(this.utils.getCssClassWithPrefix("collapsed")),this._botButton.classList.remove(this.utils.getCssClassWithPrefix("none")),setTimeout((function(){e.chatWidgetDiv.classList.add(e.utils.getCssClassWithPrefix("none")),e._botButton.focus()}),250);var t=this.getUnreadMessagesCount();t>0?this._botButton.appendChild(this._botNotificationBadge):this._botNotificationBadge&&this._botNotificationBadge.remove(),this._botNotificationBadge.innerText=""+t,this.isOpen=!1}},t.prototype.updateNotificationBadge=function(e){this.isOpen||(e>0?this._botButton.appendChild(this._botNotificationBadge):(this._botNotificationBadge&&this._botNotificationBadge.remove(),this._unreadMessages=[]))},t.prototype.onToggleNarration=function(e){this._toggleNarration(e),this._eventDispatcher.trigger(E.ChatEvent.CLICK_AUDIO_RESPONSE_TOGGLE,e)},t.prototype.remove=function(){e.prototype.remove.call(this),this.dataService.onMessage=function(){},this.settings.embedded&&window.removeEventListener("resize",this.resizeEventListener)},t.prototype.clearMessage=function(){var e,t=!1;for(this.dataService.clearMessages(this.settings.userId),(null===(e=this.typingIndicator)||void 0===e?void 0:e.isVisible())&&(t=!0,this.hideTypingIndicator());this._conversationContainer.firstChild;)this._conversationContainer.removeChild(this._conversationContainer.lastChild);t&&this.showTypingIndicator(),this._renderMessages([],!1),this._textToSpeechCancel(),this._eventDispatcher.trigger(E.ChatEvent.CLICK_ERASE)},t.prototype.setUserInputMessage=function(e){this._chatFooterComponent.setUserInputText(e,!0)},t.prototype.setUserInputPlaceholder=function(e){this._chatFooterComponent.setUserInputPlaceholder(e)},t.prototype.triggerPostback=function(e,t){var n,i=this,o=e.match(/[a-zA-Z]+/g)[0],r=+e.match(/\d+/g)[0];if("card"===o){var a=v.MessageComponentFactory.fromMessage(this.utils,this.settings,t,this._markAsRead.bind(this));n=a.cards.length>=r?a.cards[r-1].handleOnActionTrigger(e):null}else{a=v.MessageComponentFactory.fromMessage(this.utils,this.settings,t,this._markAsRead.bind(this));n=a.handleOnActionTrigger(e)}n&&n.getEventPayload().then((function(e){var t=s.createUserMessage({postback:e,text:n.label,type:d.PAYLOAD_TYPE.POSTBACK},i.settings.userId,new Date,!0);i._sendMessageToServer(t)}))},t.prototype.onMessageActionClicked=function(e){var t=this;switch(this.onSpeechToggle(!1),e.type){case u.ACTION_TYPE.POSTBACK:this._scrollToBottom(),"none"!==this.settings.disablePastActions&&e.messageComponent.disableActions(),e.getPayload().then((function(n){var i=s.createUserMessage({postback:n,text:e.label,type:d.PAYLOAD_TYPE.POSTBACK},t.settings.userId,new Date,!0);e.label===t._localeText.retryMessage?t.dataService.retryMessage(i):t._sendMessageToServer(i)}));break;case u.ACTION_TYPE.LOCATION:this.shareUserLocation();break;case u.ACTION_TYPE.SHARE:if(navigator.share)e.getPayload().then((function(n){navigator.share({text:n,title:e.label}).then((function(){"none"!==t.settings.disablePastActions&&e.messageComponent.disableActions()}))}));else{var n=new C.StatusComponent(this.settings.i18n[this.settings.locale].shareFailureMessage,this.utils,this.settings.errorIcon).render();this._appendMessageToConversation(n),setTimeout((function(){n&&n.remove()}),this.NO_SPEECH_STATUS_TIMEOUT),this._scrollToBottom()}}},t.prototype.sendMessage=function(e,t){var n,i=!1;if(!e)return this._logger.error("No message passed to send to bot"),i;if("string"==typeof e?(n=!this.settings.enableSpeechAutoSend&&this.speechFinalResult&&e.toLowerCase().indexOf(this.speechFinalResult.text)>=0?s.createUserTextMessage(e,this.speechFinalResult.speechId):s.createUserTextMessage(e),this.speechFinalResult=null):n=e,n){var o=s.createUserMessage(n,this.settings.userId,new Date,!0);i=this._sendMessageToServer(o,t)}else this._logger.error("Can not parse payload from message",e);return i},t.prototype.uploadFile=function(e){var t=this;this._textToSpeechCancel();var n=new Promise((function(n,i){var o;if(t.settings.enableHeadless)t.dataService.uploadAttachment(e).then((function(e){n(e)})).catch((function(e){i(e)}));else{t._scrollToBottom();var s=new Date,a=(null===(o=e.name)||void 0===o?void 0:o.replace(/[\s:\'"\\/\[\]~,\.;^`()@#%\*+=$&!{}?<>|]/g,""))+1e4*(Math.random()+Date.parse(s.toDateString())+s.getTime())%1e8,l=t.utils.createDiv();if(l.id=a,t._attachmentDivs.push({divId:a,fileName:e.name}),t._appendMessageToConversation(l),e.size>t.settings.maxAttachmentFileSize*c.Constants.BIT_MULTIPLIER*c.Constants.BIT_MULTIPLIER)t._scrollToBottom(),t._handleUploadError(e.name,c.Constants.FILE_SIZE_LIMIT_EXCEEDED,a),i(t._localeText.uploadFileSizeLimitExceeded);else{var h=new b.LoadingMessageComponent(e.name,r.MESSAGE_SIDE.RIGHT,t.utils,t.settings);l.appendChild(h.render()),t._scrollToBottom(),t.dataService.uploadAttachment(e,t._handleUploadError.bind(t),a,!0).then((function(e){n(e)})).catch((function(e){i(e)}))}}}));return n.catch((function(e){t._logger.error(e)})),n},t.prototype.cancelSpeechSynthesis=function(){this._textToSpeechCancel()},t.prototype.getSuggestions=function(e){var t=this;if(!this.settings.enableAutocompleteClientCache||this.settings.enableAutocompleteClientCache&&!this._chatFooterComponent.getSuggestionsValid()){var n=this.settings.numberOfSuggestionsFromServer,i=s.createUserMessage({query:e,threshold:n,type:d.PAYLOAD_TYPE.SUGGEST},this.settings.userId,new Date,!0);return new Promise((function(e,n){t._suggestionsResolve=e,t.dataService.getSuggestions(i),setTimeout((function(){n("Request timeout. Taking too long to get suggestions.")}),1e4)}))}var o=this._filterSuggestions(this._chatFooterComponent.getSuggestions(),e);return null!=this._chatFooterComponent&&this._chatFooterComponent.displaySuggestions(o),Promise.resolve(o)},t.prototype.setEventDispatcher=function(e){this._eventDispatcher=e},t.prototype.onShareLocation=function(){this.shareUserLocation()},t.prototype.showTypingIndicator=function(){this.settings.showTypingIndicator&&(this.typingIndicator.append(this._conversationContainer),this._scrollToBottom())},t.prototype.hideTypingIndicator=function(){this.settings.showTypingIndicator&&this.typingIndicator.remove()},t.prototype.shareUserLocation=function(){var e=this;if(this._disableBotMessages(this._previousBotMessage),w.webApi.isLocationServiceAvailable()){var t=new b.LoadingMessageComponent(this._localeText.requestLocation,r.MESSAGE_SIDE.LEFT,this.utils,this.settings);this._appendMessageToConversation(t.render()),this._scrollToBottom(),w.webApi.getCurrentLocation().then((function(n){var i=n.coords,o=s.createUserMessage({location:{latitude:i.latitude,longitude:i.longitude,title:void 0},type:d.PAYLOAD_TYPE.LOCATION},e.settings.userId,new Date,!0);t.remove(),e._sendMessageToServer(o)}),(function(n){var i;switch(n.code){case n.PERMISSION_DENIED:i=e._localeText.requestLocationDeniedPermission;break;case n.POSITION_UNAVAILABLE:i=e._localeText.requestLocationDeniedUnavailable;break;case n.TIMEOUT:i=e._localeText.requestLocationDeniedTimeout;break;default:i=e._localeText.requestLocationDeniedPermission}var o=new y.MessageStringComponent(i,r.MESSAGE_SIDE.LEFT,e.utils,e.settings);t.remove(),e._appendMessageToConversation(o.render(e.settings.errorIcon))}))}else{var n=new y.MessageStringComponent(this._localeText.requestLocationDeniedUnavailable,r.MESSAGE_SIDE.LEFT,this.utils,this.settings);this._appendMessageToConversation(n.render(this.settings.errorIcon))}},t.prototype._filterSuggestions=function(e,t){for(var n=[],i=0,o=e;i<o.length;i++){var s=o[i];-1!==s.search(new RegExp(t,"i"))&&n.push(s)}return n},t.prototype._handleUploadError=function(e,t,n){var i;switch(t){case c.Constants.FILE_SIZE_LIMIT_EXCEEDED:i=e+" - "+this._localeText.uploadFileSizeLimitExceeded;break;case c.Constants.UNSUPPORTED_FILE_TYPE:i=e+" - "+this._localeText.uploadUnsupportedFileType;break;default:i=e+" - "+this._localeText.uploadFailed}var o=new y.MessageStringComponent(i,r.MESSAGE_SIDE.LEFT,this.utils,this.settings),s=document.getElementById(n);s.firstElementChild&&s.removeChild(s.firstElementChild),this._attachmentDivs=this._attachmentDivs.filter((function(e){return e.divId!==n})),s.appendChild(o.render(this.settings.errorIcon))},t.prototype._createElement=function(){var e,n=this.settings.locale,i=this.utils.createDiv(this.settings.embedded?[]:["wrapper"]);i.addEventListener("click",function(){"speechSynthesis"in window&&(speechSynthesis.cancel(),speechSynthesis.resume(),speechSynthesis.speak(new SpeechSynthesisUtterance("")))}.bind(this),{once:!0}),this.chatWidgetDiv=this.utils.createDiv(["widget"]),this.chatWidgetDiv.setAttribute("role","region"),this.chatWidgetDiv.setAttribute("aria-labelledby","oda-chat-title");var o=new g.WidgetHeaderComponent(this.utils,this.settings,this.closeChat.bind(this),this.clearMessage.bind(this),this.onToggleNarration.bind(this),this.registerStatusCallback.bind(this));if(this.chatWidgetDiv.appendChild(o.element),this.settings.embedTopStickyId)try{var s=this.utils.createDiv(["embed-sticky-top"]);s.appendChild(document.getElementById(this.settings.embedTopStickyId)),this.chatWidgetDiv.appendChild(s)}catch(e){this._logger.error("No element present with id "+this.settings.embedTopStickyId+". Can not embed pinned content.")}if(this._conversationComponent=new f.WidgetMainComponent(this.utils,this.settings),this._conversationComponent.element.id=t.CHAT_MESSAGES_PARENT_ID,this._conversationComponent.element.addEventListener("scroll",this._updateUnreadMessages.bind(this)),this._scrollContent=this.utils.createDiv(["conversation-pane"]),this.settings.embedTopScrollId)try{var r=this.utils.createDiv(["embed-scroll-top"]);r.appendChild(document.getElementById(this.settings.embedTopScrollId)),this._scrollContent.appendChild(r)}catch(e){this._logger.error("No element present with id "+this.settings.embedTopScrollId+". Can not embed scrollable content.")}var a=this.utils.createDiv("bottom"===this.settings.conversationBeginPosition?["empty-conversation-div"]:void 0);if(this._scrollContent.appendChild(a),this._conversationContainer=this.utils.createDiv(["conversation-container"]),this._conversationContainer.setAttribute("role","log"),this._conversationContainer.setAttribute("aria-live","polite"),this._conversationContainer.setAttribute("aria-atomic","false"),this._scrollContent.appendChild(this._conversationContainer),this._conversationComponent.element.appendChild(this._scrollContent),this.settings.embedBottomScrollId)try{var c=this.utils.createDiv(["embed-scroll-bottom"]);c.appendChild(document.getElementById(this.settings.embedBottomScrollId)),this._conversationComponent.element.appendChild(c)}catch(e){this._logger.error("No element present with id "+this.settings.embedBottomScrollId+". Can not embed scrollable content.")}if(this.chatWidgetDiv.appendChild(this._conversationComponent.element),this.settings.embedBottomStickyId)try{var u=this.utils.createDiv(["embed-sticky-bottom"]);u.appendChild(document.getElementById(this.settings.embedBottomStickyId)),this.chatWidgetDiv.appendChild(u)}catch(e){this._logger.error("No element present with id "+this.settings.embedBottomStickyId+". Can not embed pinned content.")}if(this._chatFooterComponent=new p.ChatFooterComponent(this.utils,this.sendMessage.bind(this),this.uploadFile.bind(this),this.settings,this.getSuggestions.bind(this),this.onSpeechToggle.bind(this),this.shareUserLocation.bind(this)),this.chatWidgetDiv.appendChild(this._chatFooterComponent.element),i.appendChild(this.chatWidgetDiv),this.settings.embedded)this.isOpen=!0,i.classList.add(this.utils.getCssClassWithPrefix("open"));else{this._botButton=this.utils.createButton(["button"]),this._botButton.title=this.settings.i18n[n].chatTitle,(null===(e=this.settings.colors)||void 0===e?void 0:e.branding)&&(l.SVG_SPRITE.icon_bot_button=l.SVG_SPRITE.icon_bot_button.replace("#025e7e",this.settings.colors.branding));var d=this.settings.botButtonIcon||l.SVG_SPRITE.icon_bot_button;if(h.utils.isSvg(d)){(v=this.utils.createElementFromString(d)).setAttribute("role","img"),v.setAttribute("aria-label",this._botButton.title);var m=this.utils.getCssClassWithPrefix("button-icon");v.classList.add(m),this._botButton.appendChild(v)}else{var v=this.utils.createImage(this.settings.botButtonIcon,["button-icon"],this.settings.i18n[n].chatTitle);this._botButton.appendChild(v)}this._botButton.onclick=this.openChat.bind(this),this._botNotificationBadge=this.utils.createDiv(["notification-badge"]);var _=this.getUnreadMessagesCount();this._botNotificationBadge.innerText=""+_,_>0&&this._botButton.appendChild(this._botNotificationBadge),i.appendChild(this._botButton),this.settings.openChatOnLoad?(i.classList.add(this.utils.getCssClassWithPrefix("expanded")),this._botButton.classList.add(this.utils.getCssClassWithPrefix("none"))):(i.classList.add(this.utils.getCssClassWithPrefix("collapsed")),this.chatWidgetDiv.classList.add(this.utils.getCssClassWithPrefix("none")))}return i},t.prototype._appendMessageToConversation=function(e){var t;this._conversationContainer.appendChild(e),(null===(t=this.typingIndicator)||void 0===t?void 0:t.isVisible())&&(this.hideTypingIndicator(),this.showTypingIndicator())},t.prototype._scrollToBottom=function(){var e=document.getElementById(t.CHAT_MESSAGES_PARENT_ID);setTimeout((function(){e&&(e.scrollTop=e.scrollHeight)}),c.Constants.CHAT_SCROLL_DELAY)},t.prototype._renderMessages=function(e,t,n){for(var i=this,o=0,s=e.length,r=0,a=e;r<a.length;r++){var c=a[r];o++;var l=v.MessageComponentFactory.fromMessage(this.utils,this.settings,c,this._markAsRead.bind(this));if(t||("none"!==this.settings.disablePastActions&&(c.from?this._previousBotMessage.push(l):(this._disableBotMessages(this._previousBotMessage),this._previousBotMessage=[])),c.from?(this._currentSessionBotMessages.push(l),this._consecutiveBotMessagesCount++):this._consecutiveBotMessagesCount=0),n){var h=document.getElementById(n);h.removeChild(h.firstElementChild),h.appendChild(l.render()),this._attachmentDivs=this._attachmentDivs.filter((function(e){return e.divId!==n}))}else{var u=l.render();this._appendMessageToConversation(u);var d={component:l,element:u};this._markMessageAsReadIfVisible(d),this._unreadMessages.push(d)}l.onActionClick=this.onMessageActionClicked.bind(this),t&&o<=s&&l.disableActions(t)}this.settings.embedded||this.isOpen||t||setTimeout((function(){var e=i.getUnreadMessagesCount();e>0&&(i._botNotificationBadge.innerText=""+e,i._botButton.appendChild(i._botNotificationBadge))}))},t.prototype._isMobileDevice=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},t.prototype.onSpeechToggle=function(e){var t=this;this._textToSpeechCancel(),this._eventDispatcher.trigger(E.ChatEvent.CLICK_VOICE_TOGGLE,e),this.settings.enableSpeech&&(e?(this._removeNoSpeechStatusMessage(),this._speechRecognitionService.startRecording(this.onSpeechRecognition.bind(this),this.onSpeechNetworkChange.bind(this),{onAnalyserFrequencies:function(e){t._chatFooterComponent.updateVisualizer(Array.from(e))}}).then((function(){t._chatFooterComponent.setVoiceRecording(!0),t._scrollToBottom()})).catch((function(e){t._chatFooterComponent.setVoiceRecording(!1);var n=new C.StatusComponent(e.message,t.utils,t.settings.errorIcon).render();t._appendMessageToConversation(n),setTimeout((function(){n.remove()}),t.NO_SPEECH_STATUS_TIMEOUT)}))):(this._speechRecognitionService.isRecording()&&this._speechRecognitionService.stopRecording(),this._chatFooterComponent.setVoiceRecording(!1)))},t.prototype.onSpeechRecognition=function(e){var t,n,i=this;if(e)switch(e.event){case T.IVoiceRecognitionEvent.FINAL_RESULT:if((null===(t=null==e?void 0:e.nbest)||void 0===t?void 0:t.length)>0)(o=e.nbest[0].utterance).length>0?(this._chatFooterComponent.setUserInputText(o),this.settings.enableSpeechAutoSend?setTimeout((function(){i._chatFooterComponent.setVoiceRecording(!1);var t=s.createUserTextMessage(i._chatFooterComponent.getUserInputText(),e.requestId);i.sendMessage(t),i._chatFooterComponent.setUserInputText("")}),this.FINAL_RESULT_DISPLAY_TIMEOUT):this.speechFinalResult={speechId:e.requestId,text:o.toLowerCase()}):this._chatFooterComponent.setUserInputText("");else this._noSpeechTimeoutStatus=new C.StatusComponent(this.settings.i18n[this.settings.locale].noSpeechTimeout,this.utils,this.settings.errorIcon).render(),this._appendMessageToConversation(this._noSpeechTimeoutStatus),setTimeout((function(){i._removeNoSpeechStatusMessage()}),this.NO_SPEECH_STATUS_TIMEOUT);break;case T.IVoiceRecognitionEvent.PARTIAL_RESULT:var o;if((null===(n=null==e?void 0:e.nbest)||void 0===n?void 0:n.length)>0)(o=e.nbest[0].utterance).length>0&&this._chatFooterComponent.setUserInputText(o)}},t.prototype.onSpeechNetworkChange=function(e){this._chatFooterComponent.setVoiceRecording(e===a.CONNECTION_STATE.OPEN)},t.prototype._disableBotMessages=function(e){for(var t=0,n=e;t<n.length;t++){n[t].disableActions()}},t.prototype._enableBotMessages=function(){var e=this._currentSessionBotMessages;"all"!==this.settings.disablePastActions&&"postback"!==this.settings.disablePastActions||e.splice(0,e.length-this._consecutiveBotMessagesCount);for(var t=0,n=e;t<n.length;t++){n[t].enableActions()}},t.prototype._markAsRead=function(e){this.dataService.markAsRead(e)},t.prototype._onMessageReceived=function(e,t){this._logger.debug("onMessageReceived",e),this.hideTypingIndicator(),this._scrollToBottom(),e&&(this._renderMessages([e],!1,t),this._scrollToBottom(),e.from&&this._textToSpeechSpeak(v.MessageComponentFactory.extractUtteranceText(e,this.settings.i18n[this.settings.locale])))},t.prototype._onOriginalMessageReceived=function(e){this.receiveMessage(e)},t.prototype._onFinalMessageSent=function(e){this.sentMessage(e)},t.prototype._toggleNarration=function(e){e?this._textToSpeechResume():this._textToSpeechCancel(),this._narrationEnabled=e},t.prototype._onSuggestionsReceived=function(e){var t;(null===(t=null==e?void 0:e.suggestions)||void 0===t?void 0:t.length)?(this._suggestionsResolve(e.suggestions),null!=this._chatFooterComponent&&this._chatFooterComponent.displaySuggestions(e.suggestions)):this._suggestionsResolve([])},t.prototype._removeNoSpeechStatusMessage=function(){this._noSpeechTimeoutStatus&&(this._noSpeechTimeoutStatus.remove(),this._noSpeechTimeoutStatus=void 0)},t.prototype._sendMessageToServer=function(e,t){this._scrollToBottom(),this._textToSpeechCancel();var n=this.dataService.send(e,null,null,t);return this._isMobileDevice()||this._chatFooterComponent.focusTextArea(),this._chatFooterComponent.getSuggestionsValid(),n?this.showTypingIndicator():this.hideTypingIndicator(),n},t.prototype._updateUnreadMessages=function(){var e=this;if(this.isOpen){var t=[];this._unreadMessages.forEach((function(n){e._markMessageAsReadIfVisible(n)||t.push(n)})),this._unreadMessages=t}},t.prototype._markMessageAsReadIfVisible=function(e){var t=!1;return this.isOpen&&h.utils.isDivVisible(this._conversationComponent.element,e.element)&&(e.component.updateMarkAsRead(),t=!0),t},t.prototype._loadPreviousConversations=function(){this._isFirstConnect=!1;var e=this.dataService.loadChat();this.settings.enableLocalConversationHistory&&e.length>0&&(this._renderMessages(e.slice(),!0),this.settings.showPrevConvStatus&&(this._appendMessageToConversation(new C.StatusComponent(this.settings.i18n[this.settings.locale].previousChats,this.utils).render()),this._appendMessageToConversation(document.createElement("hr"))),this._scrollToBottom()),this.dataService.onMessage=this._onMessageReceived.bind(this),this.dataService.onOriginalMessage=this._onOriginalMessageReceived.bind(this),this.dataService.onFinalSentMessage=this._onFinalMessageSent.bind(this),this.dataService.onSuggestions=this._onSuggestionsReceived.bind(this)},t.prototype._sendInitMessages=function(){if(!this.isInitMessageSent&&this.isExpanded&&this.isFirstConnectionOpen){if(this.settings.initUserProfile&&this.dataService.send(this.settings.initUserProfile,null,null,{delegate:!1}),this.settings.initUserHiddenMessage){var e=this.settings.initUserHiddenMessage,t=void 0;"string"==typeof e?t=s.createUserTextMessage(e):(null==e?void 0:e.type)!==d.PAYLOAD_TYPE.TEXT&&(null==e?void 0:e.type)!==d.PAYLOAD_TYPE.LOCATION||(t=s.createUserMessage(e,this.settings.userId,new Date,!0)),this.dataService.send(t,null,null,{hidden:!0})}this.isInitMessageSent=!0}},t.prototype._setupSpeechSynthesis=function(){var e;try{this._speechSynthesisService=x.SpeechSynthesisService.getInstance(),(null===(e=this.settings.skillVoices)||void 0===e?void 0:e.length)&&this._speechSynthesisService.setVoice(this.settings.skillVoices)}catch(e){this._narrationEnabled=!1}},t.prototype._textToSpeechSpeak=function(e){this._narrationEnabled&&this._speechSynthesisService&&this._speechSynthesisService.speak(e)},t.prototype._textToSpeechResume=function(){this._narrationEnabled&&this._speechSynthesisService&&this._speechSynthesisService.resume()},t.prototype._textToSpeechCancel=function(){this._narrationEnabled&&this._speechSynthesisService&&this._speechSynthesisService.cancel()},t.CHAT_MESSAGES_PARENT_ID="chat_widget_main",t}(m.Component);t.WidgetComponent=A},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CallActionComponent=void 0;var s=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._phoneNumber=n.phoneNumber,i}return o(t,e),t.prototype.render=function(){var t=e.prototype.render.call(this);t.classList.add(this.utils.getCssClassWithPrefix("action-postback")),t.classList.add(this.utils.getCssClassWithPrefix("action-call"));var n=this.utils.createAnchor("tel:"+this._phoneNumber);return this.onActionClick=function(){n.click()},t},t.prototype.getEventPayload=function(){return Promise.resolve(this._phoneNumber)},t}(n(6).ActionComponent);t.CallActionComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LocationActionComponent=void 0;var s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.render=function(){var t=e.prototype.render.call(this);return t.classList.add(this.utils.getCssClassWithPrefix("action-postback")),t.classList.add(this.utils.getCssClassWithPrefix("action-location")),t},t.prototype.getEventPayload=function(){return this.getCurrentPosition()},t.prototype.getCurrentPosition=function(){return new Promise((function(e,t){setTimeout((function(){navigator.geolocation.getCurrentPosition((function(t){e({latitude:t.coords.latitude,longitude:t.coords.longitude})}),(function(e){t(e)}))}))}))},t}(n(6).ActionComponent);t.LocationActionComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.PostbackActionComponent=void 0;var s=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._postback=n.postback,i}return o(t,e),t.prototype.render=function(){var t=e.prototype.render.call(this);return t.classList.add(this.utils.getCssClassWithPrefix("action-postback")),t},t.prototype.getEventPayload=function(){return Promise.resolve(this._postback)},t}(n(6).ActionComponent);t.PostbackActionComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ShareActionComponent=void 0;var s=function(e){function t(t,n,i){var o=e.call(this,t,n)||this;return o.shareText=i,o}return o(t,e),t.prototype.render=function(){var t=e.prototype.render.call(this);return t.classList.add(this.utils.getCssClassWithPrefix("action-postback")),t.classList.add(this.utils.getCssClassWithPrefix("action-share")),t},t.prototype.getEventPayload=function(){return Promise.resolve(this.shareText)},t}(n(6).ActionComponent);t.ShareActionComponent=s},function(e,t,n){"use strict";n.r(t),n.d(t,"assign",(function(){return c})),n.d(t,"format",(function(){return w})),n.d(t,"parse",(function(){return A})),n.d(t,"defaultI18n",(function(){return d})),n.d(t,"setGlobalDateI18n",(function(){return g})),n.d(t,"setGlobalDateMasks",(function(){return E}));var i=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,o="[^\\s]+",s=/\[([^]*?)\]/gm;function r(e,t){for(var n=[],i=0,o=e.length;i<o;i++)n.push(e[i].substr(0,t));return n}var a=function(e){return function(t,n){var i=n[e].map((function(e){return e.toLowerCase()})).indexOf(t.toLowerCase());return i>-1?i:null}};function c(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,o=t;i<o.length;i++){var s=o[i];for(var r in s)e[r]=s[r]}return e}var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["January","February","March","April","May","June","July","August","September","October","November","December"],u=r(h,3),d={dayNamesShort:r(l,3),dayNames:l,monthNamesShort:u,monthNames:h,amPm:["am","pm"],DoFn:function(e){return e+["th","st","nd","rd"][e%10>3?0:(e-e%10!=10?1:0)*e%10]}},p=c({},d),g=function(e){return p=c(p,e)},f=function(e){return e.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},m=function(e,t){for(void 0===t&&(t=2),e=String(e);e.length<t;)e="0"+e;return e},v={D:function(e){return String(e.getDate())},DD:function(e){return m(e.getDate())},Do:function(e,t){return t.DoFn(e.getDate())},d:function(e){return String(e.getDay())},dd:function(e){return m(e.getDay())},ddd:function(e,t){return t.dayNamesShort[e.getDay()]},dddd:function(e,t){return t.dayNames[e.getDay()]},M:function(e){return String(e.getMonth()+1)},MM:function(e){return m(e.getMonth()+1)},MMM:function(e,t){return t.monthNamesShort[e.getMonth()]},MMMM:function(e,t){return t.monthNames[e.getMonth()]},YY:function(e){return m(String(e.getFullYear()),4).substr(2)},YYYY:function(e){return m(e.getFullYear(),4)},h:function(e){return String(e.getHours()%12||12)},hh:function(e){return m(e.getHours()%12||12)},H:function(e){return String(e.getHours())},HH:function(e){return m(e.getHours())},m:function(e){return String(e.getMinutes())},mm:function(e){return m(e.getMinutes())},s:function(e){return String(e.getSeconds())},ss:function(e){return m(e.getSeconds())},S:function(e){return String(Math.round(e.getMilliseconds()/100))},SS:function(e){return m(Math.round(e.getMilliseconds()/10),2)},SSS:function(e){return m(e.getMilliseconds(),3)},a:function(e,t){return e.getHours()<12?t.amPm[0]:t.amPm[1]},A:function(e,t){return e.getHours()<12?t.amPm[0].toUpperCase():t.amPm[1].toUpperCase()},ZZ:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+m(100*Math.floor(Math.abs(t)/60)+Math.abs(t)%60,4)},Z:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+m(Math.floor(Math.abs(t)/60),2)+":"+m(Math.abs(t)%60,2)}},_=function(e){return+e-1},b=[null,"[1-9]\\d?"],y=[null,o],C=["isPm",o,function(e,t){var n=e.toLowerCase();return n===t.amPm[0]?0:n===t.amPm[1]?1:null}],S=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(e){var t=(e+"").match(/([+-]|\d\d)/gi);if(t){var n=60*+t[1]+parseInt(t[2],10);return"+"===t[0]?n:-n}return 0}],T={D:["day","[1-9]\\d?"],DD:["day","\\d\\d"],Do:["day","[1-9]\\d?"+o,function(e){return parseInt(e,10)}],M:["month","[1-9]\\d?",_],MM:["month","\\d\\d",_],YY:["year","\\d\\d",function(e){var t=+(""+(new Date).getFullYear()).substr(0,2);return+(""+(+e>68?t-1:t)+e)}],h:["hour","[1-9]\\d?",void 0,"isPm"],hh:["hour","\\d\\d",void 0,"isPm"],H:["hour","[1-9]\\d?"],HH:["hour","\\d\\d"],m:["minute","[1-9]\\d?"],mm:["minute","\\d\\d"],s:["second","[1-9]\\d?"],ss:["second","\\d\\d"],YYYY:["year","\\d{4}"],S:["millisecond","\\d",function(e){return 100*+e}],SS:["millisecond","\\d\\d",function(e){return 10*+e}],SSS:["millisecond","\\d{3}"],d:b,dd:b,ddd:y,dddd:y,MMM:["month",o,a("monthNamesShort")],MMMM:["month",o,a("monthNames")],a:C,A:C,ZZ:S,Z:S},x={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},E=function(e){return c(x,e)},w=function(e,t,n){if(void 0===t&&(t=x.default),void 0===n&&(n={}),"number"==typeof e&&(e=new Date(e)),"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))throw new Error("Invalid Date pass to format");var o=[];t=(t=x[t]||t).replace(s,(function(e,t){return o.push(t),"@@@"}));var r=c(c({},p),n);return(t=t.replace(i,(function(t){return v[t](e,r)}))).replace(/@@@/g,(function(){return o.shift()}))};function A(e,t,n){if(void 0===n&&(n={}),"string"!=typeof t)throw new Error("Invalid format in fecha parse");if(t=x[t]||t,e.length>1e3)return null;var o={year:(new Date).getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},r=[],a=[],l=t.replace(s,(function(e,t){return a.push(f(t)),"@@@"})),h={},u={};l=f(l).replace(i,(function(e){var t=T[e],n=t[0],i=t[1],o=t[3];if(h[n])throw new Error("Invalid format. "+n+" specified twice in format");return h[n]=!0,o&&(u[o]=!0),r.push(t),"("+i+")"})),Object.keys(u).forEach((function(e){if(!h[e])throw new Error("Invalid format. "+e+" is required in specified format")})),l=l.replace(/@@@/g,(function(){return a.shift()}));var d=e.match(new RegExp(l,"i"));if(!d)return null;for(var g=c(c({},p),n),m=1;m<d.length;m++){var v=r[m-1],_=v[0],b=v[2],y=b?b(d[m],g):+d[m];if(null==y)return null;o[_]=y}1===o.isPm&&null!=o.hour&&12!=+o.hour?o.hour=+o.hour+12:0===o.isPm&&12==+o.hour&&(o.hour=0);for(var C=new Date(o.year,o.month,o.day,o.hour,o.minute,o.second,o.millisecond),S=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],E=(m=0,S.length);m<E;m++)if(h[S[m][0]]&&o[S[m][0]]!==C[S[m][1]]())return null;return null==o.timezoneOffset?C:new Date(Date.UTC(o.year,o.month,o.day,o.hour,o.minute-o.timezoneOffset,o.second,o.millisecond))}var O={format:w,parse:A,defaultI18n:d,setGlobalDateI18n:g,setGlobalDateMasks:E};t.default=O},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ChatFooterComponent=void 0;var s,r,a,c=n(0),l=n(11),h=n(4),u=n(10),d=n(9);!function(e){e.ARROW_DOWN="ArrowDown",e.ARROW_UP="ArrowUp",e.BACKSPACE="Backspace",e.ENTER="Enter",e.ESCAPE="Escape"}(s||(s={})),function(e){e.ARROW_DOWN="ArrowDown",e.ARROW_UP="ArrowUp",e.ENTER="Enter"}(r||(r={})),function(e){e[e.KEYBOARD=0]="KEYBOARD",e[e.VOICE=1]="VOICE"}(a||(a={}));var p=function(e){function t(t,n,i,o,s,r,c){var l=e.call(this,t)||this;return l.onSend=n,l.onUpload=i,l.settings=o,l.onQueryChange=s,l.onSpeechToggle=r,l.onShareLocation=c,l.SUGGESTION_REQUEST_TIMEOUT=300,l.SUGGESTION_MINIMUM_INPUT_LENGTH=3,l.SUPPORTED_MEDIA_FORMATS={AUDIO:".aac, .amr, .mp3, .mpga, .oga, .ogg, .wav, audio/*",FILE:".7z, .csv, .doc, .docx, .eml, .ics, .key, .log, .neon, .numbers, .odt, .pages, .pdf, .pps, .ppsx, .ppt, .pptx, .xls, .xlsx, .xml, .yml, .yaml, .txt, .vcf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",IMAGE:".gif, .jfif, .jpeg, .jpg, .png, .webp, .svg, .tif, .tiff, image/*",VIDEO:".3g2, .3gp, .avi, .m4a, .m4v, .mov, .mp4, .mp4a, .mpeg, .mpg, .ogv, .qt, .wmv, .webm, video/*"},l.SHARE_BUTTON_ID="oda-chat-share-button",l.SHARE_POPUP_MENU_ID="oda-chat-share-popup-menu",l.SHARE_ORDER=[],l.mode=void 0,l._isShareOpen=!1,l._navKeys=[],l.modeSwitchPreservedText="",l.recognitionRequested=!1,l.locale=l.settings.i18n[l.settings.locale],l.element=l._createElement(),l.setInputMode(a.KEYBOARD),l.disable(!0),l}return o(t,e),t.prototype.setInputMode=function(e){e!==this.mode&&(this.settings.enableSpeech?(this.mode=e,this.mode===a.KEYBOARD?this._showKeyboardMode():this._showVoiceMode()):(this.mode=a.KEYBOARD,this._showKeyboardMode()))},t.prototype.setUserInputText=function(e,t){void 0===t&&(t=!1),this.mode===a.KEYBOARD?this._textArea&&(this._textArea.value=e,this._textArea.setSelectionRange(e.length,e.length),this.focusTextArea(),e.length&&(this._sendButton.disabled=!1)):t||(this._recognitionTextView.value=this.modeSwitchPreservedText+e,this._recognitionTextView.setSelectionRange(e.length,e.length),this._recognitionTextView.scrollLeft=this._recognitionTextView.scrollWidth)},t.prototype.getUserInputText=function(){return this.mode===a.KEYBOARD?this._textArea.value:this._recognitionTextView.value},t.prototype.setUserInputPlaceholder=function(e){this._textArea&&(this._textArea.placeholder=e)},t.prototype.setVoiceRecording=function(e){this.settings.enableSpeech&&(e&&this.recognitionRequested?this.setInputMode(a.VOICE):e||this.setInputMode(a.KEYBOARD))},t.prototype.updateVisualizer=function(e){this.mode===a.VOICE&&this._drawVisualizer(e)},t.prototype.focusTextArea=function(){this._textArea.focus(),this._textArea.scrollTop=this._textArea.scrollHeight},t.prototype.render=function(e){},t.prototype.disable=function(e){var t;void 0===e&&(e=!0),this.settings.enableAttachment&&(this._closeSharePopup(),this._shareButton.disabled=e),e?(this._textArea.classList.add(this.utils.getCssClassWithPrefix("disabled")),this.settings.enableAutocomplete&&(this._invalidateSuggestions(),this._removeSuggestionsPopup()),this._sendButton.disabled=e):(this._textArea.classList.remove(this.utils.getCssClassWithPrefix("disabled")),(null===(t=this._textArea.value)||void 0===t?void 0:t.length)&&(this._sendButton.disabled=e)),this.settings.enableSpeech&&(this.setInputMode(a.KEYBOARD),this._switchToVoiceModeButton.disabled=e),this.isFooterDisabled=e},t.prototype.isDisabled=function(){return this.isFooterDisabled},t.prototype.displaySuggestions=function(e){if(this._removeSuggestionsPopup(),0===e.length)this._suggestions=e,this._isSuggestionsValid=!1;else if(this._textArea.value){this._currentSuggestionFocus=e.length>u.Constants.MAX_SUGGESTIONS_COUNT?u.Constants.MAX_SUGGESTIONS_COUNT:e.length<u.Constants.MIN_SUGGESTIONS_COUNT?u.Constants.MIN_SUGGESTIONS_COUNT:e.length,this._suggestions=e,this._isSuggestionsValid=!0;var n=this.utils.createDiv(["autocomplete-items"]);n.setAttribute("role","list");var i=this._textArea.value.trim();n.id=t.SUGGESTIONS_ID;for(var o=this._currentSuggestionFocus-1;o>-1;o--){var s=this._createSuggestionListItem(e[o],i);n.appendChild(s)}this.element.appendChild(n)}},t.prototype.getSuggestions=function(){return this._suggestions},t.prototype.getSuggestionsValid=function(){return this._isSuggestionsValid},t.prototype._createElement=function(){return this.utils.createDiv(["footer"])},t.prototype._showKeyboardMode=function(){var e,t;if(this.element.classList.remove(this.utils.getCssClassWithPrefix("mode-voice")),this.element.classList.add(this.utils.getCssClassWithPrefix("mode-keyboard")),this.keyboardComponent||(this.keyboardComponent=this._createKeyboardComponent(),this.element.appendChild(this.keyboardComponent)),this._recognitionTextView){var n=this._recognitionTextView.value.toString();this._textArea.value=n,this.modeSwitchPreservedText="",this._recognitionTextView.value=""}this._sendButton.disabled=0===(null===(e=this._textArea.value)||void 0===e?void 0:e.length),this.settings.enableAutocomplete&&(null===(t=this._textArea.value)||void 0===t?void 0:t.trim().length)>=this.SUGGESTION_MINIMUM_INPUT_LENGTH&&this._setSuggestionsRequestTimer()},t.prototype._showVoiceMode=function(){var e,t;if(this.element.classList.remove(this.utils.getCssClassWithPrefix("mode-keyboard")),this.element.classList.add(this.utils.getCssClassWithPrefix("mode-voice")),this.voiceComponent||(this.voiceComponent=this._createVoiceComponent(),this.element.appendChild(this.voiceComponent)),this._textArea){var n=null!==(t=null===(e=this._textArea.value)||void 0===e?void 0:e.trim().toString())&&void 0!==t?t:"";this.modeSwitchPreservedText=n?n+" ":"",this._recognitionTextView.value=this.modeSwitchPreservedText,this._removeSuggestionsPopup(),this._textArea.value=""}},t.prototype._createKeyboardComponent=function(){var e=this.utils.createDiv(["footer-mode-keyboard"]);if(this.settings.enableAttachment){var t=this._createShareComponent();e.appendChild(t)}this._textArea=this._createInputTextArea(),e.appendChild(this._textArea);var n=this._createSendMessageButton();return this._sendButton=n,e.appendChild(n),this.settings.enableSpeech&&(this._switchToVoiceModeButton=this._createVoiceSwitchButton(),e.appendChild(this._switchToVoiceModeButton)),e},t.prototype._createShareComponent=function(){var e=this,t=this.utils.createDiv(),n=this.utils.createButton(["footer-button","button-upload"]);n.id=this.SHARE_BUTTON_ID,n.type="menu",n.setAttribute("aria-haspopup","true"),n.setAttribute("aria-controls",this.SHARE_POPUP_MENU_ID),n.onclick=this._onClickShareButton.bind(this),n.onkeydown=this._onShareButtonKeyDown.bind(this),n.onblur=function(){e._isShareOpen&&setTimeout((function(){var t,n=null===(t=document.activeElement)||void 0===t?void 0:t.id;n&&(e.SHARE_ORDER.indexOf(n)>=0||n===e.SHARE_BUTTON_ID)||e._closeSharePopup()}),0)},this._setupFooterButton(n,this.locale.upload,d.SVG_SPRITE.icon_bot_attach,this.settings.attachmentIcon),this._shareButton=n,t.appendChild(n);var i=this._getSharePopup();return t.appendChild(i),this._uploadFileInput=this.utils.createInput([],"file"),this._uploadFileInput.onchange=this._uploadDocument.bind(this),this._uploadFileInput.accept=this.settings.supportedFileTypes,document.addEventListener("deviceready",(function(){var t=globalThis?globalThis.device:window?window.device:void 0;"Android"===(null==t?void 0:t.platform)&&e._uploadFileInput.removeAttribute("accept")}),!1),t},t.prototype._createInputTextArea=function(){var e=["user-input"];this.settings.enableSpeech&&e.push("user-input-inline-send");var t=this.utils.createTextArea(e);return t.setAttribute("aria-label",this.locale.inputPlaceholder),t.placeholder=this.locale.inputPlaceholder,t.autofocus=!0,t.rows=1,t.onkeydown=this.onInputKeyDown.bind(this),t.onkeyup=this.onInputKeyUp.bind(this),t.oninput=this._expand.bind(this),t},t.prototype._createSendMessageButton=function(){var e=this,t=["footer-button","button-send"];this.settings.enableSpeech&&t.push("button-send-inline");var n=this.utils.createButton(t);return n.onclick=function(){var t,i;e._isUserInputEmpty()||(e._previousInputValue=void 0,e._textArea.value=null===(i=null===(t=e._textArea)||void 0===t?void 0:t.value.trim())||void 0===i?void 0:i.replace("\n",""),e.settings.enableAutocomplete&&(e._invalidateSuggestions(),e._removeSuggestionsPopup()),e._onSend(),n.disabled=!0)},this._setupFooterButton(n,this.locale.send,d.SVG_SPRITE.icon_bot_send,this.settings.sendIcon),n},t.prototype._createVoiceSwitchButton=function(){var e=this,t=this.utils.createButton(["footer-button","button-switch-voice"]);return t.onclick=function(){e.onSpeechToggle(!0),e.recognitionRequested=!0},this._setupFooterButton(t,this.locale.speak,d.SVG_SPRITE.icon_bot_mic,this.settings.micIcon),t},t.prototype._createVoiceComponent=function(){var e=this.utils.createDiv(["footer-mode-voice"]),t=this.utils.createDiv(["footer-visualizer-wrapper"]),n=this.utils.createDiv(["footer-recognition-wrapper"]);if(this._visualizerCanvas=document.createElement("canvas"),this._visualizerCanvas.width=244,this._visualizerCanvas.height=32,t.appendChild(this._visualizerCanvas),this._recognitionTextView=this._createRecognitionTextView(),n.appendChild(this._recognitionTextView),this.settings.enableSpeech){var i=this._createKeyboardSwitchButton();n.appendChild(i)}return e.appendChild(t),e.appendChild(n),e},t.prototype._createRecognitionTextView=function(){var e=this.utils.createInput(["recognition-text-view"]);return e.readOnly=!0,e.type="text",e.placeholder=this.locale.recognitionTextPlaceholder,e.setAttribute("aria-label",this.locale.recognitionTextPlaceholder),e},t.prototype._createKeyboardSwitchButton=function(){var e=this,t=this.utils.createButton(["footer-button","button-switch-kbd"]);return t.onclick=function(){e.recognitionRequested=!1,e.onSpeechToggle(!1)},this._setupFooterButton(t,this.locale.speak,d.SVG_SPRITE.icon_bot_keyboard,this.settings.keyboardIcon),t},t.prototype._setupFooterButton=function(e,t,n,i){e.innerHTML="",e.title=t;var o=null!=i?i:n;if(c.utils.isSvg(o)){var s=this.utils.createElementFromString(o);s.setAttribute("role","img"),s.setAttribute("aria-label",t),s.classList.add(this.utils.getCssClassWithPrefix("footer-button-svg-icon")),e.appendChild(s)}else{var r=this.utils.createImage(o,["footer-button-icon"],t);e.appendChild(r)}return e},t.prototype._drawVisualizer=function(e){var t=this._visualizerCanvas.height,n=this._visualizerCanvas.width,i=Math.floor(t/2);e=this._getGroupedFrequencyValues(e,31),e=this._getScaledFrequencyValues(e,t/255);var o=this._visualizerCanvas.getContext("2d");o.fillStyle=this.settings.colors.visualizer,o.clearRect(0,0,n,t),o.save();var s=0;e.forEach((function(e){var t=Math.ceil(e/2)+1;o.fillRect(s,i-t,4,2*t),s+=8})),o.save()},t.prototype._getGroupedFrequencyValues=function(e,t){for(var n=Math.ceil(t/2),i=e.length/n,o=[],s=[],r=0;r<e.length;r+=i){var a=e.slice(r,r+i).reduce((function(e,t){return e+t}),0);o.push(a/i),s.unshift(a/i)}return o.splice(0,1),s.concat(o)},t.prototype._getScaledFrequencyValues=function(e,t){return e.map((function(e){return e*t}))},t.prototype._isUserInputEmpty=function(){return!this._textArea||0===this._textArea.value.trim().length},t.prototype._uploadDocument=function(e){e.target.files&&e.target.files.length>0&&this._onUpload(e.target.files[0])},t.prototype.onInputKeyDown=function(e){var t;this.isDisabled()||e.isComposing||229===e.keyCode||e.key===s.ENTER&&!e.shiftKey&&(null===(t=this._textArea.value)||void 0===t?void 0:t.trim().length)>0&&(e.preventDefault(),this._sendButton.click())},t.prototype.onInputKeyUp=function(e){var t;if(this.isDisabled())return this._invalidateSuggestions(),void this._removeSuggestionsPopup();var n=null===(t=this._textArea.value)||void 0===t?void 0:t.trim();if(this._sendButton.disabled=0===n.length,!e.isComposing&&this.settings.enableAutocomplete){if(this._onNavigateSuggestion(e))return;e.key===s.BACKSPACE&&(this._previousInputValue=void 0,this._invalidateSuggestions(),this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)),this._getNavKeys().indexOf(e.key)<0&&(n.length>=this.SUGGESTION_MINIMUM_INPUT_LENGTH?this._previousInputValue!==this._textArea.value&&(this._previousInputValue=this._textArea.value,clearTimeout(this._suggestionsRequest),this._setSuggestionsRequestTimer()):(this._previousInputValue=void 0,this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)))}},t.prototype._expand=function(){this._textArea.style.height=null;var e=this._textArea.scrollHeight;this._textArea.style.height=e+"px"},t.prototype._onNavigateSuggestion=function(e){var n=!1,i=document.getElementById(t.SUGGESTIONS_ID);if(i){var o=i.getElementsByTagName("div");e.key===s.ARROW_DOWN?(e.preventDefault(),this._currentSuggestionFocus<o.length-1?(this._currentSuggestionFocus++,this._addActive(o)):(this._removeActive(o),this._textArea.value=this._currentInputValue?this._currentInputValue:this._textArea.value,this._currentSuggestionFocus=o.length),n=!0):e.key===s.ARROW_UP&&(e.preventDefault(),this._currentSuggestionFocus===o.length&&(this._currentInputValue=this._textArea.value),this._currentSuggestionFocus>0&&this._currentSuggestionFocus--,this._addActive(o),n=!0)}return n},t.prototype._addActive=function(e){if(!e)return!1;this._removeActive(e),e[this._currentSuggestionFocus].classList.add(this.utils.getCssClassWithPrefix("autocomplete-active")),e[this._currentSuggestionFocus].scrollIntoView(),this._textArea.value=e[this._currentSuggestionFocus].innerText},t.prototype._removeActive=function(e){for(var t=0,n=e;t<n.length;t++){n[t].classList.remove(this.utils.getCssClassWithPrefix("autocomplete-active"))}},t.prototype._removeSuggestionsPopup=function(){var e=document.getElementById(t.SUGGESTIONS_ID);e&&e.remove()},t.prototype._onSend=function(){this.onSend(this._textArea.value),this._textArea.value="",this._textArea.innerText="",setTimeout(this._expand.bind(this))},t.prototype._getSharePopup=function(){var e,t=this,n=this.settings.i18n[this.settings.locale],i=this.utils.getCssClassWithPrefix("share-popup-item-svg-icon"),o=function(e,n,o,s){var r=t.utils.createButton(["share-popup-item"]);r.id=e,r.tabIndex=-1,r.setAttribute("role","menuitem"),r.appendChild(function(e,n){var o=t.utils.createElementFromString(e);return o.setAttribute("role","img"),o.setAttribute("aria-label",n),o.classList.add(i),o}(o,n));var a=t.utils.createSpan(["share-popup-item-text"]);a.textContent=n,r.appendChild(a),r.title=n,r.onclick=function(e){t._closeSharePopup(),s.call(t,e)};var c=document.createElement("li");return c.dir="auto",c.setAttribute("role","none"),c.appendChild(r),c};if(!this._sharePopup){var s=document.createElement("ul");s.id=this.SHARE_POPUP_MENU_ID,s.setAttribute("role","menu"),s.setAttribute("aria-labelledby",this.SHARE_BUTTON_ID),s.setAttribute("aria-activedescendant","oda-chat-share-visual"),s.classList.add(this.utils.getCssClassWithPrefix("share-popup-list")),s.onkeydown=this._onShareKeyUp.bind(this),s.addEventListener("blur",(function(){t._isShareOpen&&setTimeout((function(){var e,n=null===(e=document.activeElement)||void 0===e?void 0:e.id;n&&(t.SHARE_ORDER.indexOf(n)>=0||n===t.SHARE_BUTTON_ID)||t._closeSharePopup()}),100)}),!0);var r=new Set;if((null===(e=this.settings.shareMenuItems)||void 0===e?void 0:e.length)||(this.settings.shareMenuItems=[h.IShareMenuItems.AUDIO,h.IShareMenuItems.FILE,h.IShareMenuItems.LOCATION,h.IShareMenuItems.VISUAL]),this.settings.shareMenuItems.forEach((function(e){return r.add(e.toLowerCase())})),r.has(h.IShareMenuItems.AUDIO)||r.has(h.IShareMenuItems.FILE)||r.has(h.IShareMenuItems.LOCATION)||r.has(h.IShareMenuItems.VISUAL)||r.add(h.IShareMenuItems.AUDIO).add(h.IShareMenuItems.FILE).add(h.IShareMenuItems.LOCATION).add(h.IShareMenuItems.VISUAL),r.has(h.IShareMenuItems.VISUAL)){var a=o("oda-chat-share-visual",n.shareVisual,d.SVG_SPRITE.icon_bot_share_media,(function(){t._uploadFileInput.accept=t.SUPPORTED_MEDIA_FORMATS.IMAGE+", "+t.SUPPORTED_MEDIA_FORMATS.VIDEO,t._uploadFileInput.click()}));s.appendChild(a),this.SHARE_ORDER.push("oda-chat-share-visual")}if(r.has(h.IShareMenuItems.AUDIO)){var c=o("oda-chat-share-audio",n.shareAudio,d.SVG_SPRITE.icon_bot_share_audio,(function(){t._uploadFileInput.accept=t.SUPPORTED_MEDIA_FORMATS.AUDIO,t._uploadFileInput.click()}));s.appendChild(c),this.SHARE_ORDER.push("oda-chat-share-audio")}if(r.has(h.IShareMenuItems.FILE)){var l=o("oda-chat-share-file",n.shareFile,d.SVG_SPRITE.icon_bot_share_file,(function(){t._uploadFileInput.accept=t.SUPPORTED_MEDIA_FORMATS.FILE,t._uploadFileInput.click()}));s.appendChild(l),this.SHARE_ORDER.push("oda-chat-share-file")}if(r.has(h.IShareMenuItems.LOCATION)){var u=o("oda-chat-share-location",n.shareLocation,d.SVG_SPRITE.icon_bot_share_location,(function(){t.onShareLocation()}));s.appendChild(u),this.SHARE_ORDER.push("oda-chat-share-location")}this._sharePopup=this.utils.createDiv(["share-popup"]),this._sharePopup.appendChild(s),this._sharePopup.onclick=function(e){e.stopPropagation(),e.preventDefault()},this._sharePopupMenu=s}return this._sharePopup},t.prototype._onClickShareButton=function(e){this._removeSuggestionsPopup(),this._isShareOpen?this._closeSharePopup():this._openSharePopup(),e.stopPropagation(),e.preventDefault()},t.prototype._openSharePopup=function(e){var t=this;if(void 0===e&&(e=0),!this._isShareOpen){switch(this._isShareOpen=!0,this._sharePopup.classList.add(this.utils.getCssClassWithPrefix("share-popup-expand")),this._shareButton.setAttribute("aria-expanded","true"),e){case-1:this._focusMenuitemLast();break;default:this._focusMenuitemFirst()}document.addEventListener("click",(function(){t._closeSharePopup()}),{once:!0})}},t.prototype._closeSharePopup=function(){this._isShareOpen&&(this._sharePopup.classList.remove(this.utils.getCssClassWithPrefix("share-popup-expand")),this._shareButton.removeAttribute("aria-expanded"),this._isShareOpen=!1)},t.prototype._onShareButtonKeyDown=function(e){var t=!1,n="true"===this._shareButton.getAttribute("aria-expanded");switch(e.key){case s.ARROW_DOWN:n?this._focusMenuitemFirst():this._openSharePopup(0),t=!0;break;case s.ARROW_UP:n?this._focusMenuitemLast():this._openSharePopup(-1),t=!0;break;case s.ESCAPE:this._closeSharePopup()}t&&(e.stopPropagation(),e.preventDefault())},t.prototype._onShareKeyUp=function(e){var t=!1;switch(e.key){case s.ESCAPE:this._closeSharePopup(),t=!0;break;case s.ARROW_UP:this._focusMenuitemPrevious(),t=!0;break;case s.ARROW_DOWN:this._focusMenuitemNext(),t=!0}t&&(e.stopPropagation(),e.preventDefault())},t.prototype._focusMenuitem=function(e){this._isShareOpen&&(document.getElementById(e).focus(),this._sharePopupMenu.setAttribute("aria-activedescendant",e))},t.prototype._focusMenuitemFirst=function(){this._focusMenuitem(this.SHARE_ORDER[0])},t.prototype._focusMenuitemLast=function(){this._focusMenuitem(this.SHARE_ORDER[this.SHARE_ORDER.length-1])},t.prototype._focusMenuitemPrevious=function(){var e=this._sharePopupMenu.getAttribute("aria-activedescendant"),t=this.SHARE_ORDER.indexOf(e)-1,n=this.SHARE_ORDER[t<0?this.SHARE_ORDER.length-1:t];this._focusMenuitem(n)},t.prototype._focusMenuitemNext=function(){var e=this._sharePopupMenu.getAttribute("aria-activedescendant"),t=this.SHARE_ORDER[(this.SHARE_ORDER.indexOf(e)+1)%this.SHARE_ORDER.length];this._focusMenuitem(t)},t.prototype._onUpload=function(e){this.onUpload(e),this._uploadFileInput.value=""},t.prototype._onQueryChange=function(){this.onQueryChange(this._textArea.value.trim()).catch((function(){}))},t.prototype._setSuggestionsRequestTimer=function(){var e=this;this._suggestionsRequest=setTimeout((function(){e._onQueryChange()}),this.SUGGESTION_REQUEST_TIMEOUT)},t.prototype._invalidateSuggestions=function(){this._suggestions=null,this._isSuggestionsValid=!1},t.prototype._getNavKeys=function(){if(!this._navKeys.length)for(var e=0,t=Object.keys(r);e<t.length;e++){var n=t[e];this._navKeys.push(r[n])}return this._navKeys},t.prototype._createSuggestionListItem=function(e,t){var n=this,i=this.utils.createDiv();i.setAttribute("role","listitem"),i.onclick=function(){n._textArea.value=i.innerText,n._removeSuggestionsPopup(),n._sendButton.click()};var o=new RegExp(t,"i"),s=e.match(o);if(s){if(0!==s.index){var r=this.utils.createSpan();r.textContent=e.substr(0,s.index),i.appendChild(r)}var a=document.createElement("strong");if(a.textContent=e.substr(s.index,t.length),i.appendChild(a),s.index+t.length!==e.length){var c=this.utils.createSpan();c.textContent=e.substr(s.index+t.length),i.appendChild(c)}}else i.textContent=e;return i},t.SUGGESTIONS_ID="chat_widget_suggestions",t}(l.Component);t.ChatFooterComponent=p},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetHeaderComponent=void 0;var s=n(0),r=n(11),a=n(8),c=n(9),l=function(e){function t(t,n,i,o,s,r){var a=e.call(this,t)||this;return a.settings=n,a.onClose=i,a.onClearMessage=o,a.onAudioToggle=s,a.element=a._createElement(),r(a._updateStatusMessage.bind(a)),a}return o(t,e),t.prototype.render=function(e){},t.prototype.closeWidgetPopup=function(){this.onClose()},t.prototype.clearHistory=function(){this.onClearMessage()},t.prototype._createElement=function(){var e,t,n=this,i=this.utils.createDiv(["header"]),o=this.utils.createDiv(["header-info-wrapper"]),r=this.utils.createDiv(["header-actions"]),a=this.settings.locale,l=this.settings.i18n[a].chatTitle,h=this.settings.i18n[a].chatSubtitle;if(this.settings.logoIcon){var u=this.utils.createImage(this.settings.logoIcon,["logo"],this.settings.i18n[a].chatTitle);i.appendChild(u)}if(l){var d=this.utils.createDiv(["title"]);d.id="oda-chat-title",d.innerText=l,d.title=l,o.appendChild(d)}if(h){var p=this.utils.createDiv(["subtitle"]);p.innerText=h,p.title=h,o.appendChild(p),this.settings.showConnectionStatus=!1}else this.settings.showConnectionStatus&&(this._connectionStatus=this.utils.createDiv(["connection-status","disconnected"]),this._connectionStatus.innerText=this.settings.i18n[a].connecting,o.appendChild(this._connectionStatus));if(i.appendChild(o),this.settings.customHeaderElementId){var g=this.utils.createDiv(["header-custom-element"]),f=document.getElementById(this.settings.customHeaderElementId);g.appendChild(f),i.appendChild(g)}if(this.settings.enableClearMessage){var m=this.utils.createButton(["header-button","button-clear"]);m.title=this.settings.i18n[a].clear;var v=null!==(e=this.settings.clearMessageIcon)&&void 0!==e?e:c.SVG_SPRITE.icon_bot_clear;if(s.utils.isSvg(v)){var _=this.utils.createElementFromString(v,["header-button-icon"]);_.setAttribute("role","img"),_.setAttribute("aria-label",m.title),m.appendChild(_)}else{var b=this.utils.createImage(v,["header-button-img-icon"],m.title);m.appendChild(b)}m.onclick=this.clearHistory.bind(this),r.appendChild(m)}if(this.settings.enableBotAudioResponse&&window.speechSynthesis){this._audioButtonOn=!this.settings.initBotAudioMuted;var y,C,S=this.utils.createButton(["header-button","button-narration"]),T=function(){var e,t;S.innerHTML="";var i=n._audioButtonOn?n.settings.i18n[a].audioResponseOn:n.settings.i18n[a].audioResponseOff,o=n._audioButtonOn?null!==(e=n.settings.audioResponseOnIcon)&&void 0!==e?e:c.SVG_SPRITE.icon_bot_speech_unmute:null!==(t=n.settings.audioResponseOffIcon)&&void 0!==t?t:c.SVG_SPRITE.icon_bot_speech_mute;s.utils.isSvg(o)?((C=n.utils.createElementFromString(o,["header-button-icon"])).setAttribute("role","img"),C.setAttribute("aria-label",i),S.appendChild(C)):(y=n.utils.createImage(o,["header-button-img-icon"],i),S.appendChild(y)),S.title=i};T(),S.onclick=function(){n._audioButtonOn=!n._audioButtonOn,T(),n.onAudioToggle(n._audioButtonOn)},r.appendChild(S)}if(!this.settings.embedded){var x=this.utils.createButton(["header-button","button-close"]);x.title=this.settings.i18n[a].close;v=null!==(t=this.settings.closeIcon)&&void 0!==t?t:c.SVG_SPRITE.icon_bot_collapse;if(s.utils.isSvg(v)){var E=this.utils.createElementFromString(v,["header-button-icon"]);E.setAttribute("role","img"),E.setAttribute("aria-label",x.title),x.appendChild(E)}else{var w=this.utils.createImage(v,["header-button-img-icon"],x.title);x.appendChild(w)}x.onclick=this.closeWidgetPopup.bind(this),r.appendChild(x)}return i.appendChild(r),i},t.prototype._updateStatusMessage=function(e){if(this.settings.showConnectionStatus)switch(this._connectionStatus.className=this.utils.getCssClassWithPrefix("connection-status"),e){case a.CONNECTION_STATE.OPEN:this._connectionStatus.innerText=this.settings.i18n[this.settings.locale].connected,this._connectionStatus.classList.remove(this.utils.getCssClassWithPrefix("connecting"),this.utils.getCssClassWithPrefix("disconnected")),this._connectionStatus.classList.add(this.utils.getCssClassWithPrefix("connected"));break;case a.CONNECTION_STATE.CLOSED:this._connectionStatus.innerText=this.settings.i18n[this.settings.locale].disconnected,this._connectionStatus.classList.remove(this.utils.getCssClassWithPrefix("connecting"),this.utils.getCssClassWithPrefix("connected")),this._connectionStatus.classList.add(this.utils.getCssClassWithPrefix("disconnected"));break;case a.CONNECTION_STATE.CLOSING:this._connectionStatus.innerText=this.settings.i18n[this.settings.locale].closing,this._connectionStatus.classList.remove(this.utils.getCssClassWithPrefix("connected"),this.utils.getCssClassWithPrefix("disconnected")),this._connectionStatus.classList.add(this.utils.getCssClassWithPrefix("connecting"));break;case a.CONNECTION_STATE.CONNECTING:this._connectionStatus.innerText=this.settings.i18n[this.settings.locale].connecting,this._connectionStatus.classList.remove(this.utils.getCssClassWithPrefix("connected"),this.utils.getCssClassWithPrefix("disconnected")),this._connectionStatus.classList.add(this.utils.getCssClassWithPrefix("connecting"))}},t}(r.Component);t.WidgetHeaderComponent=l},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetMainComponent=void 0;var s=function(e){function t(t,n){var i=e.call(this,t)||this;return i.settings=n,i.element=i._createElement(),i}return o(t,e),t.prototype.render=function(e){},t.prototype._createElement=function(){return this.utils.createDiv(["conversation"])},t}(n(11).Component);t.WidgetMainComponent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComponentFactory=void 0;var i=n(14),o=n(3),s=n(35),r=n(40),a=n(43),c=n(2),l=n(44),h=n(45),u=n(0),d=function(){function e(){}return e.fromMessage=function(e,t,n,u){var d,p,g,f;switch(n.from?(p=c.MESSAGE_SIDE.LEFT,g=null!==(d=n.source)&&void 0!==d?d:i.ISkillMessageSource.BOT,f=n.messagePayload):(p=c.MESSAGE_SIDE.RIGHT,f=n.messagePayload),f.type){case o.PAYLOAD_TYPE.TEXT:return new h.TextMessageComponent(e,t,f,p,n.date,u,g);case o.PAYLOAD_TYPE.ATTACHMENT:return new s.AttachmentMessageComponent(e,t,f,p,n.date,u,g);case o.PAYLOAD_TYPE.CARD:return new r.CardMessageComponent(e,t,f,p,n.date,u,g);case o.PAYLOAD_TYPE.LOCATION:return new a.LocationMessageComponent(e,t,f,p,n.date,u,g);case o.PAYLOAD_TYPE.RAW:return new l.RawMessageComponent(e,t,f,p,n.date,u,g);default:throw Error("Wrong message payload type:"+f.type)}},e.extractUtteranceText=function(e,t){var n=(e.from,e.messagePayload),i="";switch(n.type){case o.PAYLOAD_TYPE.ATTACHMENT:i=this._extractUtteranceAttachment(n,t);break;case o.PAYLOAD_TYPE.CARD:i=this._extractUtteranceCard(n,t);break;case o.PAYLOAD_TYPE.LOCATION:i=this._extractUtteranceLocation(n);break;case o.PAYLOAD_TYPE.RAW:i=this._extractUtteranceRaw(n);break;case o.PAYLOAD_TYPE.TEXT:i=this._extractUtteranceText(n);break;default:i=t.utteranceGeneric}return this.stripHTMLFromText(i)},e._getUtterance=function(e,t){var n=this.stripHTMLFromText(e.headerText),i=this.stripHTMLFromText(e.footerText);return(null!=n?n:"")+(n&&t?this.PAUSE:"")+(null!=t?t:"")+this._parseActionsUtterance(e.actions)+(i?this.PAUSE+i:"")+this._parseActionsUtterance(e.globalActions)},e._parseActionsUtterance=function(e){var t=this,n="";return e&&e.forEach((function(e){e.label&&(n=n.concat(t.PAUSE).concat(e.label))})),n},e._extractUtteranceAttachment=function(e,t){return this._getUtterance(e,t[e.type+"-"+e.attachment.type])},e._extractUtteranceCard=function(e,t){var n=this,i="";return e.cards&&e.cards.forEach((function(e,o){i&&(i+=n.PAUSE),i=i.concat(t.card+" "+(o+1)),e.title&&(i=i.concat(n.PAUSE).concat(e.title)),e.description&&(i=i.concat(n.PAUSE).concat(e.description)),e.actions&&(i=i.concat(n._parseActionsUtterance(e.actions)))})),this._getUtterance(e,i)},e._extractUtteranceLocation=function(e){return this._getUtterance(e,e.location.title?e.location.title:"")},e._extractUtteranceRaw=function(e){return this._getUtterance(e,e.payload)},e._extractUtteranceText=function(e){return this._getUtterance(e,e.text)},e.stripHTMLFromText=function(t){return t=null==(t=null==(t=null==t?void 0:t.replace(u.utils.resetRegex(e.REGEX_ENCODED_TEXT),(function(e,t){return String.fromCharCode(t)})))?void 0:t.replace(u.utils.resetRegex(e.REGEX_ENCODED_HEX_TEXT),(function(e,t){return t="0x"+t,String.fromCharCode(t)})))?void 0:t.replace(u.utils.resetRegex(e.REGEX_HTML),"")},e.PAUSE=";",e.REGEX_HTML=/<[^>]+>/g,e.REGEX_ENCODED_TEXT=/&#(\d+);/g,e.REGEX_ENCODED_HEX_TEXT=/&#[xX]([\da-fA-F]+);/g,e}();t.MessageComponentFactory=d},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentMessageComponent=void 0;var s=n(19),r=n(36),a=n(37),c=n(38),l=n(39),h=function(e){function t(n,i,o,s,r,a,c){var l=e.call(this,n,i,o,s,r,a,c)||this;return l._date=r,l._attachment=t.fromPayload(n,i,o.attachment,s),l}return o(t,e),t.fromPayload=function(e,t,n,i){switch(n.type){case s.ATTACHMENT_TYPE.IMAGE:return new c.ImageAttachmentComponent(e,t,n);case s.ATTACHMENT_TYPE.VIDEO:return new l.VideoAttachmentComponent(e,t,n,i);case s.ATTACHMENT_TYPE.AUDIO:return new r.AudioAttachmentComponent(e,t,n,i);case s.ATTACHMENT_TYPE.FILE:return new a.FileAttachmentComponent(e,t,n,i);default:throw Error("Payload contains wrong attachment type")}},t.prototype.render=function(t){return e.prototype.render.call(this)},t.prototype.getContent=function(){return this._attachment.render()},t}(n(2).MessageComponent);t.AttachmentMessageComponent=h},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioAttachmentComponent=void 0;var s=n(0),r=n(2),a=function(e){function t(t,n,i,o){var s=e.call(this,i,t)||this;return s.settings=n,s.payload=i,s.side=o,s._url=i.url,s}return o(t,e),t.prototype.render=function(){var e=this,t=this.utils.createAudio(this._url,["attachment-audio"]);t.controls=!0,r.MESSAGE_SIDE.RIGHT===this.side&&t.setAttribute("controlsList","nodownload");var n='<a href="'+this._url+'">',i=this.settings.i18n[this.settings.locale].attachmentAudioFallback.replace("{0}",n).replace("{/0}","</a>");return t.innerHTML=i,this.settings.linkHandler?s.utils.setEmbeddedLinksHandler(t,this.settings.linkHandler):this.settings.openLinksInNewWindow&&s.utils.setLinksOpenInNewWindow(t),t.onerror=function(){var n=t.parentElement;t.remove(),n.appendChild(e.createMessageElement(e.settings.audioIcon,e.payload.fileName||e.payload.title))},t},t}(n(12).AttachmentComponent);t.AudioAttachmentComponent=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FileAttachmentComponent=void 0;var s=n(2),r=function(e){function t(t,n,i,o){var s=e.call(this,i,t)||this;return s.settings=n,s.payload=i,s.side=o,s._url=i.url,s}return o(t,e),t.prototype.render=function(){return s.MESSAGE_SIDE.RIGHT===this.side?this.createMessageElement(this.settings.fileIcon,this.payload.fileName||this.payload.title):this.utils.createAnchor(this._url,this.payload.fileName||this.payload.title,["attachment-file"],this.settings.openLinksInNewWindow,this.settings.linkHandler)},t}(n(12).AttachmentComponent);t.FileAttachmentComponent=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ImageAttachmentComponent=void 0;var s=function(e){function t(t,n,i){var o=e.call(this,i,t)||this;return o.settings=n,o.payload=i,o._url=i.url,o}return o(t,e),t.prototype.render=function(){var e=this,t=this.utils.createImage(this._url,["attachment-image"],this.payload.fileName||this.payload.title);return t.onerror=function(){t.parentElement.appendChild(e.createMessageElement(e.settings.imageIcon,e.payload.fileName||e.payload.title)),t.remove()},t},t}(n(12).AttachmentComponent);t.ImageAttachmentComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VideoAttachmentComponent=void 0;var s=n(0),r=n(2),a=function(e){function t(t,n,i,o){var s=e.call(this,i,t)||this;return s.settings=n,s.payload=i,s.side=o,s._url=i.url,s}return o(t,e),t.prototype.render=function(){var e=this;if(this.utils.getYouTubeVideoId(this._url)){var t=this.utils.createSpan();return t.innerHTML=this.utils.linkify(this._url,{embeddedHTML:!0,embeddedVideo:this.settings.embeddedVideo}),t}var n=this.utils.createVideo(this._url,["attachment-video"]);n.controls=!0,r.MESSAGE_SIDE.RIGHT===this.side&&n.setAttribute("controlsList","nodownload");var i='<a href="'+this._url+'">',o=this.settings.i18n[this.settings.locale].attachmentVideoFallback.replace("{0}",i).replace("{/0}","</a>");return n.innerHTML=o,this.settings.linkHandler?s.utils.setEmbeddedLinksHandler(n,this.settings.linkHandler):this.settings.openLinksInNewWindow&&s.utils.setLinksOpenInNewWindow(n),n.onerror=function(){var t=n.parentElement;n.remove(),t.appendChild(e.createMessageElement(e.settings.videoIcon,e.payload.fileName||e.payload.title))},n},t}(n(12).AttachmentComponent);t.VideoAttachmentComponent=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CardMessageComponent=void 0;var s=n(9),r=n(14),a=n(41),c=n(42),l=n(2),h=function(e){function t(t,n,i,o,s,r,a){var l=e.call(this,t,n,i,o,s,r,a)||this;l.cards=[],l.locale=l.settings.i18n[l.settings.locale],l.layout=i.layout,l.numCards=i.cards.length;for(var h=0,u=0,d=i.cards;u<d.length;u++){var p=d[u];h++,l.cards.push(new c.CardComponent(l.utils,l.settings,p,h))}return l}return o(t,e),t.prototype.render=function(){var e,t=this,n=this.settings.botIcon;this.source===r.ISkillMessageSource.AGENT&&(n=null!==(e=this.settings.agentAvatar)&&void 0!==e?e:this.settings.botIcon);var i=this.side===l.MESSAGE_SIDE.LEFT?n:this.settings.personIcon,o=["message","card-message-"+this.layout,this.side];i&&o.push("has-message-icon");var s=this.utils.createDiv(o),c=this.side===l.MESSAGE_SIDE.LEFT?this.locale.skillMessage:this.locale.userMessage,h=this.utils.createSpan(["screen-reader-only"]);h.textContent=c,s.appendChild(h);var u=this.utils.createDiv(["message-wrapper"]);if(i){var d=this.utils.createDiv(["icon-wrapper"]);d.appendChild(this.utils.createImage(i,["message-icon"])),u.appendChild(d)}var p,g=this.utils.createDiv(["content-wrapper"]);if(this.headerText){var f=this.utils.createDiv(["message-bubble","message-header"]);f.innerHTML=this.utils.linkify(this.headerText,{embeddedHTML:this.side===l.MESSAGE_SIDE.LEFT,embeddedVideo:!0}),g.appendChild(f)}this.content=this.utils.createDiv(["card-message-content"]),this.cardsWrapper=this.utils.createDiv(["card-message-cards"]);for(var m=0,v=this.cards;m<v.length;m++){var _=v[m];_.onActionClick=this.handleOnActionClick.bind(this);var b=_.render();this.cardsWrapper.appendChild(b)}(this.content.appendChild(this.cardsWrapper),this.layout===a.LAYOUT.HORIZONTAL&&this.numCards>1)&&(this.content.appendChild(this.getNextButton()),this.activeCard=0,this.cardsWrapper.addEventListener("scroll",(function(){window.clearTimeout(p),p=window.setTimeout((function(){for(var e=0,n=0;n<t.numCards;n++){var i=t.cardsWrapper.children[n];if(t.cardsWrapper.scrollLeft<=i.offsetLeft+5){e=n;break}}e!==t.activeCard&&(t.activeCard=e,t.updateCardsScrollState())}),100)})));if(g.appendChild(this.content),this.footerText){var y=this.utils.createDiv(["message-bubble","message-footer"]);y.innerHTML=this.utils.linkify(this.footerText,{embeddedHTML:this.side===l.MESSAGE_SIDE.LEFT,embeddedVideo:!0}),g.appendChild(y)}return u.appendChild(g),s.appendChild(u),this.appendGlobalActions(s,this.actions),this.appendGlobalActions(s,this.globalActions),s},t.prototype.disableActions=function(t){e.prototype.disableActions.call(this,t);for(var n=0,i=this.cards;n<i.length;n++){i[n].disableActions(t)}},t.prototype.enableActions=function(){e.prototype.enableActions.call(this);for(var t=0,n=this.cards;t<n.length;t++){n[t].enableActions()}},t.prototype.getNextButton=function(){if(!this.nextButton){var e=this.locale.cardNavNext;this.nextButton=this.utils.createButton(["round","next"]),this.nextButton.title=e,this.nextButton.setAttribute("aria-label",e);var t=this.utils.createElementFromString(s.SVG_SPRITE.icon_bot_next);t.setAttribute("role","img"),t.setAttribute("aria-label",e),this.nextButton.appendChild(t),this.nextButton.onclick=this.showNextCard.bind(this)}return this.nextButton},t.prototype.getPreviousButton=function(){if(!this.prevButton){var e=this.locale.cardNavPrevious;this.prevButton=this.utils.createButton(["round","previous"]),this.prevButton.title=e,this.prevButton.setAttribute("aria-label",e);var t=this.utils.createElementFromString(s.SVG_SPRITE.icon_bot_previous);t.setAttribute("role","img"),t.setAttribute("aria-label",e),this.prevButton.appendChild(t),this.prevButton.onclick=this.showPrevCard.bind(this)}return this.prevButton},t.prototype.showNextCard=function(){this.activeCard<this.numCards&&(this.activeCard++,this.updateCardsScrollState())},t.prototype.showPrevCard=function(){this.activeCard>0&&(this.activeCard--,this.updateCardsScrollState())},t.prototype.updateCardsScrollState=function(){var e,t,n,i,o=this.cardsWrapper.children[this.activeCard];this.cardsWrapper.scrollLeft=o.offsetLeft,0===this.activeCard?null===(e=this.prevButton)||void 0===e||e.remove():(null===(t=this.prevButton)||void 0===t?void 0:t.parentElement)||this.content.prepend(this.getPreviousButton()),this.activeCard===this.numCards-1?null===(n=this.nextButton)||void 0===n||n.remove():(null===(i=this.nextButton)||void 0===i?void 0:i.parentElement)||this.content.appendChild(this.getNextButton())},t}(l.MessageComponent);t.CardMessageComponent=h},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LAYOUT=void 0,function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(i||(i={})),t.LAYOUT=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CardComponent=void 0;var i=n(0),o=n(17),s=function(){function e(e,t,n,i){var s;if(this.utils=e,this.settings=t,this._actions=[],this._title=n.title,this._description=n.description,this._imageUrl=n.imageUrl,this._url=n.url,n.actions)for(var r=0,a=0,c=n.actions;a<c.length;a++){var l=c[a],h=(this._title?this._title+" - ":"")+(this._description?this._description+" - ":"")+(null!==(s=this._url)&&void 0!==s?s:"");r++,l.actionId="card"+i+"Action"+r;var u=o.ActionComponentFactory.fromActionPayload(e,l,this.settings.openLinksInNewWindow,h,t.linkHandler);u&&(u.onActionClick=this.handleOnActionClick.bind(this),this._actions.push(u))}}return e.prototype.handleOnActionClick=function(e){this.onActionClick&&this.onActionClick(e)},e.prototype.handleOnActionTrigger=function(e){var t=+e.match(/\d+/g)[1];return this._actions[t-1]},e.prototype.render=function(){var e=this.utils.createDiv(["card"]),t=this._url?this.utils.createAnchor(this._url,"",["card-content"],this.settings.openLinksInNewWindow,this.settings.linkHandler):this.utils.createDiv(["card-content"]),n=this.settings.locale;this._url&&(t.innerText=""),this._imageUrl&&t.appendChild(this.utils.createImage(this._imageUrl,["card-image"],this.settings.i18n[n].cardImagePlaceholder));var o=this.utils.createDiv(["card-title"]);if(o.innerHTML=this.utils.linkify(this._title,{embeddedHTML:!0,embeddedVideo:!0}),t.appendChild(o),this._description){var s=this.utils.createDiv(["card-description"]);s.innerHTML=this.utils.linkify(this._description,{embeddedHTML:!0,embeddedVideo:!0}),t.appendChild(s)}if(e.appendChild(t),this.settings.linkHandler?i.utils.setEmbeddedLinksHandler(t,this.settings.linkHandler):this.settings.openLinksInNewWindow&&i.utils.setLinksOpenInNewWindow(t),this._actions.length>0){for(var r=this.utils.createDiv(this.settings.displayActionsAsPills?["card-actions","card-actions-pill"]:["card-actions"]),a=0,c=this._actions;a<c.length;a++){var l=c[a];r.appendChild(l.render())}e.appendChild(r)}return e},e.prototype.disableActions=function(e){if("postback"!==this.settings.disablePastActions||e)for(var t=0,n=this._actions;t<n.length;t++){(s=n[t]).disable()}else for(var i=0,o=this._actions;i<o.length;i++){var s;"postback"!==(s=o[i]).getActionType()&&"location"!==s.getActionType()||s.disable()}},e.prototype.enableActions=function(){for(var e=0,t=this._actions;e<t.length;e++){t[e].enable()}},e}();t.CardComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LocationMessageComponent=void 0;var s=n(5),r=n(18),a=function(e){function t(t,n,i,o,s,r,a){var c=e.call(this,t,n,i,o,s,r,a)||this;return c._title=i.location.title,c._url=i.location.url,c._longitude=i.location.longitude,c._latitude=i.location.latitude,c._date=s,c}return o(t,e),t.prototype.render=function(){if(0===this.actions.length){var t={actionId:"locationAction1",label:this.settings.i18n[this.settings.locale].openMap,type:s.ACTION_TYPE.URL,url:this._url||"http://www.google.com/maps?z=12&t=m&q=loc:"+this._latitude+"+"+this._longitude};this.actions.push(new r.UrlActionComponent(this.utils,t,this.settings.openLinksInNewWindow,this.settings.linkHandler))}return e.prototype.render.call(this)},t.prototype.getContent=function(){var e=this.utils.createSpan();return this._title?e.innerText=this._title:e.innerText=this._latitude.toFixed(6)+", "+this._longitude.toFixed(6),e},t}(n(2).MessageComponent);t.LocationMessageComponent=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RawMessageComponent=void 0;var s=function(e){function t(t,n,i,o,s,r,a){var c=e.call(this,t,n,i,o,s,r,a)||this;return c._date=s,c._payload=JSON.stringify(i.payload),c}return o(t,e),t.prototype.getContent=function(){var e=this.utils.createSpan();return e.innerText=this._payload,e},t}(n(2).MessageComponent);t.RawMessageComponent=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextMessageComponent=void 0;var s=n(0),r=n(2),a=function(e){function t(t,n,i,o,s,r,a){var c=e.call(this,t,n,i,o,s,r,a)||this;return c._text=i.text,c._date=s,c}return o(t,e),t.prototype.getContent=function(){var e=this.utils.createDiv();return e.innerHTML=this.utils.linkify(this._text,{embeddedHTML:this.side===r.MESSAGE_SIDE.LEFT,embeddedVideo:!0}),this.settings.linkHandler?s.utils.setEmbeddedLinksHandler(e,this.settings.linkHandler):this.settings.openLinksInNewWindow&&s.utils.setLinksOpenInNewWindow(e),e},t}(r.MessageComponent);t.TextMessageComponent=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingMessageComponent=void 0;var i=n(47),o=n(2),s=function(){function e(e,t,n,i){this.text=e,this.side=t,this.utils=n,this.settings=i}return e.prototype.render=function(){this._element=this.utils.createDiv(["message",this.side]);var e=this.utils.createDiv(["message-wrapper"]),t=this.utils.createDiv(["message-bubble"]),n=this.utils.createDiv(["message-content","loading-icon"]),s=this.side===o.MESSAGE_SIDE.LEFT?this.settings.botIcon:this.settings.personIcon;if(s){var r=this.utils.createDiv(["icon-wrapper"]);r.appendChild(this.utils.createImage(s,["message-icon"])),e.appendChild(r)}var a=this.utils.createDiv(["message-text"]);return a.innerText=this.text,n.appendChild(new i.SpinnerComponent(this.utils).render()),n.appendChild(a),t.appendChild(n),e.appendChild(t),this._element.appendChild(e),this._element},e.prototype.remove=function(){this._element.remove()},e}();t.LoadingMessageComponent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpinnerComponent=void 0;var i=function(){function e(e){this.utils=e}return e.prototype.render=function(){var e=this.utils.createDiv(["spinner"]);return e.innerHTML='<svg viewBox="0 0 64 64"><circle transform="translate(32,32)" r="26"></circle></svg>',e},e}();t.SpinnerComponent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStringComponent=void 0;var i=n(2),o=function(){function e(e,t,n,i){this.text=e,this.side=t,this.utils=n,this.settings=i}return e.prototype.render=function(e){this._element=this.utils.createDiv(["message",this.side]);var t=this.utils.createDiv(["message-wrapper"]),n=this.utils.createDiv(["message-bubble"]),o=this.utils.createDiv(["message-content"]),s=this.side===i.MESSAGE_SIDE.LEFT?this.settings.botIcon:this.settings.personIcon;if(s){var r=this.utils.createDiv(["icon-wrapper"]);r.appendChild(this.utils.createImage(s,["message-icon"])),t.appendChild(r)}if(e){o.classList.add(this.utils.getCssClassWithPrefix("message-with-icon"));var a=this.utils.createDiv(["error-icon"]);a.appendChild(this.utils.createImage(e,[],"")),o.appendChild(a)}var c=this.utils.createDiv(["message-text"]);return c.innerText=this.text,o.appendChild(c),n.appendChild(o),t.appendChild(n),this._element.appendChild(t),this._element},e}();t.MessageStringComponent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusComponent=void 0;var i=function(){function e(e,t,n){this.message=e,this.utils=t,this.image=n,this._element=t.createDiv(["status-message-container"]),this._element.setAttribute("role","alert");var i=t.createDiv(["status-message-wrapper"]);if(n){var o=t.createImage(n,["status-image"],"");i.appendChild(o)}var s=t.createDiv(["status-message"]);s.textContent=e,i.appendChild(s),this._element.appendChild(i)}return e.prototype.remove=function(){this._element.remove()},e.prototype.render=function(){return this._element},e}();t.StatusComponent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypingIndicatorComponent=void 0;var i=n(9),o=n(0),s=n(20),r=function(){function e(e,t){var n,o;this.side=e,this.settings=t,this.svgString=i.SVG_SPRITE.icon_bot_message_bubble,(null===(n=this.settings.colors)||void 0===n?void 0:n.conversationBackground)&&(this.svgString=this.svgString.replace(/#fff/gi,this.settings.colors.conversationBackground)),(null===(o=this.settings.colors)||void 0===o?void 0:o.typingIndicator)&&(this.svgString=this.svgString.replace(/#d1d1d1/gi,this.settings.colors.typingIndicator)),this.utils=new s.Utils(t),this.element=this.render(),this.visible=!1}return e.prototype.append=function(e){var t=this;this.isVisible()||(e.appendChild(this.element),this.visible=!0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout((function(){t.remove()}),1e3*this.settings.typingIndicatorTimeout))},e.prototype.remove=function(){this.isVisible()&&(this.element.remove(),this.visible=!1)},e.prototype.isVisible=function(){return this.visible},e.prototype.render=function(){var e,t,n=this.utils.createDiv(["message",this.side]),i=this.utils.createDiv(["bubble-wrapper"]);i.setAttribute("aria-live","off"),i.setAttribute("aria-hidden","true");var s=null!==(e=this.settings.chatBubbleIcon)&&void 0!==e?e:this.svgString,r=this.settings.i18n[this.settings.locale].typingIndicator;return o.utils.isSvg(s)?((t=this.utils.createElementFromString(s)).setAttribute("role","img"),t.setAttribute("aria-label",r)):t=this.utils.createImage(s,[],r),t.style.height=this.settings.chatBubbleIconHeight||t.style.height,t.style.width=this.settings.chatBubbleIconWidth||t.style.width,i.appendChild(t),n.appendChild(i),n},e}();t.TypingIndicatorComponent=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechSynthesisService=void 0;var i=function(){function e(){if(!speechSynthesis)throw new Error("SpeechSynthesis API not available on your device.");this._setDefaultVoice(),window.addEventListener("beforeunload",(function(e){speechSynthesis.cancel(),delete e.returnValue}))}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.speak=function(e){if(speechSynthesis){var t=new SpeechSynthesisUtterance;t.voice=this.botVoice,t.text=e,t.rate=1,speechSynthesis.paused&&speechSynthesis.resume(),speechSynthesis.speak(t)}},e.prototype.cancel=function(){(null===speechSynthesis||void 0===speechSynthesis?void 0:speechSynthesis.speaking)&&speechSynthesis.cancel()},e.prototype.pause=function(){(null===speechSynthesis||void 0===speechSynthesis?void 0:speechSynthesis.speaking)&&speechSynthesis.pause()},e.prototype.resume=function(){speechSynthesis&&speechSynthesis.resume()},e.prototype.setVoice=function(e){var t=this,n=this.botVoice;this._getVoices().then((function(i){var o=function(e,t){return(e=e.toLowerCase())===(t=t.toLowerCase())};t.botVoice=void 0,e.forEach((function(e){e.lang=e.lang||"",e.name=e.name||""})),e.every((function(e){if(e.lang.length>0&&e.name.length>0)for(var n=0,s=i;n<s.length;n++){var r=s[n];if(o(r.name,e.name)&&o(r.lang,e.lang)){t.botVoice=r;break}}return void 0===t.botVoice})),t.botVoice||e.every((function(e){for(var n=0,s=i;n<s.length;n++){var r=s[n];if(o(r.lang,e.lang)){t.botVoice=r;break}}return void 0===t.botVoice})),t.botVoice||(t.botVoice=n)}))},e.prototype._setDefaultVoice=function(){var e=this;speechSynthesis&&this._getVoices().then((function(t){(null===navigator||void 0===navigator?void 0:navigator.language)&&(e.botVoice=t.filter((function(e){return e.lang===navigator.language}))[0]),e.botVoice||(e.botVoice=null==t?void 0:t.filter((function(e){return e.default}))[0]),e.botVoice||(e.botVoice=t[0])}))},e.prototype._getVoices=function(){var e=function(e){return Array.isArray(e)||(e=e._list),e};return new Promise((function(t){var n=speechSynthesis.getVoices();n.length?t(e(n)):speechSynthesis.addEventListener("voiceschanged",(function(){n=speechSynthesis.getVoices(),t(e(n))}))}))},e}();t.SpeechSynthesisService=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.StyleComponent=void 0;var o=n(4),s=n(53),r=function(){function e(e,t){this.utils=e,this.settings=t,this.setWidgetTheme()}return e.prototype.addStyle=function(t){e.STYLE=e.STYLE+t},e.prototype.setWidgetCssClasses=function(){var e,t,n,i,o,s,r="message-actions .action-postback",a=[],c=[],l=[],h=[],u=[],d=[],p=[],g=[],f=[],m=[],v=[],_=[],b=[],y=[],C=[],S=[],T=[],x=[],E=[],w=[],A=[],O=[],I=[],P=[],k=[],M=[],L=[],D=[],N=[],R=[],B=[],U=[],F=[],H=[],V=function(e,t){var n="";return(null==t?void 0:t.length)>0&&(n="."+e+" {\n",t.forEach((function(e){n+="  "+e+";\n"})),n+="}\n\n"),n},Y=function(e){return V(e,["display: none"])},W="",z="@media screen and (min-width: 426px) {\n";if(this.settings.enableHeadless)return W+=Y("wrapper"),W+=Y("widget"),W+=Y("button"),W+=Y("notification-badge");if(this.settings.colors){var j=this.settings.colors;if(j.recognitionViewButtonFill=j.recognitionViewButtonFill||j.footerButtonFill,j.actionsBackground&&_.push("background: "+j.actionsBackground),j.actionsBackgroundFocus&&b.push("background: "+j.actionsBackgroundFocus),j.actionsBackgroundHover&&y.push("background: "+j.actionsBackgroundHover),j.actionsBorder?(_.push("border-color: "+j.actionsBorder),_.push("border-style: solid"),_.push("border-width: 1px")):_.push("border-style: none"),j.actionsText&&_.push("color: "+j.actionsText),j.actionsTextFocus&&b.push("color: "+j.actionsTextFocus),j.actionsTextHover&&y.push("color: "+j.actionsTextHover),j.botMessageBackground&&(m.push("background: "+j.botMessageBackground),P.push("background: "+j.botMessageBackground)),j.botText){var G="color: "+j.botText;m.push(G),x.push(G),k.push(G)}if(j.branding){var q=["outline-color: "+j.branding];W+=V("footer-button:focus:enabled",q),l.push("background: "+j.branding),N.push("fill: "+j.branding),L.push("caret-color: "+j.branding),j.visualizer||(j.visualizer=j.branding)}if(j.cardBackground&&x.push("background: "+j.cardBackground),j.cardNavButton&&w.push("background: "+j.cardNavButton),j.cardNavButtonFocus&&A.push("background: "+j.cardNavButtonFocus),j.cardNavButtonHover&&O.push("background: "+j.cardNavButtonHover),j.conversationBackground&&f.push("background: "+j.conversationBackground),j.footerBackground&&(M.push("background: "+j.footerBackground),j.inputBackground||L.push("background: "+j.footerBackground),j.footerBackground===j.conversationBackground&&M.push("border-top: 1px solid #dadada")),j.footerButtonFill&&D.push("fill: "+j.footerButtonFill),j.footerInlineButtonFill&&F.push("fill: "+j.footerInlineButtonFill),j.globalActionsBackground&&(C.push("background: "+j.globalActionsBackground),C.push("border-style: solid"),C.push("border-width: 1px")),j.globalActionsBackgroundFocus&&S.push("background: "+j.globalActionsBackgroundFocus),j.globalActionsBackgroundHover&&T.push("background: "+j.globalActionsBackgroundHover),j.globalActionsBorder&&C.push("border-color: "+j.globalActionsBorder),j.globalActionsText&&C.push("color: "+j.globalActionsText),j.globalActionsTextFocus&&S.push("color: "+j.globalActionsBackgroundFocus),j.globalActionsTextHover&&T.push("color: "+j.globalActionsTextHover),j.headerBackground||(j.headerBackground=j.branding),j.headerBackground&&(u.push("background: "+j.headerBackground),d.push("background: "+j.headerBackground),j.recognitionViewBackground||(B.push("background: "+j.headerBackground),U.push("background: "+j.headerBackground))),j.headerButtonFill&&(p.push("fill: "+j.headerButtonFill),W+=V("header-button:focus:enabled",["outline-color: "+j.headerButtonFill])),j.headerText&&g.push("color: "+j.headerText),j.inputBackground?L.push("background: "+j.inputBackground):j.footerBackground&&L.push("background: "+j.footerBackground),j.inputText&&L.push("color: "+j.inputText),j.links&&I.push("color: "+j.links),j.notificationBadgeBackground&&h.push("background: "+j.notificationBadgeBackground),j.notificationBadgeText&&h.push("color: "+j.notificationBadgeText),j.recognitionViewBackground&&(B.push("background: "+j.recognitionViewBackground),U.push("background: "+j.recognitionViewBackground)),j.recognitionViewButtonFill&&H.push("fill: "+j.recognitionViewButtonFill),j.recognitionViewText&&U.push("color: "+j.recognitionViewText),j.text){G="color: "+j.text;a.push(G),j.botText||m.push(G),j.userText||v.push(G),j.recognitionViewText||U.push(G)}j.textLight&&E.push("color: "+j.textLight),j.userMessageBackground&&(v.push("background: "+j.userMessageBackground),j.visualizerContainerBackground||R.push("background: "+j.userMessageBackground)),j.userText&&v.push("color: "+j.userText),j.visualizerContainerBackground&&R.push("background: "+j.visualizerContainerBackground)}return this.settings.font&&(L.push("font: "+this.settings.font),U.push("font: "+this.settings.font),a.push("font: "+this.settings.font),m.push("font: "+this.settings.font),v.push("font: "+this.settings.font)),this.settings.embedded||((null===(e=this.settings.position)||void 0===e?void 0:e.bottom)&&(a.push("bottom: "+this.settings.position.bottom),c.push("bottom: -"+this.settings.position.bottom)),(null===(t=this.settings.position)||void 0===t?void 0:t.right)&&(a.push("right: "+this.settings.position.right),c.push("right: -"+this.settings.position.right)),this.settings.badgePosition.bottom&&h.push("bottom: "+this.settings.badgePosition.bottom),this.settings.badgePosition.left&&h.push("left: "+this.settings.badgePosition.left),this.settings.badgePosition.right&&h.push("right: "+this.settings.badgePosition.right),this.settings.badgePosition.top&&h.push("top: "+this.settings.badgePosition.top)),W+=V("wrapper",a),W+=V("widget",c),W+=V("button",l),W+=V("notification-badge",h),W+=V("header",u),W+=V("header-button",d),W+=V("header-button svg",p),W+=V("header, .title, .subtitle",g),W+=V("conversation",f),W+=V("left .message-bubble, .left .message-header, .left .message-footer",m),W+=V("right .message-bubble",v),W+=V(r,_),W+=V(r+":focus:enabled",b),W+=V(r+":hover:enabled",y),W+=V("message-global-actions .action-postback",C),W+=V("message-global-actions .action-postback:focus:enabled",S),W+=V("message-global-actions .action-postback:hover:enabled",T),W+=V("card",x),W+=V("card-description",E),W+=V("card-actions .action-postback",_),W+=V("card-actions .action-postback:focus:enabled",b),W+=V("card-actions .action-postback:hover:enabled",y),W+=V("round",w),W+=V("round:focus:enabled",A),W+=V("round:hover:enabled",O),W+=V("message-content a",I),W+=V("card-message-content a",I),W+=V("status-message-wrapper",P),W+=V("status-message",k),W+=V("footer",M),W+=V("user-input",L),W+=V("footer-button svg",D),W+=V("footer-button:hover:enabled .footer-button-svg-icon",N),W+=V("share-popup-item:hover:enabled .share-popup-item-svg-icon",N),W+=V("share-popup-item:focus:enabled .share-popup-item-svg-icon",N),W+=V("footer-visualizer-wrapper",R),W+=V("footer-recognition-wrapper",B),W+=V("recognition-text-view",U),W+=V("footer-button.button-send-inline svg",F),W+=V("button-switch-kbd .footer-button-svg-icon",H),a.splice(0,a.length),c.splice(0,c.length),this.settings.embedded||(c.push("border-radius: 4px"),(null===(n=this.settings.position)||void 0===n?void 0:n.bottom)&&(a.push("bottom: "+this.settings.position.bottom),c.push("bottom: 0"),c.push("max-height: calc(100vh - "+this.settings.position.bottom+" - 60px)")),(null===(i=this.settings.position)||void 0===i?void 0:i.left)&&a.push("left: "+this.settings.position.left),(null===(o=this.settings.position)||void 0===o?void 0:o.right)&&(a.push("right: "+this.settings.position.right),c.push("right: 0"),c.push("max-width: calc(100vw - "+this.settings.position.right+")")),(null===(s=this.settings.position)||void 0===s?void 0:s.top)&&a.push("top: "+this.settings.position.top),this.settings.height&&c.push("height: "+this.settings.height),this.settings.width&&c.push("width: "+this.settings.width)),z+=V("wrapper",a),z+=V("widget",c),W+(z+="}\n")},e.prototype.render=function(){return this.utils.createStyle(e.STYLE.replace(/(\.)([a-zA-Z_-]+)(?=[^}]+{)/gi,"$1"+this.settings.name+"-$2"))},e.prototype.setWidgetTheme=function(){switch(this.preInitColors(),this.settings.theme){case o.IWidgetTheme.CLASSIC:this.settings.colors=i(i({},e.THEME_CLASSIC),this.settings.colors);break;case o.IWidgetTheme.DEFAULT:this.settings.colors=i(i({},e.THEME_DEFAULT),this.settings.colors);break;case o.IWidgetTheme.REDWOOD_DARK:this.settings.colors=i(i({},e.THEME_REDWOOD_DARK),this.settings.colors);break;default:this.settings.colors=i(i({},e.THEME_DEFAULT),this.settings.colors)}},e.prototype.preInitColors=function(){var e,t,n,i;this.settings.colors.branding&&(this.settings.colors.headerBackground=null!==(e=this.settings.colors.headerBackground)&&void 0!==e?e:this.settings.colors.branding),this.settings.colors.text&&(this.settings.colors.inputText=null!==(t=this.settings.colors.inputText)&&void 0!==t?t:this.settings.colors.text,this.settings.colors.botText=null!==(n=this.settings.colors.botText)&&void 0!==n?n:this.settings.colors.text,this.settings.colors.userText=null!==(i=this.settings.colors.userText)&&void 0!==i?i:this.settings.colors.text)},e.STYLE=s.css,e.THEME_REDWOOD_DARK={branding:"#c0533f",text:"#161513",textLight:"#fcfbfa",headerBackground:"#201e1c",headerButtonFill:"#fff",headerText:"#fff",conversationBackground:"#3a3631",typingIndicator:"#fff",botMessageBackground:"#655f5c",botText:"#fff",userMessageBackground:"#fff",userText:"#161513",cardBackground:"#655f5c",cardNavButton:"#d5b364",cardNavButtonFocus:"#f7e0a1",cardNavButtonHover:"#b39554",actionsBackground:"#655f5c",actionsBackgroundFocus:"#1615137f",actionsBackgroundHover:"#1615134d",actionsBorder:"#fff",actionsText:"#fff",globalActionsBackground:"#3a3631",globalActionsBackgroundFocus:"#1615137f",globalActionsBackgroundHover:"#201e1c4d",globalActionsBorder:"#fff",globalActionsText:"#fff",links:"#f7e0a1",footerBackground:"#201e1c",footerButtonFill:"#fff",footerInlineButtonFill:"#1a1816",inputBackground:"#fcfbfa",inputText:"#161513",recognitionViewText:"#fff",visualizer:"#cbe9d6",visualizerContainerBackground:"#312d2a",notificationBadgeBackground:"#312d2a",notificationBadgeText:"#fff"},e.THEME_DEFAULT={branding:"#025e7e",text:"#161513",textLight:"#3a3631",headerBackground:"#025e7e",headerButtonFill:"#fff",headerText:"#fff",conversationBackground:"#fff",typingIndicator:"#227e9e",botMessageBackground:"#e5f1ff",userMessageBackground:"#ececec",cardBackground:"#fcfbfa",cardNavButton:"#4190ac",cardNavButtonFocus:"#5fa2ba",cardNavButtonHover:"#0e7295",actionsBackground:"#025e7e",actionsBackgroundFocus:"#053242",actionsBackgroundHover:"#06485f",actionsBorder:"#025e7e",actionsText:"#fff",globalActionsBackground:"#fff",globalActionsBackgroundFocus:"#053242",globalActionsBackgroundHover:"#025e7e",globalActionsBorder:"#0e7295",globalActionsText:"#0e7295",links:"#0e7295",footerBackground:"#fff",inputBackground:"#fff",inputText:"#161513",recognitionViewButtonFill:"#fff",recognitionViewText:"#fff",notificationBadgeBackground:"#9a0007",notificationBadgeText:"#fff"},e.THEME_CLASSIC={branding:"#1b8fd2",text:"#212121",textLight:"#737373",conversationBackground:"#fff",footerBackground:"#fff",headerButtonFill:"#fff",botMessageBackground:"#e5f1ff",userMessageBackground:"#ececec",actionsBackground:"#0099ff",actionsBackgroundHover:"#005c99",globalActionsBackground:"#fff",globalActionsBackgroundHover:"#0099ff",globalActionsBorder:"#0099ff",globalActionsText:"#0099ff",globalActionsTextHover:"#fff",links:"#0770bf",cardNavButtonHover:"#0099ff",recognitionViewButtonFill:"#fff",recognitionViewText:"#fff"},e}();t.StyleComponent=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.css=void 0;var i=n(54),o=n(56),s=n(58),r=n(60),a=n(62),c=n(64),l=n(66),h=n(68),u=n(70),d=""+i+r+o+s+a+c+l+h+n(72)+u+n(74)+n(76)+n(78);t.css=d},function(e,t,n){var i=n(55);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,"/* wrapper base state */\n.wrapper {\n    box-sizing: border-box;\n    height: 0;\n    position: fixed;\n    text-transform: none;\n    width: 0;\n    z-index: 10000;\n    transition: all 0.25s ease-in-out;\n}\n\n/* button base state */\n.button {\n    background-position: center center;\n    background-repeat: no-repeat;\n    border: none;\n    bottom: 0;\n    cursor: pointer;\n    overflow: visible;\n    padding: 0;\n    position: absolute;\n    right: 0;\n    text-align: center;\n    z-index: 10000;\n    transition: height 0.25s ease-out, width 0.25s ease-out;\n}\n\n.expanded .button {\n    -webkit-animation: scale-out-center 0.25s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;\n            animation: scale-out-center 0.25s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;\n}\n\n.collapsed .button {\n    display: flex;\n    -webkit-animation: scale-in-center 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n            animation: scale-in-center 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n}\n\n.button img {\n    max-height: 100%;\n    max-width: 100%;\n}\n\n.notification-badge {\n    align-items: center;\n    background: #e6081a;\n    border-radius: 24px;\n    color: #ffffff;\n    display: flex;\n    font-size: 14px;\n    height: 24px;\n    justify-content: center;\n    position: absolute;\n    text-align: center;\n    width: 32px;\n}\n\n/* Widget base state */\n.widget {\n    background: #ffffff;\n    display: flex;\n    flex-direction: column;\n    margin: 0;\n    overflow: hidden;\n    position: absolute;\n    text-decoration: none;\n    text-transform: none;\n    z-index: 10000;\n}\n\n.expanded .widget {\n    -webkit-animation: scale-in-br 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n            animation: scale-in-br 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n}\n\n.collapsed .widget {\n    -webkit-animation: scale-out-br 0.25s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;\n\t        animation: scale-out-br 0.25s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;\n}\n\n.none {\n    display: none;\n}\n\n.conversation-pane {\n    display: flex;\n    flex: 1 1 auto;\n    flex-direction: column;\n}\n\n.conversation-container {\n    padding: 10px 12px 0 12px;\n}\n\n.empty-conversation-div {\n    display: flex;\n    flex: auto;\n}\n\n.message-date {\n    font-size: 10px;\n    margin: 4px 4px 0;\n}\n\n.embed-sticky-top {\n    padding-top: 5px;\n    padding-bottom: 5px;\n}\n\n.embed-scroll-top {\n    padding-top: 5px;\n    padding-bottom: 10px;\n}\n\n.embed-scroll-bottom {\n    padding-top: 10px;\n    padding-bottom: 5px;\n}\n\n.embed-sticky-bottom {\n    padding-top: 5px;\n    padding-bottom: 5px;\n}\n\n/* Chat responsive layouts */\n\n/* Mobile layout */\n.wrapper {\n    bottom: 20px;\n    right: 10px;\n}\n\n.button {\n    height: 48px;\n    width: 48px;\n}\n\n.button-icon {\n    max-height: 48px;\n    max-width: 48px;\n}\n\n.widget {\n    bottom: -20px;\n    height: 85vh;\n    max-height: calc(100vh - 60px);\n    max-width: 100vw;\n    right: -10px;\n    width: 100vw;\n    transition: all 0.25s ease-in-out;\n}\n\n/* Large mobile and tablet layout */\n@media screen and (min-width: 426px) {\n    .widget {\n        bottom: 0;\n        height: 85vh;\n        /* 20px compensation for bottom position of wrapper */\n        max-height: calc(100vh - 20px - 60px);\n        /* 10px compensation for right position of wrapper and next 10px for balanced look */\n        max-width: calc(100vw - 10px - 10px);\n        min-width: 300px;\n        right: 0;\n        width: 300px;\n    }\n}\n\n/* Desktop layout */\n@media screen and (min-width: 769px) {\n    .wrapper {\n        bottom: 20px;\n        right: 20px;\n    }\n\n    .button {\n        height: 64px;\n        width: 64px;\n    }\n\n    .button-icon {\n        max-height: 64px;\n        max-width: 64px;\n    }\n\n    .widget {\n        height: 70vh;\n        /* 20px compensation for bottom position of wrapper */\n        max-height: calc(100vh - 20px - 60px);\n        max-width: 512px;\n        width: 30vw;\n    }\n}\n\n/* Chat button entrance */\n@-webkit-keyframes scale-in-center {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n    }\n}\n\n@keyframes scale-in-center {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n    }\n}\n\n/* Chat button exit */\n@-webkit-keyframes scale-out-center {\n    0% {\n        display: flex;\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n    }\n    100% {\n        display: none;\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n    }\n}\n\n@keyframes scale-out-center {\n    0% {\n        display: flex;\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n    }\n    100% {\n        display: none;\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n    }\n}\n\n/* Chat widget entrance */\n@-webkit-keyframes scale-in-br {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n}\n\n@keyframes scale-in-br {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n}\n\n/* Chat widget exit */\n@-webkit-keyframes scale-out-br {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    99% {\n        opacity: 1;\n        -webkit-transform: scale(0.01);\n                transform: scale(0.01);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    100% {\n        display: none;\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n}\n\n@keyframes scale-out-br {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    99% {\n        opacity: 1;\n        -webkit-transform: scale(0.01);\n                transform: scale(0.01);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n    100% {\n        display: none;\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 100% 100%;\n                transform-origin: 100% 100%;\n    }\n}\n\n@media (prefers-reduced-motion: reduce) {\n    .button, .widget, .autocomplete-items, .status-message-wrapper, .share-popup-expand {\n        animation: none;\n    }\n\n    .conversation, .card-message-horizontal .card-message-cards {\n        scroll-behavior: auto;\n    }\n}\n",""]),e.exports=t},function(e,t,n){var i=n(57);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".footer {\n    align-items: center;\n    background-color: #ffffff;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: row;\n    position: relative;\n    text-align: start;\n}\n\n.footer-mode-keyboard {\n    align-items: center;\n    flex: 1;\n    flex-direction: row;\n    justify-content: center;\n    max-height: 78px;\n    padding: 8px 6px 8px 4px;\n}\n\n.footer-mode-voice {\n    flex-direction: column;\n    display: flex;\n    flex: 1;\n}\n\n.footer-visualizer-wrapper {\n    align-items:  center;\n    display: flex;\n    flex-direction: row;\n    height: 48px;\n    justify-content: center;\n    padding: 8px;\n    width: 100%;\n}\n\n.footer-recognition-wrapper {\n    align-items: center;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: row;\n    height: 48px;\n    padding: 8px 6px 8px 8px;\n    width: 100%;\n}\n\n.footer.mode-keyboard .footer-mode-keyboard {\n    display: flex;\n}\n\n.footer.mode-voice .footer-mode-keyboard {\n    display: none;\n}\n\n.footer.mode-keyboard .footer-mode-voice {\n    display: none;\n}\n\n.footer.mode-voice .footer-mode-voice {\n    display: flex;\n}\n\n.footer-button {\n    align-items: center;\n    background-color: transparent;\n    border: none;\n    cursor: pointer;\n    display: flex;\n    height: 32px;\n    -webkit-tap-highlight-color: transparent;\n    justify-content: center;\n    max-height: 32px;\n    max-width: 32px;\n    overflow: hidden;\n    padding: 4px;\n    width: 32px;\n    text-shadow: none;\n}\n\n.footer-button-icon {\n    background-size: 100%;\n    background-position: center;\n    height: 100%;\n    margin: auto;\n    padding: 0;\n    width: 100%;\n}\n\n.footer-button-svg-icon {\n    height: 24px;\n    fill: #787570;\n    width: 24px;\n}\n\n.footer-button:disabled .footer-button-svg-icon,\n.footer-button:disabled .footer-button-svg-icon:active,\n.footer-button:disabled .footer-button-svg-icon:hover {\n    fill: #bbb6b2;\n}\n\n.button-upload {\n    margin-left: 2px;\n}\n\n.button-speech-active {\n    animation: mic-toggle 400ms ease 0s infinite normal none running;\n}\n\n@keyframes mic-toggle {\n    from {\n        fill: #ff8a80;\n    }\n\n    to {\n        fill: #d50000;\n    }\n}\n\n.user-input {\n    border: 1px solid #dadada;\n    border-radius: 16px;\n    box-sizing: border-box;\n    color: #333333;\n    flex: 1;\n    height: 32px;\n    margin-left: 6px;\n    margin-right: 6px;\n    min-height: 32px;\n    max-height: 61px;\n    outline: none;\n    padding: 6px 14px;\n    resize: none;\n}\n\n.user-input::placeholder {\n    color: #787570;\n}\n\n.user-input.disabled {\n    color: #737373;\n}\n\n.user-input.disabled::placeholder {\n    color: #bbb6b2;\n}\n\n.user-input.user-input-inline-send {\n    padding: 6px 40px 6px 14px;\n}\n\n.autocomplete-items {\n    border: 1px solid #bababa;\n    border-radius: 6px 6px 0 0;\n    bottom: 100%;\n    left: 0;\n    margin: 0 32px;\n    max-height: 240px;\n    overflow-y: auto;\n    position: absolute;\n    right: 0;\n    z-index: 1;\n    -webkit-animation: popup-suggestion .150s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;\n    animation: popup-suggestion .150s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;\n}\n\n.autocomplete-items div {\n    background-color: #fff;\n    color: #161513;\n    cursor: pointer;\n    font-size: 16px;\n    min-height: 44px;\n    padding: 10px;\n    text-align: start;\n}\n\n.autocomplete-items strong {\n    font-weight: 700;\n}\n\n.autocomplete-items div:hover {\n    background-color: #e9e9e9;\n}\n\n.autocomplete-items .autocomplete-active {\n    background-color: #85bbe7;\n}\n\n.autocomplete-items .autocomplete-active:hover {\n    background-color: #85bbe7;\n}\n\n.button-send-inline {\n    position: absolute;\n    right: 52px;\n}\n\n.recognition-text-view {\n    border: none;\n    flex: 1;\n    font-size: 16px;\n    margin: 0 8px;\n    pointer-events: none;\n}\n\n.share-popup {\n    background-color: #fcfbfa;\n    border: 1px solid #dadada;\n    border-radius: 4px;\n    bottom: 90%;\n    display: none;\n    left: 8px;\n    padding: 8px;\n    position: absolute;\n    z-index: 2;\n}\n\n.share-popup::after {\n    border-left: 8px solid transparent;\n    border-right: 8px solid transparent;\n    border-top: 8px solid #fcfbfa;\n    content: '';\n    height: 0;\n    left: 8px;\n    position: absolute;\n    top: 100%;\n    width: 0;\n}\n\n.share-popup-expand {\n    display: flex;\n    -webkit-animation: scale-in-bl 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n    animation: scale-in-bl 0.25s cubic-bezier(0.250, 0.460, 0.450, 0.940) 0.2s both;\n}\n\n.share-popup-list {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-evenly;\n}\n\n.share-popup-list {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n}\n\n.share-popup-list li {\n    border-bottom: 1px solid #dadada;\n    padding-top: 2px;\n    padding-bottom: 2px;\n}\n\n.share-popup-list li:last-of-type {\n    border-bottom: none;\n}\n\n.share-popup-item {\n    align-items: center;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    display: flex;\n    flex: 1;\n    font-size: 13.75px;\n    font-weight: bold;\n    height: 40px;\n    padding: 8px;\n    text-align: start;\n    width: 100%;\n}\n\n.share-popup-item:hover, .share-popup-item:focus {\n    background-color: #ffffff;\n}\n\n.share-popup-item-svg-icon {\n    height: 24px;\n    fill: #787570;\n    max-height: 24px;\n    max-width: 24px;\n    width: 24px;\n}\n\n.share-popup-item-text {\n    margin-left: 8px;\n}\n\n@-webkit-keyframes popup-suggestion {\n    0% {\n        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0), 0 0 0 0 rgba(0, 0, 0, 0);\n        -webkit-box-shadow: inset 0 0 0 0 rgba(0, 0, 0, 0);\n        box-shadow: inset 0 0 0 0 rgba(0, 0, 0, 0);\n        -webkit-transform: scaleY(0.4);\n        transform: scaleY(0.4);\n        -webkit-transform-origin: 0% 100%;\n        transform-origin: 0% 100%;\n    }\n\n    100% {\n        box-shadow: 0 -12px 20px -12px rgba(0, 0, 0, 0.35);\n        -webkit-transform: scaleY(1);\n        transform: scaleY(1);\n        -webkit-transform-origin: 0% 100%;\n        transform-origin: 0% 100%;\n    }\n}\n\n@keyframes popup-suggestion {\n    0% {\n        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0), 0 0 0 0 rgba(0, 0, 0, 0);\n        -webkit-transform: scaleY(0.4);\n        transform: scaleY(0.4);\n        -webkit-transform-origin: 0% 100%;\n        transform-origin: 0% 100%;\n    }\n\n    100% {\n        box-shadow: 0 -12px 15px -12px rgba(0, 0, 0, 0.35);\n        -webkit-transform: scaleY(1);\n        transform: scaleY(1);\n        -webkit-transform-origin: 0% 100%;\n        transform-origin: 0% 100%;\n    }\n}\n\n@-webkit-keyframes scale-in-bl {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 0% 100%;\n                transform-origin: 0% 100%;\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 0% 100%;\n                transform-origin: 0% 100%;\n    }\n}\n\n@keyframes scale-in-bl {\n    0% {\n        opacity: 1;\n        -webkit-transform: scale(0);\n                transform: scale(0);\n        -webkit-transform-origin: 0% 100%;\n                transform-origin: 0% 100%;\n    }\n    100% {\n        opacity: 1;\n        -webkit-transform: scale(1);\n                transform: scale(1);\n        -webkit-transform-origin: 0% 100%;\n                transform-origin: 0% 100%;\n    }\n}\n",""]),e.exports=t},function(e,t,n){var i=n(59);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".header {\n    align-items: center;\n    box-sizing: border-box;\n    color: #ffffff;\n    display: flex;\n    flex-direction: row;\n    height: 48px;\n    padding-left: 10px;\n    padding-right: 8px;\n    text-align: start;\n}\n\n.logo {\n    flex: 0;\n    height: 24px;\n    max-height: 32px;\n    max-width: 32px;\n    min-height: 16px;\n    width: 24px;\n}\n\n.header-info-wrapper {\n    align-items: flex-start;\n    display: flex;\n    flex-direction: column;\n    flex-wrap: nowrap;\n    margin: 0 8px;\n    min-width: 0;\n}\n\n.title {\n    color: #ffffff;\n    font-size: 18px;\n    justify-content: center;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.subtitle {\n    color: #ffffff;\n    font-size: 14px;\n    justify-content: center;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.connection-status {\n    font-weight: bold;\n    font-size: 10px;\n    justify-content: center;\n    text-transform: uppercase;\n}\n\n.header-custom-element {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    word-break: break-all;\n}\n\n.header-actions {\n    display: flex;\n    flex: 1;\n    justify-content: flex-end;\n}\n\n.header-button {\n    align-items: center;\n    border: none;\n    border-radius: 2px;\n    display: flex;\n    height: 32px;\n    justify-content: center;\n    margin-left: 8px;\n    max-height: 32px;\n    max-width: 32px;\n    padding: 4px;\n    width: 32px;\n}\n\n.header-button svg {\n    fill: #ffffff;\n}\n\n.header-button:hover {\n    filter: brightness(1.2);\n}\n\n.header-button:active {\n    filter: brightness(0.875);\n}\n\n.header-button-icon {\n    height: 24px;\n    width: 24px;\n}\n\n.header-button-img-icon {\n    max-height: 100%;\n    max-width: 100%;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(61);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,'.conversation {\n    background: #ffffff;\n    box-sizing: border-box;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-flex: 1;\n    -ms-flex: 1;\n    flex: 1;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n    -ms-flex-direction: column;\n    flex-direction: column;\n    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;\n    overflow: auto;\n    scroll-behavior: smooth;\n    width: 100%;\n}\n',""]),e.exports=t},function(e,t,n){var i=n(63);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".message-actions {\n    display: flex;\n    flex-direction: column;\n}\n\n.message-actions .action-postback {\n    align-items: center;\n    border-radius: 4px;\n    color: #ffffff;\n    cursor: pointer;\n    display: flex;\n    font-size: 13.75px;\n    font-weight: bold;\n    flex: 1;\n    justify-content: center;\n    padding: 12px 24px;\n    margin: 4px;\n    text-decoration: none;\n}\n\n.message-actions .action-postback:focus, .message-actions a.action-postback:active {\n    background: #004d80;\n}\n\n.message-actions .action-postback.disabled {\n    background: #f8f8f8;\n    border-color: #c5c5c5;\n    color: #737373;\n}\n\n.message-actions .action-postback.disabled:hover {\n    background: #f8f8f8;\n}\n\n.message-actions .action-postback.disabled:focus, .message-actions a.action-postback.disabled:active {\n    background: #f8f8f8;\n}\n\n.message-global-actions {\n    align-items: flex-start;\n    display: flex;\n    flex-direction: column;\n    margin-top: 16px;\n}\n\n.message-global-actions.has-message-icon {\n    margin-left: 40px;\n}\n\n.message-global-actions .action-postback {\n    align-items: center;\n    border: 1px solid #1b8fd2;\n    border-radius: 4px;\n    color: #1b8fd2;\n    cursor: pointer;\n    display: flex;\n    flex: 1;\n    font-size: 13.75px;\n    font-weight: bold;\n    justify-content: center;\n    margin-top: 4px;\n    margin-bottom: 4px;\n    padding: 12px 24px;\n    text-decoration: none;\n}\n\n.message-global-actions .action-postback:first-of-type {\n    margin-top: 0;\n}\n\n.message-global-actions .action-postback:last-of-type {\n    margin-bottom: 0;\n}\n\n.message-global-actions .action-postback:hover {\n    background: #1b8fd2;\n    color: #fff;\n}\n\n.message-global-actions .action-postback:focus, .message-global-actions .action-postback:active {\n    background: #004d80;\n    color: #fff;\n}\n\n.message-global-actions .action-postback.disabled {\n    background: #f8f8f8;\n    border-color: #c5c5c5;\n    color: #737373;\n}\n\n.message-global-actions .action-postback.disabled:hover, .message-global-actions .action-postback.disabled:focus, .message-global-actions .action-postback.disabled:active {\n    background: #f8f8f8;\n    border-color: #c5c5c5;\n    color: #737373;\n}\n\n.action-image {\n    max-height: 24px;\n    max-width: 24px;\n    margin-left: 4px;\n    margin-right: 4px;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(65);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".attachment-image,\n.attachment-video{width: 100%;}\n.attachment-audio{width: 190px;}/* TODO: set by javascript */\n\n.attachment-message {\n    display: -webkit-flex; /* Safari */\n    display: flex;\n}\n\n.attachment-icon {\n    width: 32px;\n    height: 32px;\n    overflow: hidden;\n    margin-right: 4px;\n    justify-content: center;\n    background-color: transparent;\n    background: no-repeat center center;\n    border: none;\n    align-items: center;\n}\n\n.attachment-fileName {\n    margin: auto 0;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(67);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".card-message-horizontal .message-bubble.message-header, .card-message-horizontal .message-bubble.message-footer {\n    margin-right: 0;\n}\n\n.card-message-horizontal .content-wrapper {\n    flex: 1 1 auto;\n    min-width: 0;\n    overflow-x: visible;\n}\n\n.card-message-content {\n    line-height: 1.5;\n    max-width: 100%;\n    white-space: pre-wrap;\n}\n\n.card-message-horizontal .card-message-content {\n    position: relative;\n}\n\n.card-message-content a {\n    text-decoration: none;\n}\n\n.card-message-horizontal {\n    margin-left: 20px;\n    margin-right: 20px;\n}\n\n.card-message-horizontal.has-message-icon {\n    margin-left: 0;\n}\n\n.card-message-cards {\n    margin-right: 20px;\n    max-width: 100%;\n}\n\n.card-message-horizontal .card-message-cards {\n    align-items: center;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    justify-content: space-between;\n    max-width: 100%;\n    -webkit-overflow-scrolling: touch;\n    overflow-x: auto;\n    overflow-y: hidden;;\n    position: relative;\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n    scroll-behavior: smooth;\n    scroll-snap-type: x mandatory;\n    width: 100%;\n    white-space: nowrap;\n}\n\n.card-message-horizontal .card-message-cards::-webkit-scrollbar {\n    display: none;\n}\n\n.card-message-vertical .card {\n    border-radius: 20px;\n    margin: 8px 0;\n}\n\n.card-message-vertical .card:first-of-type {\n    margin-top: 0;\n}\n\n.card-message-vertical .card:last-of-type {\n    margin-bottom: 0;\n}\n\n.card-message-vertical .message-wrapper {\n    flex-direction: column;\n}\n\n.card {\n    background: #fff;\n    box-sizing: border-box;\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 20px;\n    display: block;\n    max-width: 100%;\n    min-width: 75%;\n    overflow: hidden;\n    padding: 20px;\n    white-space: pre-wrap;\n}\n\n.card-message-horizontal .card {\n    align-self: stretch;\n    display: flex;\n    flex: 0 0 auto;\n    flex-direction: column;\n    justify-content: space-around;\n    margin: 0 8px;\n    scroll-snap-align: start;\n}\n\n.card-message-horizontal .card:first-of-type {\n    margin-left: 0;\n}\n\n.card-message-horizontal .card:last-of-type {\n    margin-right: 0;\n}\n\n.card-image {\n    height: 275px;\n    max-width: 100%;\n    width: 375px;\n}\n\n.card-content {\n    display: flex;\n    flex-direction: column;\n    line-height: 1.5;\n}\n\n.card-title {\n    font-weight: 400;\n    margin: 4px;\n    max-width: 100%;\n    text-align: center;\n    white-space: pre-wrap;\n}\n\n.card-description {\n    font-weight: 400;\n    max-width: 100%;\n    margin: 4px;\n    text-align: start;\n    text-overflow: ellipsis;\n    white-space: pre-wrap;\n}\n\n.card-actions {\n    display: flex;\n    flex-direction: column;\n}\n\n.card-actions .action-postback {\n    align-items: center;\n    background: #0099ff;\n    border-radius: 4px;\n    color: #ffffff;\n    cursor: pointer;\n    display: flex;\n    font-size: 13.75px;\n    font-weight: bold;\n    flex: 1;\n    justify-content: center;\n    padding: 12px 24px;\n    margin: 4px;\n    text-decoration: none;\n}\n\n.card-actions .action-postback:hover {\n    background: #eaeaea;\n}\n\n.card-actions button.disabled {\n    color: #737373;\n    background: #ffffff;\n    border-color: #c5c5c5;\n}\n\n.card-actions button.disabled:hover {\n    color: #737373;\n    background: #ffffff;\n}\n\n.round {\n    align-items: center;\n    background: #eaeaea;\n    border: none;\n    border-radius: 4px;\n    -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);\n    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);\n    color: #333333;\n    cursor: pointer;\n    display: flex;\n    height: 36px;\n    justify-content: center;\n    position: absolute;\n    text-align: center;\n    top: calc(50% - 18px);\n    width: 36px;\n    z-index: 1;\n}\n\n.round svg {\n    fill: #333333;\n}\n\n.round:hover {\n    background: #4a90e2;\n    color: #ffffff;\n}\n\n.round:hover svg {\n    fill: #ffffff;\n}\n\n.previous {\n    left: -18px;\n}\n\n.next {\n    right: -18px;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(69);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".loading-icon {\n    display: -webkit-flex; /* Safari */\n    display: flex;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(71);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".spinner{\n    position: relative;\n    display: inline-block;\n    width: 28px;\n    height: 28px;\n    margin-right: 4px;\n}\n.spinner svg{\n    animation-duration: 750ms;\n    -webkit-animation: spinner-rotate 1s linear infinite;\n    animation: spinner-rotate 1s linear infinite;\n    overflow: hidden;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    -webkit-transform: translateZ(0);\n    transform: translateZ(0);\n}\n.spinner circle{\n    stroke: #387ef5;\n    fill: transparent;\n    stroke-width: 4px;\n    stroke-dasharray: 128px;\n    stroke-dashoffset: 82px;\n}\n\n@-webkit-keyframes spinner-rotate {\n    0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n@keyframes spinner-rotate {\n    0% {\n        -webkit-transform: rotate(0deg);\n        transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n        transform: rotate(360deg);\n    }\n}\n",""]),e.exports=t},function(e,t,n){var i=n(73);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".message-with-icon {\n    align-items: center;\n    display: -webkit-flex; /* Safari */\n    display: flex;\n}\n\n.error-icon {\n    margin-right: 5px;\n    max-width: 24px;\n    max-height: 24px;\n}\n\n.message-text {\n    margin: auto 0;\n    text-align: start;\n    white-space: pre-wrap;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(75);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".message {\n    line-height: 1.5;\n    margin-bottom: 24px;\n}\n\n.left {\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-start;\n    text-align: start;\n}\n\n.right {\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-end;\n}\n\n.message-wrapper {\n    display: flex;\n    max-width: 100%;\n}\n\n.left .message-wrapper {\n    flex-direction: row;\n}\n\n.right .message-wrapper {\n    flex-direction: row-reverse;\n}\n\n.icon-wrapper {\n    align-self: flex-end;\n    align-items: flex-end;\n    border-radius: 4px;\n    display: flex;\n    height: 32px;\n    justify-content: center;\n    min-width: 32px;\n    overflow: hidden;\n    width: 32px;\n}\n\n.left .icon-wrapper {\n    margin-right: 8px;\n}\n\n.right .icon-wrapper {\n    margin-left: 8px;\n}\n\n.message-icon {\n    height: 32px;\n    max-height: 32px;\n    max-width: 32px;\n    width: 32px;\n}\n\n.content-wrapper {\n    max-width: 100%;\n    overflow-x: auto;\n}\n\n/*------------*/\n\n.message-profile-pic {\n    padding: 2px;\n    display: inline-block;\n    width: 25px;\n    height: 25px;\n    border-radius: 50%;\n    background-color: rgba(20, 0, 0, .12);\n    position: absolute;\n}\n\n.left .message-profile-pic {\n    bottom: 6px;\n    left: 6px;\n}\n\n.right .message-profile-pic {\n    bottom: 6px;\n    right: 6px;\n}\n\n/*------------*/\n\n.message-bubble {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    margin: 0;\n    max-width: 350px;\n    padding: 20px;\n    position: relative;\n}\n\n.screen-reader-only {\n    height: 1px;\n    left: -20000px;\n    overflow: hidden;\n    position: absolute;\n    top: auto;\n    width: 1px;\n}\n\n.message-content {\n    line-height: 1.5;\n    margin: 4px;\n    overflow: hidden;\n    text-align: start;\n    word-wrap: break-word;\n    white-space: pre-wrap;\n}\n\n.message-content a {\n    text-decoration: none;\n}\n\n.right .message-bubble {\n    margin-left: 20px;\n    border-radius: 24px 24px 0 24px;\n}\n\n.left .message-bubble {\n    margin-right: 20px;\n    border-radius: 24px 24px 24px 0;\n}\n\n.left .message-header {\n    border-radius: 24px 24px 0 0;\n    margin-bottom: 10px;\n}\n\n.left .message-footer {\n    border-radius: 0 0 24px 24px;\n    margin-top: 10px;\n}\n\n.left .has-header {\n    border-top-left-radius: 0;\n    border-top-right-radius: 0;\n}\n\n.left .has-footer {\n    border-bottom-right-radius: 0;\n}\n\n/*------------*/\n\n.attachment-image, .attachment-video {\n    width: 100%;\n}\n\n.attachment-audio {\n    width: 190px;\n}\n\n.bubble-wrapper {\n    display: flex;\n    flex-direction: row;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(77);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,".status-message-container {\n    display: flex;\n    flex-direction: column;\n    margin-bottom: 24px;\n}\n\n.status-message-wrapper {\n    align-self: center;\n    align-items: center;\n    display: flex;\n    flex: 0 1 auto;\n    border-radius: 4px;\n    background-color: #f3f3f3;\n    max-width: 80%;\n    padding: 10px 24px;\n\n    animation: vibrate 0.5s linear both;\n}\n\n@keyframes vibrate {\n    0% {\n        -webkit-transform: translate(0);\n                transform: translate(0);\n    }\n    20% {\n        -webkit-transform: translate(-2px, 2px);\n                transform: translate(-2px, 2px);\n    }\n    40% {\n        -webkit-transform: translate(-2px, -2px);\n                transform: translate(-2px, -2px);\n    }\n    60% {\n        -webkit-transform: translate(2px, 2px);\n                transform: translate(2px, 2px);\n    }\n    80% {\n        -webkit-transform: translate(2px, -2px);\n                transform: translate(2px, -2px);\n    }\n    100% {\n        -webkit-transform: translate(0);\n                transform: translate(0);\n    }\n}\n\n.status-image {\n    max-width: 16px;\n    max-height: 16px;\n}\n\n.status-message {\n    color: #737373;\n    font-size: 14px;\n    margin-left: 8px;\n    text-align: start;\n}\n",""]),e.exports=t},function(e,t,n){var i=n(79);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(t=n(1)(!1)).push([e.i,"\nhr {\n    border-top: 1px solid #eee;\n    padding: 0;\n    margin: 10px 0;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServerService=void 0;var r=n(8),a=n(10),c=n(22),l=n(0),h=n(15),u=n(81),d=n(7),p=n(4),g=n(16),f=n(19),m=n(3),v=n(82),_=n(83),b=n(84),y=n(86),C=function(){function e(e,t,n){var i=this;this._fetchAuthToken=t,this._speechService=n,this._uploadRequest=[],this._requestId=0,this._logger=new d.Logger("ChatServerService"),this._isFirstRun=!0,this.onMessage=function(e,t){},this.onStatusChange=function(e){},this.onSuggestions=function(e){},this.onOriginalMessage=function(e){},this.onFinalSentMessage=function(e){},this._config=this._mergeSettings(u.defaultSettings,e),this._configureLinkHandler(),this._configureStorage(),this._configureLocale(),this._i18nText=this._config.i18n[this._config.locale],d.Logger.logLevel=this._config.isDebugMode?d.Logger.LOG_LEVEL.DEBUG:d.Logger.LOG_LEVEL.ERROR,d.Logger.appName=this._config.name,d.Logger.appVersion=this._config.version,window.addEventListener("online",(function(){return i.openConnection()})),window.addEventListener("offline",(function(){return i.closeConnection()})),t&&(this._authTokenService=b.AuthTokenService.getInstance(t))}return e.prototype.connect=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._config.clientAuthEnabled?[4,this._authTokenService.getToken()]:[3,2];case 1:e=t.sent();try{this._configureParams(e)}catch(e){return[2,Promise.reject(e.message)]}return this._url=this._setupWebSocketURI(),[2,this._open()];case 2:try{this._configureParams()}catch(e){return[2,Promise.reject(e.message)]}return this._url=this._setupWebSocketURI(),[2,this._open()]}}))}))},e.prototype.uploadAttachment=function(e,t,n,i){var o=this;return new Promise((function(s,r){if(o._config.enableAttachment){o._logger.debug("upload attachment to chat server",e);var l=new FormData;l.append("attachment",e);var h=new XMLHttpRequest,u=o._requestId++;o._uploadRequest.push({id:u,request:h}),h.onreadystatechange=function(){if(h.readyState===XMLHttpRequest.DONE)switch(h.status){case c.Response.STATUS.OK:var l=JSON.parse(h.responseText),d={attachment:{type:o._getAttachmentType(l.type.split("/")[0].toLowerCase()),url:l.url},type:m.PAYLOAD_TYPE.ATTACHMENT},p=g.createUserMessage(d,o._config.userId,new Date,!0);o.send(p,n,l.fileName),s(l);break;case a.Constants.FILE_SIZE_LIMIT_EXCEEDED:t&&t(e.name,h.status,n),o._logger.error("Can't upload attachment.",e,h.status),r(o._i18nText.uploadFileSizeLimitExceeded);break;case a.Constants.UNSUPPORTED_FILE_TYPE:t&&t(e.name,h.status,n),o._logger.error("Can't upload attachment.",e,h.status),r(o._i18nText.uploadUnsupportedFileType);break;default:i?o._retryUploadingFile(e,t,n).then((function(e){s(e)})).catch((function(e){r(e)})):(t&&t(e.name,h.status,n),o._logger.error("Can't upload attachment.",e),r(o._i18nText.uploadFailed))}o._uploadRequest=o._uploadRequest.filter((function(e){return e.id!==u}))},o.isConnectionOpen()?o._config.clientAuthEnabled?o._authTokenService.getToken().then((function(t){o._configureParams(t),o._pushUpload(h,e,l,t)}),(function(i){t&&t(e.name,h.status,n),o._logger.error("Upload failed. Could not get valid token.",i),r("Upload failed. Could not get valid token.")})):o._pushUpload(h,e,l):(t&&t(e.name,h.status,n),r("Upload failed. Not connected to server."))}else t&&t(e.name,null,n),r("Upload Failed. The enableAttachment feature is disabled.")}))},e.prototype.cancelUploadAttachments=function(){this._uploadRequest.forEach((function(e){e.request.abort()}))},e.prototype.getSuggestions=function(e){if(this._logger.debug("Get suggestions from chat server",e),this._ws.readyState===r.CONNECTION_STATE.OPEN){if(this._ws.send(e),e.profile)return}else this._logger.error("Can't get suggestions for the user query, WebSocket status - "+a.Constants.WEBSOCKET_READY_STATE[this._ws.readyState],e)},e.prototype.getMessages=function(){return this._storageService.getItem(this._chatStorageId)?JSON.parse(this._storageService.getItem(this._chatStorageId)):[]},e.prototype.loadChat=function(){var e=this.getMessages();return e.forEach((function(e){e.isRead=!0})),this._storageService.setItem(this._chatStorageId,JSON.stringify(e)),e},e.prototype.getUnreadMessagesCount=function(){e.messages=this._storageService.getItem(this._chatStorageId)?JSON.parse(this._storageService.getItem(this._chatStorageId)):[];for(var t=0,n=0,i=e.messages;n<i.length;n++){var o=i[n];o.from&&!o.isRead&&t++}return t},e.prototype.send=function(e,t,n,i){var o=!1;if(this._wsSend(e,i)){if(o=!0,e.profile)return o;if(e.messagePayload&&e.messagePayload.type===m.PAYLOAD_TYPE.POSTBACK){var s=g.createUserMessage({text:e.messagePayload.text,type:m.PAYLOAD_TYPE.TEXT},this._config.userId,new Date,!0);s.userId=this._config.userId,(null==i?void 0:i.hidden)||(this._saveMessage(s),this.onMessage(s))}else n&&(e.messagePayload.attachment.fileName=n),(null==i?void 0:i.hidden)||(this._saveMessage(e),this.onMessage(e,t))}else this._logger.error("Can't send message");return o},e.prototype.markAsRead=function(t){e.messages=this._storageService.getItem(this._chatStorageId)?JSON.parse(this._storageService.getItem(this._chatStorageId)):[];for(var n=0,i=0,o=e.messages;i<o.length;i++){var s=o[i];if(new Date(s.date).getTime()===new Date(t).getTime()){s.isRead=!0,e.messages[n]=s;break}n++}this._storageService.setItem(this._chatStorageId,JSON.stringify(e.messages))},e.prototype.markAllAsRead=function(){e.messages=this._storageService.getItem(this._chatStorageId)?JSON.parse(this._storageService.getItem(this._chatStorageId)):[];for(var t=0,n=0,i=e.messages;n<i.length;n++){var o=i[n];o.isRead=!0,e.messages[t]=o,t++}this._storageService.setItem(this._chatStorageId,JSON.stringify(e.messages))},e.prototype.retryMessage=function(e){var t=e.messagePayload;if(this._latestUserMessage)this._latestUserMessage.date=new Date,this.send(this._latestUserMessage);else if(t&&t.postback.text){var n={text:t.postback.text,type:m.PAYLOAD_TYPE.TEXT},i=g.createUserMessage(n,this._config.userId,new Date,!0);this.send(i)}},e.prototype.getChatConfiguration=function(){return this._config},e.prototype.setSettingsProperty=function(e,t){this._config[e]=t},e.prototype.isConnectionOpen=function(){return this._ws&&this._ws.readyState===r.CONNECTION_STATE.OPEN},e.prototype.openConnection=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){return this.isConnectionOpen()&&this.closeConnection(),[2,this.connect()]}))}))},e.prototype.closeConnection=function(e,t){this.isConnectionOpen()&&this._ws.close(e,t)},e.prototype.updateUser=function(e,t){this.send(e,null,null,t)},e.prototype.clearMessages=function(e,t){var n=this._config.name+"-"+e+"-messages";(t?window[t]:this._storageService).getItem(n)&&this._storageService.removeItem(n)},e.prototype.clearAllMessage=function(){var e=null===window||void 0===window?void 0:window.localStorage,t=(null==e?void 0:e.length)||0;if(t)for(var n=/oda-chat-.*-messages/g,i=0;i<t;i++){var o=e.key(i);(null==o?void 0:o.match(n))&&e.removeItem(o)}},e.prototype._configureParams=function(e){if(this._config.clientAuthEnabled?(this._config.channelId=e.getClaim("channelId"),this._config.userId=e.getClaim("userId")):this._config.userId=this._config.userId||this._generateUserId(),this._searchParams={channelId:this._config.channelId,userId:this._config.userId},!this._config.URI)throw new Error("URI not provided.");if(!this._config.channelId)throw new Error("channelId not provided.");if(!this._config.userId)throw new Error("userId not provided.");this._chatStorageId=this._config.name+"-"+this._config.userId+"-messages"},e.prototype._open=function(){var e=this;return new Promise((function(t,n){e._ws||(e._ws=new y.ReconnectingWebSocket(e._url.toString(),e._config.clientAuthEnabled?e._authTokenService:void 0,e._config.reconnectInterval,e._config.reconnectMaxAttempts,e._config.reconnectTimeout,e._config.enableLongPolling,e._config.upgradeToWebSocketInterval,e._setupLongPollingURI().toString()),e._ws.onopen=function(){if(e._logger.debug("Connection established"),e._config.enableSpeech){var n={channelId:e._config.channelId,host:e._config.URI,locale:e._config.speechLocale,protocol:e._config.enableSecureConnection?"wss://":"ws:/",userId:e._config.userId};e._config.clientAuthEnabled?e._authTokenService.getToken().then((function(t){e._configureParams(t),e._speechService.init(e._config,n,e._authTokenService)})):e._speechService.init(e._config,n)}e._isFirstRun&&(e._isFirstRun=!1,t())},e._ws.onmessage=e._wsMessage.bind(e),e._ws.onclose=function(t){if(e._logger.debug("Connection closed"),e._isFirstRun){e._isFirstRun=!1;var i=(null==t?void 0:t.reason)?t.reason:"Connection to chat server could not be established. Closing the connection.";n(i)}},e._ws.onstatuschange=function(t){e.onStatusChange(t)}),e._ws.open()}))},e.prototype._pushUpload=function(e,t,n,i){var o=this._setupAttachmentURI();e.open("POST",o.toString()),e.setRequestHeader(a.Constants.FILE_SIZE_METADATA_HEADER,t.size.toString()),this._config.clientAuthEnabled&&e.setRequestHeader("Authorization","Bearer "+i.token),e.send(n)},e.prototype._retryUploadingFile=function(e,t,n){return this.uploadAttachment(e,t,n)},e.prototype._getAttachmentType=function(e){switch(e){case f.ATTACHMENT_TYPE.IMAGE:case f.ATTACHMENT_TYPE.VIDEO:case f.ATTACHMENT_TYPE.AUDIO:return e;default:return f.ATTACHMENT_TYPE.FILE}},e.prototype._generateUserId=function(){var e=new Date;return"user"+1e4*(Math.random()+Date.parse(e.toDateString())+e.getTime())%1e8},e.prototype._setupLongPollingURI=function(){var e=this._config.enableSecureConnection?"https://":"http://",t=new URL(e+this._config.URI+"/chat/v1/chats/message");return l.utils.setSearchParams(t,this._searchParams)},e.prototype._setupWebSocketURI=function(){var e=this._config.enableSecureConnection?"wss://":"ws://",t=new URL(e+this._config.URI+"/chat/v1/chats/sockets/websdk");return l.utils.setSearchParams(t,this._searchParams)},e.prototype._setupAttachmentURI=function(){var e=this._config.enableSecureConnection?"https://":"http://",t=new URL(e+this._config.URI+"/chat/v1/attachments");return l.utils.setSearchParams(t,this._searchParams)},e.prototype._wsSend=function(t,n){this._logger.debug("Message to chat server",t.messagePayload);var i=!1;if(void 0===(n=n||{}).delegate&&(n.delegate=!0),n.delegate&&this._config.delegate&&t.messagePayload)if(e.USER_PAYLOAD_TYPES.indexOf(t.messagePayload.type)>=0&&this._config.delegate.beforeSend&&l.utils.isFunction(this._config.delegate.beforeSend)){if(!(t=this._executeSendDelegate(t,this._config.delegate.beforeSend)))return i}else if(t.messagePayload.type===m.PAYLOAD_TYPE.POSTBACK&&this._config.delegate.beforePostbackSend&&l.utils.isFunction(this._config.delegate.beforePostbackSend)&&!(t=this._executeSendDelegate(t,this._config.delegate.beforePostbackSend)))return i;return this._latestUserMessage=t,this._ws.readyState===r.CONNECTION_STATE.OPEN?i=this._ws.send(this._sanitizeText(this._latestUserMessage)):this._logger.error("Can't send message, WebSocket status - "+a.Constants.WEBSOCKET_READY_STATE[this._ws.readyState],t),this.onFinalSentMessage(this._latestUserMessage),i},e.prototype._sanitizeText=function(e){var t,n=JSON.parse(JSON.stringify(e));if((null===(t=e.messagePayload)||void 0===t?void 0:t.type)===m.PAYLOAD_TYPE.TEXT){var i=n.messagePayload;i.text=l.utils.sanitizeText(i.text),n.messagePayload=i}return n},e.prototype._executeSendDelegate=function(e,t){var n,i,o=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(e));e.messagePayload.type===m.PAYLOAD_TYPE.TEXT&&(null===(n=e.sdkMetadata)||void 0===n?void 0:n.speechId)&&(i=(e.messagePayload.text||"").toLowerCase());try{s=t(o)}catch(e){this._logger.error(e)}if(s&&s.messagePayload||(s=null),s&&!l.utils.isValidUserMessage(s)&&(this._logger.error("The generated delegate message is invalid. Sending original message instead."),s=e),i&&s)if(s.messagePayload)if(s.messagePayload.type===m.PAYLOAD_TYPE.TEXT){var r=s.messagePayload.text;(null==r?void 0:r.toLowerCase().indexOf(i))<0&&delete s.sdkMetadata}else delete s.sdkMetadata;else delete s.sdkMetadata;return s},e.prototype._wsMessage=function(e){var t,n,i,o;this._logger.info("Message received: ",e);try{var s=JSON.parse(e);if(s.suggestions?o=!0:(o=!1,i=s.type),o||this.onOriginalMessage(JSON.parse(e)),!o&&(null===(t=this._config.delegate)||void 0===t?void 0:t.beforeDisplay)&&l.utils.isFunction(this._config.delegate.beforeDisplay)){var r=JSON.parse(e),a=JSON.parse(e);try{a=this._config.delegate.beforeDisplay(r)}catch(e){this._logger.error(e)}if(!a||!a.messagePayload)return void this.onMessage(void 0);l.utils.isValidSkillMessage(a)?s=a:this._logger.error("The generated delegate message is invalid. Displaying original message instead.")}n=s}catch(t){(n={date:new Date,isRead:!1}).text=e,i="error"}if(o)this.onSuggestions(n);else{if(n.from={type:v.SENDER_TYPE.BOT},n&&(n.text||n.choices)){var c=g.createBotMessage(n.from,{actions:[],text:n.text,type:m.PAYLOAD_TYPE.TEXT},new Date,!1);if("error"===i){var h=this._config.i18n[this._config.locale?this._config.locale:"en"].retryMessage;c.messagePayload.actions.push({actionId:"Retry",label:h,postback:this._latestUserMessage.messagePayload,text:h,type:"postback"})}if(n.choices)for(var u=0,d=n.choices;u<d.length;u++){var p=d[u];c.messagePayload.actions.push({label:p,postback:p,type:"postback"})}n=c}else n.from&&n.to&&delete n.from;n.date=new Date,n.isRead=!1,this._config.enableNotification&&new Audio(this._config.notificationAudioURL).play(),this._saveMessage(n),this.onMessage(n)}},e.prototype._saveMessage=function(t){e.messages=this._storageService.getItem(this._chatStorageId)?JSON.parse(this._storageService.getItem(this._chatStorageId)):[],e.messages.length>=this._config.messageCacheSizeLimit?(e.messages=e.messages.slice(1,this._config.messageCacheSizeLimit),e.messages.push(t)):e.messages.push(t),this._storageService.setItem(this._chatStorageId,JSON.stringify(e.messages))},e.prototype._mergeSettings=function(e,t){var n=i(i({},e),t);if(t.i18n&&Object.keys(t.i18n).length){e.i18n=this._convertKeysToLowerCase(e.i18n),t.i18n=this._convertKeysToLowerCase(t.i18n);var o=new Set;Object.keys(e.i18n).forEach((function(e){o.add(e)})),Object.keys(t.i18n).forEach((function(e){o.add(e)})),n.i18n={},o.forEach((function(o){n.i18n[o]=i(i(i({},e.i18n.en),e.i18n[o]),t.i18n[o])}))}return n.colors=i(i({},e.colors),t.colors),n},e.prototype._convertKeysToLowerCase=function(e){for(var t={},n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];t[o.toLowerCase()]=e[o]}return t},e.prototype._configureStorage=function(){this._config.userId?this._config.storageType!==p.StorageType.LOCAL&&this._config.storageType!==p.StorageType.SESSION&&(this._config.storageType=p.StorageType.LOCAL):this._config.storageType=p.StorageType.SESSION,this._storageService=new _.StorageService(this._config.storageType),this._cleanupLocalStorage()},e.prototype.isLinkHandler=function(e){var t=!1;return e&&(e.target||e.onclick)&&(t=!0),t},e.prototype._configureLinkHandler=function(){var e=this._config.linkHandler,t=!0;this.isLinkHandler(e)&&(e.onclick&&"function"==typeof e.onclick?t=!1:this._config.linkHandler.onclick=void 0,e.target&&"string"==typeof e.target&&e.target.length?t=!1:this._config.linkHandler.target=void 0),t&&(this._config.linkHandler=void 0)},e.prototype._cleanupLocalStorage=function(){var e=null===window||void 0===window?void 0:window.localStorage,t=(null==e?void 0:e.length)||0;if(t)for(var n=/oda-chat-user\d+-messages/,i=0;i<t;i++){var o=e.key(i);(null==o?void 0:o.match(n))&&e.removeItem(o)}},e.prototype._configureLocale=function(){var e=[];this._config.locale&&e.push(this._config.locale.toLowerCase()),(e=e.concat(h.webApi.getLocales())).indexOf("en")<0&&e.push("en");for(var t=0,n=e;t<n.length;t++){var i=n[t];if(this._isLocaleTranslationExactMatch(i,this._config.i18n)){this._config.locale=i;break}if(this._isLocaleTranslationCloseMatch(i,this._config.i18n)){this._config.locale=i.split("-")[0];break}}},e.prototype._isLocaleTranslationExactMatch=function(e,t){for(var n in e=e.toLowerCase(),t)if(e===n.toLowerCase())return!0;return!1},e.prototype._isLocaleTranslationCloseMatch=function(e,t){for(var n in e=e.toLowerCase().split("-")[0],t)if(e===n.toLowerCase())return!0;return!1},e.USER_PAYLOAD_TYPES=[m.PAYLOAD_TYPE.TEXT,m.PAYLOAD_TYPE.LOCATION,m.PAYLOAD_TYPE.ATTACHMENT],e}();t.ChatServerService=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSettings=void 0;var i=n(4);t.defaultSettings={audioIcon:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%2341bfec%22%20d%3D%22M6%202c-1.1%200-1.99.9-1.99%202L4%2020c0%201.1.89%202%201.99%202H18c1.1%200%202-.9%202-2V8l-6-6H6zm7%207V3.5L18.5%209H13z%22%2F%3E%3C%2Fsvg%3E",badgePosition:{right:"-5px",top:"-5px"},chatBubbleIconHeight:"42px",chatBubbleIconWidth:"56px",clientAuthEnabled:!1,conversationBeginPosition:"top",delaySuggestionsFetch:300,disablePastActions:"all",displayActionsAsPills:!1,embedded:!1,embeddedVideo:!0,enableAttachment:!0,enableAutocomplete:!1,enableAutocompleteClientCache:!1,enableBotAudioResponse:!1,enableClearMessage:!1,enableHeadless:!1,enableLocalConversationHistory:!1,enableLongPolling:!1,enableNotification:!1,enableSecureConnection:!0,enableSpeech:!1,enableSpeechAutoSend:!0,enableTimestamp:!0,errorIcon:"data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20data-name%3D%22Layer%201%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%3E%3Ctitle%3Estat_error_16%3C%2Ftitle%3E%3Ccircle%20cx%3D%228%22%20cy%3D%228%22%20r%3D%228%22%20fill%3D%22%23e4001e%22%2F%3E%3Cpath%20d%3D%22M11.686%2C5.817a1.063%2C1.063%2C0%2C0%2C0-1.5-1.5L8%2C6.5%2C5.818%2C4.314a1.063%2C1.063%2C0%2C0%2C0-1.5%2C1.5L6.5%2C8%2C4.314%2C10.183a1.063%2C1.063%2C0%2C0%2C0%2C1.5%2C1.5L8%2C9.5l2.183%2C2.183a1.063%2C1.063%2C0%2C0%2C0%2C1.5-1.5L9.5%2C8Z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E",fileIcon:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%2341bfec%22%20d%3D%22M6%202c-1.1%200-1.99.9-1.99%202L4%2020c0%201.1.89%202%201.99%202H18c1.1%200%202-.9%202-2V8l-6-6H6zm7%207V3.5L18.5%209H13z%22%2F%3E%3C%2Fsvg%3E",font:'16px "Helvetica Neue", Helvetica, Arial, sans-serif',height:"620px",i18n:{en:{attachmentAudioFallback:"Your browser does not support embedded audio. However you can {0}download it{/0}.",attachmentVideoFallback:"Your browser does not support embedded video. However you can {0}download it{/0}.",audioResponseOff:"Turn audio response on",audioResponseOn:"Turn audio response off",card:"Card",cardImagePlaceholder:"Card image",cardNavNext:"Next card",cardNavPrevious:"Previous card",chatTitle:"Chat",clear:"Clear conversation",close:"Close widget",closing:"Closing",connected:"Connected",connecting:"Connecting",disconnected:"Disconnected",errorSpeechInvalidUrl:"Speech server URL not set. Can not start recording.",errorSpeechMultipleConnection:"A voice recognition connection is live. Can not start another connection.",errorSpeechUnsupportedLocale:"The set speech locale is not supported. Can not start recording.",inputPlaceholder:"Type a message",noSpeechTimeout:"Could not detect the voice, no message sent.",openMap:"Open Map",previousChats:"Previous conversations",recognitionTextPlaceholder:"Speak your message",requestLocation:"Requesting location",requestLocationDeniedPermission:"Location permission denied. Please allow access to share your location, or else type in your location.",requestLocationDeniedTimeout:"Taking too long to get your current location. Please try again, or else type in your location.",requestLocationDeniedUnavailable:"Your current location is unavailable. Please try again, or else type in your location.",retryMessage:"Try again",send:"Send message",shareAudio:"Share Audio",shareFailureMessage:"Sorry, sharing is not available on this device.",shareFile:"Share File",shareLocation:"Share Location",shareVisual:"Share Image/Video",skillMessage:"Skill says",speak:"Speak a message",typingIndicator:"Waiting for response",upload:"Share popup",uploadFailed:"Upload Failed.",uploadFileSizeLimitExceeded:"Upload Failed. File size should not be more than 25MB.",uploadUnsupportedFileType:"Upload Failed. Unsupported file type.",userMessage:"I say",utteranceGeneric:"Message from skill."}},imageIcon:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%2341bfec%22%20d%3D%22M6%202c-1.1%200-1.99.9-1.99%202L4%2020c0%201.1.89%202%201.99%202H18c1.1%200%202-.9%202-2V8l-6-6H6zm7%207V3.5L18.5%209H13z%22%2F%3E%3C%2Fsvg%3E",initBotAudioMuted:!0,isDebugMode:!1,locale:"en",logoIcon:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22%23fff%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M18%2C16.99H11.733L8%2C21.125a1.119%2C1.119%2C0%2C0%2C1-1.021-1.36V16.99H6a5.849%2C5.849%2C0%2C0%2C1-6-5.87A6.061%2C6.061%2C0%2C0%2C1%2C6%2C5H18a6.061%2C6.061%2C0%2C0%2C1%2C6%2C6.12A5.849%2C5.849%2C0%2C0%2C1%2C18%2C16.99ZM6%2C9a2%2C2%2C0%2C1%2C0%2C2%2C2A2%2C2%2C0%2C0%2C0%2C6%2C9Zm6%2C0a2%2C2%2C0%2C1%2C0%2C2%2C2A2%2C2%2C0%2C0%2C0%2C12%2C9Zm6%2C0a2%2C2%2C0%2C1%2C0%2C2%2C2A2%2C2%2C0%2C0%2C0%2C18%2C9Z%22%2F%3E%3C%2Fsvg%3E",maxAttachmentFileSize:25,messageCacheSizeLimit:2e3,name:"oda-chat",numberOfSuggestions:3,numberOfSuggestionsFromServer:30,openChatOnLoad:!1,openLinksInNewWindow:!1,readMark:"✓",reconnectInterval:5,reconnectMaxAttempts:50,reconnectTimeout:300,shareMenuItems:[i.IShareMenuItems.AUDIO,i.IShareMenuItems.FILE,i.IShareMenuItems.LOCATION,i.IShareMenuItems.VISUAL],showConnectionStatus:!1,showPrevConvStatus:!0,showTypingIndicator:!0,speechLocale:i.SPEECH_LOCALE.EN_US,supportedFileTypes:".aac, .3g2, .3gp, .7z, .amr, .avi, .csv, .doc, .docx, .eml, .gif, .ics, .jfif, .jpeg, .jpg, .key, .log, .m4a, .m4v, .mov, .mp3, .mp4, .mp4a, .mpeg, .mpg, .mpga, .neon, .numbers, .odt, .oga, .ogg, .ogv, .pages, .pdf, .png, .pps, .ppsx, .ppt, .pptx, .qt, .svg, .tif, .tiff, .txt, .vcf, .wav, .webm, .webp, .wmv, .xls, .xlsx, .xml, .yml, .yaml",theme:i.IWidgetTheme.DEFAULT,typingIndicatorTimeout:20,upgradeToWebSocketInterval:300,version:"20.8.2",videoIcon:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%2341bfec%22%20d%3D%22M6%202c-1.1%200-1.99.9-1.99%202L4%2020c0%201.1.89%202%201.99%202H18c1.1%200%202-.9%202-2V8l-6-6H6zm7%207V3.5L18.5%209H13z%22%2F%3E%3C%2Fsvg%3E",width:"375px"}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SENDER_TYPE=void 0,function(e){e.BOT="bot",e.USER="user"}(i||(i={})),t.SENDER_TYPE=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageService=void 0;var i=n(15),o=function(e){var t=this;this.getItem=function(e){return t.isInternalStorage?t.memoryStorage[e]:t.windowStorage.getItem(e)},this.setItem=function(e,n){t.isInternalStorage?t.memoryStorage[e]=n:t.windowStorage.setItem(e,n)},this.removeItem=function(e){t.isInternalStorage?delete t.memoryStorage[e]:t.windowStorage.removeItem(e)},i.webApi.isStorageAvailable(e)?(this.isInternalStorage=!1,this.windowStorage=window[e]):(this.isInternalStorage=!0,this.memoryStorage={})};t.StorageService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenService=void 0;var i=n(85),o=function(){function e(e){this._mFetchToken=e}return e.getInstance=function(t){return e._service||(e._service=new e(t)),e._service},e.prototype.getToken=function(){var e=this;return new Promise((function(t,n){if(e._mFetchToken)if(e._currentAuthToken&&!e._isTokenExpired())t(e._currentAuthToken);else{var o=e._mFetchToken();null===o||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then?n({message:"Please provide a function that can return a Promise resolving to a token."}):o.then((function(o){e._currentAuthToken=new i.JwtToken(o),e._isValidToken()?t(e._currentAuthToken):n({message:"Token doesn't contain all mandatory claims."})}),(function(e){return n(e)}))}else n({message:"No function has been provided to fetch newly generated auth token. Please create a function that returns a Promise to generate new JWT token when called."})}))},e.prototype._isTokenExpired=function(){var e=Math.floor(Date.now()/1e3)+20;return this._currentAuthToken.getClaim("exp")<e},e.prototype._isValidToken=function(){return this._currentAuthToken.getClaim("channelId")&&this._currentAuthToken.getClaim("userId")},e}();t.AuthTokenService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JwtToken=void 0;var i=function(){function e(e){this._token=e;var t=this._token.split(".");this._header=JSON.parse(atob(t[0])),this._payload=JSON.parse(atob(t[1]))}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._header},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},enumerable:!1,configurable:!0}),e.prototype.getClaim=function(e){return this.payload[e]},e}();t.JwtToken=i},function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.ReconnectingWebSocket=void 0;var o=n(8),s=n(10),r=n(22),a=n(0),c=n(7),l=n(87),h=n(88),u=function(){function e(e,t,n,i,o,s,r,l,h){this._url=e,this._authTokenService=t,this._reconnectInterval=n,this._reconnectMaxAttempts=i,this._reconnectTimeout=o,this._configLongPolling=s,this._upgradeToWebSocketInterval=r,this._pollingUrl=l,this._protocols=h,this._forcedClose=!1,this._onlyTokenSent=!1,this._reconnectAttempt=0,this._isLongPollingEnabled=!1,this._webSocketUpgradeInterval=300,this._logger=new c.Logger("ReconnectingWebSocket"),this.onclose=function(e){},this.onerror=function(e){},this.onmessage=function(e){},this.onopen=function(e){},this.onconnecting=function(){},this.onstatuschange=function(e){},this._logger.debug("WebSocket creation",this._url,"reconnectInterval: "+this._reconnectInterval,"reconnectMaxAttempts: "+this._reconnectMaxAttempts,"reconnectTimeout: "+this._reconnectTimeout),this._configLongPolling&&(this._reconnectInterval=2,this._reconnectMaxAttempts=5),this._reconnectInterval=a.utils.secToMillisec(n),this._reconnectTimeout=a.utils.secToMillisec(o),this._webSocketUpgradeInterval=a.utils.secToMillisec(this._upgradeToWebSocketInterval)}return Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws.protocol},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._ws.bufferedAmount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws.extensions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return o.CONNECTION_STATE.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return o.CONNECTION_STATE.CLOSING},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return o.CONNECTION_STATE.CONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return o.CONNECTION_STATE.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws.binaryType},set:function(e){this._ws.binaryType=e},enumerable:!1,configurable:!0}),e.prototype.open=function(){navigator.onLine?this._connect():this._setReadyState(o.CONNECTION_STATE.CLOSED)},e.prototype.close=function(e,t){var n;this._forcedClose=!0,(null===(n=this._ws)||void 0===n?void 0:n.readyState)!==o.CONNECTION_STATE.CLOSED?this._ws.close(e,t):this._isLongPollingEnabled&&(this._isLongPollingEnabled=!1,clearInterval(this._upgradeWebSocketTimer)),this._setReadyState(o.CONNECTION_STATE.CLOSED)},e.prototype.send=function(e){e.isRead,e.date;var t,n=i(e,["isRead","date"]),s=!1;if((null===(t=this._ws)||void 0===t?void 0:t.readyState)===o.CONNECTION_STATE.OPEN){this._onlyTokenSent=!1;try{this._ws.send(JSON.stringify(n)),s=!0}catch(e){s=!1}}else this._isLongPollingEnabled?s=this._longPollSendMessage(n):this._logger.error("Connection closed, can not send message.");return s},e.prototype.addEventListener=function(e,t,n){this._ws&&this._ws.addEventListener(e,t,n)},e.prototype.dispatchEvent=function(e){return!!this._ws&&this._ws.dispatchEvent(e)},e.prototype.removeEventListener=function(e,t,n){this._ws&&this._ws.removeEventListener(e,t,n)},e.prototype._connect=function(){var e,t,n=this;if(window.WebSocket){if(this._logger.debug("Initiating connection to server",this._url),this._isLongPollingEnabled||this._setReadyState(o.CONNECTION_STATE.CONNECTING),!this._ws||this._ws.readyState===o.CONNECTION_STATE.CLOSED){this._ws=new WebSocket(this._url,this._protocols),this._ws.onmessage=function(e){n._logger.debug("WebSocket onmessage",n._url,e.data);try{var t=JSON.parse(e.data);if(h.isPongMessage(t))return;n.onmessage(e.data)}catch(t){console.error("Error in parsing message ",e.data)}},this._ws.onerror=function(e){n._logger.debug("WebSocket onerror",n._url,e),n.onerror(e)};var i=function(i){t=n._startPingPong(),clearTimeout(e),clearInterval(n._upgradeWebSocketTimer),e=null,n._reconnectAttempt=0,n._setReadyState(o.CONNECTION_STATE.OPEN),n._isLongPollingEnabled=!1,n._forcedClose=!1,n.onopen(i)};this._ws.onopen=function(e){n._logger.debug("WebSocket opened",n._url),n._authTokenService?(n._onlyTokenSent=!0,n._authTokenService.getToken().then((function(t){n._ws.send(JSON.stringify(h.buildAuthTokenMessage(l.TOKEN_TYPE.JWT,t.token))),setTimeout((function(){return n._onlyTokenSent=!1}),2e4),i(e)}))):i(e)},this._ws.onclose=function(e){clearInterval(t),n._forcedClose?n.onclose(e):n._authTokenService&&n._onlyTokenSent&&e.code!==s.Constants.WEBSOCKET_CLOSE_EVENT.CODE.ABNORMAL_CLOSURE?(n._logger.error("Token authentication failed, connection closed."),n._setReadyState(o.CONNECTION_STATE.CLOSED),n.onclose(e)):setTimeout((function(){n._reconnectAttempt>=n._reconnectMaxAttempts?n._configLongPolling?n._longPollInit():(n._logger.debug("Reconnection attempts limit reached"),n._setReadyState(o.CONNECTION_STATE.CLOSED),n.onclose(e)):n._ws&&n._ws.readyState===o.CONNECTION_STATE.CLOSED&&(n._reconnectAttempt++,n._logger.debug("Reconnection attempt",n._reconnectAttempt),n._connect())}),n._reconnectInterval)}}}else this._configLongPolling?this._longPollInit():(this.onclose(new CloseEvent("WebSocket unavailable",{code:3e3,reason:"WebSocket is disabled or unavailable on this client. Can not connect to chat server."})),this._setReadyState(o.CONNECTION_STATE.CLOSED))},e.prototype._longPollInit=function(){var e=this;this._isLongPollingEnabled||(this._setReadyState(o.CONNECTION_STATE.CONNECTING),this._longPollConnect().then((function(){e.onopen(null),e._isLongPollingEnabled=!0,e._setReadyState(o.CONNECTION_STATE.OPEN),e._upgradeWebSocketTimer=e._startUpgradeToWebSocketTimer(),e._longPollServerPolling()})).catch((function(){e._isLongPollingEnabled=!1,e._setReadyState(o.CONNECTION_STATE.CLOSED),e.onclose(null)})))},e.prototype._longPollConnect=function(){var e=this;return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("POST",e._pollingUrl),i.setRequestHeader("Content-Type","application/json"),i.onload=function(){(null==i?void 0:i.status)>=200&&(null==i?void 0:i.status)<300?t():n()},e._authTokenService?e._authTokenService.getToken().then((function(e){i.setRequestHeader("Authorization","Bearer "+e.token),i.send(JSON.stringify(h.buildPingMessage()))})).catch((function(){e._logger.error("Can not connect to server, token invalid."),n()})):i.send(JSON.stringify(h.buildPingMessage()))}))},e.prototype._longPollServerPolling=function(){var e=this;if(this._isLongPollingEnabled){var t=new XMLHttpRequest;t.open("GET",this._pollingUrl),t.onload=function(){t.status&&t.status===r.Response.STATUS.OK&&e._longPollOnMessage(t.responseText),e._longPollServerPolling()},this._authTokenService?this._authTokenService.getToken().then((function(e){t.setRequestHeader("Authorization","Bearer "+e.token),t.send()})).catch((function(t){e._logger.error("Can not connect to server, token invalid.")})):t.send()}else this._ws||(this.onclose(null),this._setReadyState(o.CONNECTION_STATE.CLOSED))},e.prototype._longPollSendMessage=function(e){var t=this,n=new XMLHttpRequest;return n.open("POST",this._pollingUrl),n.setRequestHeader("Content-Type","application/json"),this._authTokenService?this._authTokenService.getToken().then((function(t){n.setRequestHeader("Authorization","Bearer "+t.token),n.send(JSON.stringify(e))})).catch((function(e){t._logger.error("Can not send message, token invalid.")})):n.send(JSON.stringify(e)),!0},e.prototype._longPollOnMessage=function(e){var t=this;try{JSON.parse(e).forEach((function(e){t.onmessage(e)}))}catch(t){this._logger.error("Unable to parse response",e)}},e.prototype._setReadyState=function(e){this._readyState=e,this.onstatuschange(e)},e.prototype._startPingPong=function(){var e=this;return window.setInterval((function(){var t;(null===(t=e._ws)||void 0===t?void 0:t.readyState)===o.CONNECTION_STATE.OPEN&&e._ws.send(JSON.stringify(h.buildPingMessage()))}),h.PING_PONG_INTERVAL)},e.prototype._startUpgradeToWebSocketTimer=function(){var e=this;return window.setInterval((function(){e._reconnectAttempt=0,e._connect()}),this._webSocketUpgradeInterval)},e}();t.ReconnectingWebSocket=u},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TOKEN_TYPE=void 0,function(e){e.JWT="jwt"}(i||(i={})),t.TOKEN_TYPE=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PING_PONG_INTERVAL=t.isPongMessage=t.buildPingMessage=t.buildAuthTokenMessage=void 0;var i=n(89);t.buildAuthTokenMessage=function(e,t){return{state:{token:t,tokenType:e,type:i.STATE_TYPE.AUTH}}};t.buildPingMessage=function(){return{state:{type:i.STATE_TYPE.PING}}};t.isPongMessage=function(e){return e.state&&e.state.type&&e.state.type===i.STATE_TYPE.PONG};t.PING_PONG_INTERVAL=3e4},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.STATE_TYPE=void 0,function(e){e.AUTH="auth",e.PING="ping",e.PONG="pong"}(i||(i={})),t.STATE_TYPE=i}]).default}));